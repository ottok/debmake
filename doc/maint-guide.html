<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>Debian Maintainers' Guide with debmake</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Debian Maintainers' Guide with debmake</h1>
<span id="author">Osamu Aoki</span><br />
<span id="email"><code>&lt;<a href="mailto:osamu@debian.org">osamu@debian.org</a>&gt;</code></span><br />
<span id="revnumber">version 2.0~pre1,</span>
<span id="revdate">2014-10-13</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>This guide may be used under the terms the GNU General Public License version 2 or higher.</p></div>
<div class="paragraph"><p>This guide was made using the following previous documents as its reference:</p></div>
<div class="ulist"><ul>
<li>
<p>
&#8220;Making a Debian Package (AKA the Debmake Manual)&#8221;, copyright © 1997 Jaldhar Vyas.
</p>
</li>
<li>
<p>
&#8220;The New-Maintainer&#8217;s Debian Packaging Howto&#8221;, copyright © 1997 Will Lowe.
</p>
</li>
<li>
<p>
&#8220;Debian New Maintainers' Guide&#8221;, copyright © 1998-2002 Josip Rodin, 2005-2014 Osamu Aoki, 2010 Craig Small, and 2010 Raphaël Hertzog.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Newer versions of this guide should always be available in the <strong>debmake</strong> package.</p></div>
<div class="paragraph"><p>A short tutorial of the <strong>debmake</strong> command for the experienced Debian maintainer is available as <a href="debmake.html">Debmake tutorial</a>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="preface">Preface</h2>
<div class="sectionbody">
<div class="paragraph"><p>If you are a somewhat experienced Debian user <span class="footnote"><br />[You do need to know a little about Unix programming but you certainly don&#8217;t need to be a wizard. You can learn about the basic handling of a Debian system from the <a href="https://www.debian.org/doc/user-manuals#quick-reference">Debian Reference</a>. It contains some pointers to learn about Unix programming, too.]<br /></span>, you may have encountered following situations:</p></div>
<div class="ulist"><ul>
<li>
<p>
You wish to install a certain software package not yet found in the Debian archive.
</p>
</li>
<li>
<p>
You wish to update a Debian package with the newer upstream release.
</p>
</li>
<li>
<p>
You wish to fix bugs of a Debian package with some patches.
</p>
</li>
</ul></div>
<div class="paragraph"><p>If you wanted to create a Debian package to fulfill these wishes and to share your work with the community, you are the target audience of this guide as a prospective Debian maintainer. <span class="footnote"><br />[If you are not interested in sharing the Debian package, you can certainly work around your local situation by compiling and installing the fixed upstream source package into <strong>/usr/local/</strong>.]<br /></span>  Welcome to the Debian community.</p></div>
<div class="paragraph"><p>Debian has many social and technical rules and conventions to follow since it is a large volunteer organization with history.  Debian also has developed huge array of packaging tools and archive maintenance tools to build consistent set of binary packages addressing many technical objectives:</p></div>
<div class="ulist"><ul>
<li>
<p>
clean build under clearly specified package dependencies and patches
</p>
</li>
<li>
<p>
packages build across many architectures
</p>
</li>
<li>
<p>
optimal splits into multiple binary packages
</p>
</li>
<li>
<p>
smooth library transitions
</p>
</li>
<li>
<p>
security enhancement using specific compiler flags
</p>
</li>
<li>
<p>
multiarch support
</p>
</li>
<li>
<p>
&#8230;
</p>
</li>
</ul></div>
<div class="paragraph"><p>These make it somewhat overwhelming for many new prospective Debian maintainers to get involved with Debian.  This guide tries to provide entry points for them to get started.  It describes as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
What you should know before getting involved with Debian as a prospective maintainer.
</p>
</li>
<li>
<p>
What it looks like to make a simple Debian package.
</p>
</li>
<li>
<p>
What kind of rules exist for making the Debian package.
</p>
</li>
<li>
<p>
Tips for making the Debian package.
</p>
</li>
<li>
<p>
Examples of making Debian packages for several typical scenarios.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The author felt limitations of updating the original &#8220;New Maintainers' Guide&#8221; with the <strong>dh-make</strong> package and decided to create an alternative tool and its matching document to address modern needs for the maintainers.  The result is the <strong>debmake</strong> package and this &#8220;Maintainers' Guide&#8221;.</p></div>
<div class="paragraph"><p>Many chores and tips have been integrated into the <strong>debmake</strong> command making the description of the Debian packaging simple.  This allowed this document to offer more examples which were not available in the &#8220;New Maintainers' Guide&#8221;.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">It takes many hours to properly create and maintain Debian packages. The Debian maintainer must be <strong>both technically competent and diligent</strong> to take up this challenge.</td>
</tr></table>
</div>
<div class="paragraph"><p>Some important topics are explained in detail.  Some of them may look irrelevant to you. Please be patient. Some corner cases are skipped.  Some topics are only covered by the external pointers.  These are intentional choices to keep this guide simple and maintainable.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="start">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph"><p>Here are the prerequisites which you need to understand before you to get involved with Debian.</p></div>
<div class="sect2">
<h3 id="people">People around Debian</h3>
<div class="paragraph"><p>There are several types of people interacting around Debian with different roles:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>upstream author</strong>: the person who made the original program.
</p>
</li>
<li>
<p>
<strong>upstream maintainer</strong>: the person who currently maintains the program.
</p>
</li>
<li>
<p>
<strong>maintainer</strong>: the person making the Debian package of the program.
</p>
</li>
<li>
<p>
<strong>sponsor</strong>: a person who helps maintainers to upload packages to the official Debian package archive (after checking their contents).
</p>
</li>
<li>
<p>
<strong>mentor</strong>: a person who helps novice maintainers with packaging etc.
</p>
</li>
<li>
<p>
<strong>Debian Developer</strong> (DD): a member of the Debian project with full upload rights to the official Debian package archive.
</p>
</li>
<li>
<p>
<strong>Debian Maintainer</strong> (DM): a person with limited upload rights to the official Debian package archive.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Please note that you cannot become an official <strong>Debian Developer</strong> (DD) overnight, because it takes more than technical skill. Please do not be discouraged by this. If it is useful to others, you can still upload your package either as a <strong>maintainer</strong> through a <strong>sponsor</strong> or as a <strong>Debian Maintainer</strong>.</p></div>
<div class="paragraph"><p>Please note that you do not need to create any new package to become an official Debian Developer. Contributing to the existing packages can provide a path to becoming an official Debian Developer too. There are many packages waiting for good maintainers (see <a href="#approaches">[approaches]</a>).</p></div>
</div>
<div class="sect2">
<h3 id="contribute">How to contribute</h3>
<div class="paragraph"><p>Please refer to the following to learn how to contribute to Debian:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.debian.org/intro/help">How can you help Debian?</a> (official)
</p>
</li>
<li>
<p>
<a href="http://www.debian.org/doc/FAQ/ch-contributing">The Debian GNU/Linux FAQ, Chapter 13 - "Contributing to the Debian Project"</a> (semi-official)
</p>
</li>
<li>
<p>
<a href="http://wiki.debian.org/HelpDebian">Debian Wiki, HelpDebian</a> (supplemental)
</p>
</li>
<li>
<p>
<a href="https://nm.debian.org/">Debian New Member site</a> (official)
</p>
</li>
<li>
<p>
<a href="http://wiki.debian.org/DebianMentorsFaq">Debian Mentors FAQ</a> (supplemental)
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="social">Social dynamics of Debian</h3>
<div class="paragraph"><p>Please understand Debian&#8217;s social dynamics to prepare yourself for interactions with Debian:</p></div>
<div class="ulist"><ul>
<li>
<p>
We all are volunteers.
</p>
<div class="ulist"><ul>
<li>
<p>
You cannot impose on others what to do.
</p>
</li>
<li>
<p>
You should be motivated to do things by yourself.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Friendly cooperation is the driving force.
</p>
<div class="ulist"><ul>
<li>
<p>
Your contribution should not over-strain others.
</p>
</li>
<li>
<p>
Your contribution is valuable only when others appreciate it.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Debian is not your school where you get automatic attention of teachers.
</p>
<div class="ulist"><ul>
<li>
<p>
You should be able to learn many things by yourself.
</p>
</li>
<li>
<p>
Attention from other volunteers is a very scarce resource.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Debian is constantly improving.
</p>
<div class="ulist"><ul>
<li>
<p>
You are expected to make high quality packages.
</p>
</li>
<li>
<p>
You should adapt yourself to change.
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>Since we focus only on the technical aspects of the packaging in the rest of this guide, please refer to the following to understand the social dynamics of Debian:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://upsilon.cc/~zack/talks/2011/20110321-taipei.pdf">Debian: 17 years of Free Software, "do-ocracy", and democracy</a> (Introductory slides by the ex-DPL)
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="reminders">Technical reminders</h3>
<div class="paragraph"><p>Here are some technical reminders to accommodate other maintainers to work on your package easily and effectively to maximize the output of Debian as a whole.</p></div>
<div class="ulist"><ul>
<li>
<p>
Make your package easy to debug.
</p>
<div class="ulist"><ul>
<li>
<p>
Keep your package simple.
</p>
</li>
<li>
<p>
Don&#8217;t over-engineer your package.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Keep your package well-documented.
</p>
<div class="ulist"><ul>
<li>
<p>
Use readable code style.
</p>
</li>
<li>
<p>
Make comments in code.
</p>
</li>
<li>
<p>
Format code consistently.
</p>
</li>
<li>
<p>
Maintain the git repository <span class="footnote"><br />[The overwhelming number of Debian maintainers use <strong>git</strong> over other VCS systems such as <strong>hg</strong>, <strong>bzr</strong>, etc.]<br /></span> of the package.
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Debugging of software tends to consume more time than writing the initial working software.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="debian-doc">Debian documentation</h3>
<div class="paragraph"><p>Please make yourself ready to read the pertinent part of the official Debian documentation together with this guide as needed to generate perfect Debian packages:</p></div>
<div class="ulist"><ul>
<li>
<p>
&#8220;Debian Policy Manual&#8221;
</p>
<div class="ulist"><ul>
<li>
<p>
&#8220;must follow&#8221; rules (<a href="http://www.debian.org/doc/devel-manuals#policy">http://www.debian.org/doc/devel-manuals#policy</a>)
</p>
</li>
</ul></div>
</li>
<li>
<p>
&#8220;Debian Developer&#8217;s Reference&#8221;
</p>
<div class="ulist"><ul>
<li>
<p>
&#8220;best practice&#8221; document (<a href="http://www.debian.org/doc/devel-manuals#devref">http://www.debian.org/doc/devel-manuals#devref</a>)
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>If this guide contradicts with the official Debian documentation, they are correct. Please file a bug report on the <strong>debmake</strong> package using the <strong>reportbug</strong> command.</p></div>
<div class="paragraph"><p>Here are alternative tutorial documents which you may read along with this guide:</p></div>
<div class="ulist"><ul>
<li>
<p>
&#8220;Debian Packaging Tutorial&#8221;
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.debian.org/doc/packaging-manuals/packaging-tutorial/">http://www.debian.org/doc/packaging-manuals/packaging-tutorial/</a>
</p>
</li>
</ul></div>
</li>
<li>
<p>
&#8220;Ubuntu Packaging Guide&#8221; (Ubuntu is Debian based.)
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="http://packaging.ubuntu.com/html/">http://packaging.ubuntu.com/html/</a>
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="help">Help resources</h3>
<div class="paragraph"><p>Before you decide to ask your question in some public place, please do your part of efforts, i.e., read the fine documentation:</p></div>
<div class="ulist"><ul>
<li>
<p>
package information available through the <strong>aptitude</strong>, <strong>apt-cache</strong>, and <strong>dpkg</strong> commands.
</p>
</li>
<li>
<p>
files in <strong>/usr/share/doc/</strong><em>package</em> for all pertinent packages.
</p>
</li>
<li>
<p>
contents of <strong>man</strong> <em>command</em> for all pertinent commands.
</p>
</li>
<li>
<p>
contents of <strong>info</strong> <em>command</em> for all pertinent commands.
</p>
</li>
<li>
<p>
contents of <a href="http://lists.debian.org/debian-mentors/">debian-mentors@lists.debian.org mailing list archive</a>.
</p>
</li>
<li>
<p>
contents of <a href="http://lists.debian.org/debian-devel/">debian-devel@lists.debian.org mailing list archive</a>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Your desired information can be found effectively by using the well formed search string such as "<em>keyword</em> <strong>site:lists.debian.org</strong>" to limit the search domain of the web search engine.</p></div>
<div class="paragraph"><p>Making a small test package is a good way to learn details of the packaging. Inspecting existing well maintained packages is the best way to learn how other people make packages.</p></div>
<div class="paragraph"><p>If you still have questions about the packaging, you can ask them interactively:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="mailto:debian-mentors@lists.debian.org">debian-mentors@lists.debian.org</a> mailing list. (This mailing list is for the novice.)
</p>
</li>
<li>
<p>
<a href="mailto:debian-devel@lists.debian.org">debian-devel@lists.debian.org</a> mailing list. (This mailing list is for the expert.)
</p>
</li>
<li>
<p>
<a href="http://www.debian.org/support#irc">IRC</a> such as #debian-mentors.
</p>
</li>
<li>
<p>
Teams focusing on a specific set of packages. (Full list at <a href="https://wiki.debian.org/Teams">https://wiki.debian.org/Teams</a>)
</p>
</li>
<li>
<p>
Language-specific mailing lists.
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="https://lists.debian.org/devel.html">debian-devel-{french,italian,portuguese,spanish}@lists.debian.org</a>
</p>
</li>
<li>
<p>
<a href="http://www.debian.or.jp/community/ml/openml.html#develML">debian-devel@debian.or.jp</a>
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>The more experienced Debian developers will gladly help you, if you ask properly after making your required efforts.</p></div>
</div>
<div class="sect2">
<h3 id="situation">Archive situation</h3>
<div class="paragraph"><p>Please realize the situation of the Debian archive.</p></div>
<div class="ulist"><ul>
<li>
<p>
Debian already has packages for most kinds of programs.
</p>
</li>
<li>
<p>
The number of packages already in the Debian archive is several tens of times greater than that of active maintainers.
</p>
</li>
<li>
<p>
Unfortunately, some packages lack appropriate level of attention by the maintainer.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Thus, contributions to packages already in the archive are far more appreciated (and more likely to receive sponsorship for the uploading) by other maintainers.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The <strong>wnpp-alert</strong> command from the <strong>devscripts</strong> package can check for installed packages up for adoption or orphaned.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="approaches">Contribution approaches</h3>
<div class="paragraph"><p>Here is a pseudo-Python code for your contribution approaches to Debian with a <strong>program</strong>:</p></div>
<div class="ulist"><ul>
<li>
<p>
if exist_in_debian(<strong>program</strong>):
</p>
<div class="ulist"><ul>
<li>
<p>
if is_team_maintained(<strong>program</strong>):
</p>
<div class="ulist"><ul>
<li>
<p>
join_team(<strong>program</strong>)
</p>
</li>
</ul></div>
</li>
<li>
<p>
if is_orphaned(<strong>program</strong>) : # <a href="https://qa.debian.org/developer.php?login=packages@qa.debian.org">maintainer: Debian QA Group</a>
</p>
<div class="ulist"><ul>
<li>
<p>
adopt_it(<strong>program</strong>)
</p>
</li>
</ul></div>
</li>
<li>
<p>
elif is_RFA(<strong>program</strong>) : # <a href="https://www.debian.org/devel/wnpp/rfa_bypackage">Request for Adoption</a>
</p>
<div class="ulist"><ul>
<li>
<p>
adopt_it(<strong>program</strong>)
</p>
</li>
</ul></div>
</li>
<li>
<p>
else:
</p>
<div class="ulist"><ul>
<li>
<p>
if need_help(<strong>program</strong>):
</p>
<div class="ulist"><ul>
<li>
<p>
contact_maintainer(<strong>program</strong>)
</p>
</li>
<li>
<p>
triaging_bugs(<strong>program</strong>)
</p>
</li>
<li>
<p>
preparing_QA_or_NMU_uploads(<strong>program</strong>)
</p>
</li>
</ul></div>
</li>
<li>
<p>
else:
</p>
<div class="ulist"><ul>
<li>
<p>
leave_it(<strong>program</strong>)
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
else: # new packages
</p>
<div class="ulist"><ul>
<li>
<p>
if <strong>not</strong> is_good_program(<strong>program</strong>):
</p>
<div class="ulist"><ul>
<li>
<p>
give_up_packaging(<strong>program</strong>)
</p>
</li>
</ul></div>
</li>
<li>
<p>
elif <strong>not</strong> is_it_distributable(<strong>program</strong>):
</p>
<div class="ulist"><ul>
<li>
<p>
give_up_packaging(<strong>program</strong>)
</p>
</li>
</ul></div>
</li>
<li>
<p>
else: # worth packaging
</p>
<div class="ulist"><ul>
<li>
<p>
if is_ITPed_by_others(<strong>program</strong>):
</p>
<div class="ulist"><ul>
<li>
<p>
if need_help(<strong>program</strong>):
</p>
<div class="ulist"><ul>
<li>
<p>
contact_ITPer_for collaboration(<strong>program</strong>)
</p>
</li>
</ul></div>
</li>
<li>
<p>
else:
</p>
<div class="ulist"><ul>
<li>
<p>
leave_it(<strong>program</strong>)
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
else: # really new
</p>
<div class="ulist"><ul>
<li>
<p>
if is_there_team(<strong>program</strong>):
</p>
<div class="ulist"><ul>
<li>
<p>
join_team(<strong>program</strong>)
</p>
</li>
</ul></div>
</li>
<li>
<p>
if is_it_DSFG(<strong>program</strong>) and is_its_dependency_DFSG(<strong>program</strong>):
</p>
<div class="ulist"><ul>
<li>
<p>
file_ITP(<strong>program</strong>, area="main") # This is <strong>Debian</strong>.
</p>
</li>
</ul></div>
</li>
<li>
<p>
elif is_it_DSFG(<strong>program</strong>):
</p>
<div class="ulist"><ul>
<li>
<p>
file_ITP(<strong>program</strong>, area="contrib") # This is <strong>not</strong> <strong>Debian</strong>.
</p>
</li>
</ul></div>
</li>
<li>
<p>
else: # non-DFSG
</p>
<div class="ulist"><ul>
<li>
<p>
file_ITP(<strong>program</strong>, area="non-free") # This is <strong>not</strong> <strong>Debian</strong>.
</p>
</li>
</ul></div>
</li>
<li>
<p>
package_it_and_close_ITP(<strong>program</strong>)
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>Here:</p></div>
<div class="ulist"><ul>
<li>
<p>
For exist_in_debian(), and is_team_maintained(); check:
</p>
<div class="ulist"><ul>
<li>
<p>
the <strong>aptitude</strong> command
</p>
</li>
<li>
<p>
<a href="https://www.debian.org/distrib/packages">Debian packages</a> web page
</p>
</li>
<li>
<p>
<a href="https://wiki.debian.org/Teams">Teams</a>
</p>
</li>
</ul></div>
</li>
<li>
<p>
For is_orphaned(), is_RFA(), and is_ITPed_by_others(); check:
</p>
<div class="ulist"><ul>
<li>
<p>
The output of the <strong>wnpp-alert</strong> command.
</p>
</li>
<li>
<p>
<a href="https://www.debian.org/devel/wnpp/">Work-Needing and Prospective Packages</a>
</p>
</li>
<li>
<p>
<a href="https://bugs.debian.org/cgi-bin/pkgreport.cgi?pkg=wnpp;dist=unstable">Debian Bug report logs: Bugs in pseudo-package wnpp in unstable</a>
</p>
</li>
<li>
<p>
<a href="http://wnpp.debian.net/">Debian Packages that Need Lovin'</a>
</p>
</li>
<li>
<p>
<a href="http://wnpp-by-tags.debian.net/">Browse wnpp bugs based on debtags</a>
</p>
</li>
</ul></div>
</li>
<li>
<p>
For is_good_program(), check:
</p>
<div class="ulist"><ul>
<li>
<p>
The program should be useful.
</p>
</li>
<li>
<p>
The program should not introduce security and maintenance concerns to the Debian system.
</p>
</li>
<li>
<p>
The program should be well documented and its code needs to be understandable (i.e. not obfuscated).
</p>
</li>
<li>
<p>
The program&#8217;s authors agree with the packaging and are amicable to Debian.
</p>
<div class="ulist"><ul>
<li>
<p>
It is important to be able to consult with the authors in case of any problems with the program.
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
For is_it_DSFG(), and is_its_dependency_DFSG(); check:
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="https://www.debian.org/social_contract#guidelines">Debian Free Software Guidelines</a> (DFSG).
</p>
</li>
</ul></div>
</li>
<li>
<p>
For is_it_distributable(), check:
</p>
<div class="ulist"><ul>
<li>
<p>
The software must have a license and it should allow its distribution.
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>You either need to file an ITP or adopt a package to start working on it.  See the &#8220;Debian Developer&#8217;s Reference&#8221;:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://www.debian.org/doc/manuals/developers-reference/pkgs.html#newpackage">5.1. New packages</a>.
</p>
</li>
<li>
<p>
<a href="https://www.debian.org/doc/manuals/developers-reference/pkgs.html#archive-manip">5.9. Moving, removing, renaming, orphaning, adopting, and reintroducing packages</a>.
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="_novice_maintainer">novice maintainer</h4>
<div class="paragraph"><p>The novice maintainer should avoid packaging programs with the high security exposure:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>setuid</strong> or <strong>setgid</strong> program
</p>
</li>
<li>
<p>
<strong>daemon</strong> program
</p>
</li>
<li>
<p>
program installed in the <strong>/sbin/</strong> or <strong>/usr/sbin/</strong> directories
</p>
</li>
</ul></div>
<div class="paragraph"><p>When you gain more experience in packaging, you&#8217;ll be able to package such programs.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup">Tool Setups</h2>
<div class="sectionbody">
<div class="paragraph"><p>The <strong>build-essential</strong> package must be installed in the build environment.</p></div>
<div class="paragraph"><p>The <strong>devscripts</strong> package should be installed on the maintainer environment.</p></div>
<div class="paragraph"><p>Although this is not necessary the absolute requirement, it is a good idea to install and setup all of the popular set of packages mentioned in this chapter on the maintainer environment.  This enables us to share the common baseline working environment.</p></div>
<div class="paragraph"><p>Please install the tools mentioned in the <a href="https://www.debian.org/doc/manuals/developers-reference/tools.html">Overview of Debian Maintainer Tools</a> of the &#8220;Debian Developer&#8217;s Reference&#8221;, as needed, too.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Tool setups presented here are only meant as an example and may not be up-to-date with the latest packages on the system.  Debian development is a moving target.  Please make sure to read the pertinent documentation and update the configuration as needed.</td>
</tr></table>
</div>
<div class="sect2">
<h3 id="email-setup">Email address</h3>
<div class="paragraph"><p>Various Debian maintenance tools recognize your email address and name to use by the shell environment variables <strong>$DEBEMAIL</strong> and <strong>$DEBFULLNAME</strong>.</p></div>
<div class="paragraph"><p>Let&#8217;s setup these packages by adding the following lines to <strong>~/.bashrc</strong> <span class="footnote"><br />[This assumes you are using Bash as your login shell. If you use some other login shell such as Z shell, use their corresponding configuration files instead of <strong>~/.bashrc</strong>.]<br /></span>.</p></div>
<div class="listingblock">
<div class="title">Add to the <strong>~/.bashrc</strong> file</div>
<div class="content">
<pre><code>DEBEMAIL="your.email.address@example.org"
DEBFULLNAME="Firstname Lastname"
export DEBEMAIL DEBFULLNAME</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="mc-setup">mc</h3>
<div class="paragraph"><p>The <strong>mc</strong> command offers very easy ways to manage files.  It can open the binary <strong>deb</strong> file to check its content by pressing the Enter key over the binary <strong>deb</strong> file.  It uses the <strong>dpkg-deb</strong> command as its back-end.  Let&#8217;s setup it to support easy <strong>chdir</strong> as follows.</p></div>
<div class="listingblock">
<div class="title">Add to the <strong>~/.bashrc</strong> file</div>
<div class="content">
<pre><code># mc related
export HISTCONTROL=ignoreboth
. /usr/lib/mc/mc.sh</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="git-setup">git</h3>
<div class="paragraph"><p>Nowadays, the <strong>git</strong> command is the essential tool to manage the source tree with history.</p></div>
<div class="paragraph"><p>You may wish to set several global configuration in <strong>~/.gitconfig</strong> such as your name and email address used by Git by the following.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git config --global user.name "Name Surname"
$ git config --global user.email yourname@example.com</code></pre>
</div></div>
<div class="paragraph"><p>If you are too accustomed to the CVS or Subversion commands, you may wish to set several command aliases by the following.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git config --global alias.ci "commit -a"
$ git config --global alias.co checkout</code></pre>
</div></div>
<div class="paragraph"><p>You can check your global configuration by the following.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git config --global --list</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">It is essential to use the <strong>gitk</strong> command to work effectively with the history of the Git repository.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="quilt-setup">quilt</h3>
<div class="paragraph"><p>The <strong>quilt</strong> command offers a basic method for recording modifications. For the Debian packaging, it should be customized to record modifications in the <strong>debian/patches/</strong> directory instead of its default <strong>patches/</strong> directory.</p></div>
<div class="paragraph"><p>In order to avoid changing the behavior of the <strong>quilt</strong> command itself, let&#8217;s create an alias <strong>dquilt</strong> for the Debian packaging by adding the following lines to the <strong>~/.bashrc</strong> file. The second line provides the same shell completion feature of the <strong>quilt</strong> command to the <strong>dquilt</strong> command.</p></div>
<div class="listingblock">
<div class="title">Add to the <strong>~/.bashrc</strong> file</div>
<div class="content">
<pre><code>alias dquilt="quilt --quiltrc=${HOME}/.quiltrc-dpkg"
complete -F _quilt_completion $_quilt_complete_opt dquilt</code></pre>
</div></div>
<div class="paragraph"><p>Then let&#8217;s create <strong>~/.quiltrc-dpkg</strong> as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>d=.
while [ ! -d $d/debian -a `readlink -e $d` != / ];
    do d=$d/..; done
if [ -d $d/debian ] &amp;&amp; [ -z $QUILT_PATCHES ]; then
    # if in Debian packaging tree with unset $QUILT_PATCHES
    QUILT_PATCHES="debian/patches"
    QUILT_PATCH_OPTS="--reject-format=unified"
    QUILT_DIFF_ARGS="-p ab --no-timestamps --no-index --color=auto"
    QUILT_REFRESH_ARGS="-p ab --no-timestamps --no-index"
    QUILT_COLORS="diff_hdr=1;32:diff_add=1;34:" + \
            "diff_rem=1;31:diff_hunk=1;33:diff_ctx=35:diff_cctx=33"
    if ! [ -d $d/debian/patches ]; then mkdir $d/debian/patches; fi
fi</code></pre>
</div></div>
<div class="paragraph"><p>See <strong>quilt</strong>(1) and <a href="file:///usr/share/doc/quilt/quilt.html">How To Survive With Many Patches or Introduction to Quilt</a> on how to use the <strong>quilt</strong> command.</p></div>
<div class="paragraph"><p>See <a href="#modpkg">[modpkg]</a> for example usages.</p></div>
</div>
<div class="sect2">
<h3 id="devscripts-setup">devscripts</h3>
<div class="paragraph"><p>The <strong>debsign</strong> command, included in the <strong>devscripts</strong> package, is used to sign the Debian package with your private GPG key.</p></div>
<div class="paragraph"><p>The <strong>debuild</strong> command, included in the <strong>devscripts</strong> package, builds the binary package and check them with the <strong>lintian</strong> command.  It is useful to have verbose outputs from the <strong>lintian</strong> command.</p></div>
<div class="paragraph"><p>You can setup these by the <strong>~/.devscripts</strong> as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>DEBUILD_DPKG_BUILDPACKAGE_OPTS="-i -us -uc"
DEBUILD_LINTIAN_OPTS="-i -I --show-overrides"
DEBSIGN_KEYID="Your_GPG_keyID"</code></pre>
</div></div>
<div class="paragraph"><p>Currently, RSA key with 4096 bits is good idea.  See <a href="http://keyring.debian.org/creating-key.html">Creating a new GPG key</a>.</p></div>
</div>
<div class="sect2">
<h3 id="pbuilder-setup">pbuilder</h3>
<div class="paragraph"><p>The <strong>pbuilder</strong> package provides the clean room (<strong>chroot</strong>) build environment. <span class="footnote"><br />[The <strong>sbuild</strong> package provides an alternative chroot platform.]<br /></span></p></div>
<div class="paragraph"><p>Let&#8217;s customize it with several helper packages.</p></div>
<div class="ulist"><ul>
<li>
<p>
The <strong>cowbuilder</strong> package to boost the chroot creation speed.
</p>
</li>
<li>
<p>
The <strong>eatmydata</strong> package to boost the <strong>dpkg</strong> speed.
</p>
</li>
<li>
<p>
The <strong>ccache</strong> package to boost the <strong>gcc</strong> speed.
</p>
</li>
<li>
<p>
The parallel <strong>make</strong> to boost the build speed.
</p>
</li>
<li>
<p>
The <strong>lintian</strong> package to find bugs in the package.
</p>
</li>
<li>
<p>
The <strong>bash</strong>, <strong>mc</strong>, and <strong>vim</strong> packages in case build fails.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let&#8217;s create <strong>~/.pbuilderrc</strong> as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>AUTO_DEBSIGN="${AUTO_DEBSIGN:-no}"
PDEBUILD_PBUILDER=cowbuilder
HOOKDIR="/var/cache/pbuilder/hooks"
#MIRRORSITE=" http://ftp.us.debian.org/debian/"
MIRRORSITE="http://cdn.debian.net/debian/"
#APTCACHE=/var/cache/pbuilder/aptcache
APTCACHE=/var/cache/apt/archives
#BUILDRESULT=/var/cache/pbuilder/result/
BUILDRESULT=../
EXTRAPACKAGES="ccache lintian eatmydata"
# enable eatmydata for pbuilder
if [ -z "$LD_PRELOAD" ]; then
  LD_PRELOAD=/usr/lib/libeatmydata/libeatmydata.so
else
  LD_PRELOAD="$LD_PRELOAD":/usr/lib/libeatmydata/libeatmydata.so
fi
export LD_PRELOAD
# enable ccache for pbuilder
export PATH="/usr/lib/ccache:${PATH}"
export CCACHE_DIR="/var/cache/pbuilder/ccache"
BINDMOUNTS="${CCACHE_DIR}"
# parallel make
DEBBUILDOPTS=-j8</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The parallel <strong>make</strong> may fail for some existing packages.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s create a hook scripts as follows.</p></div>
<div class="paragraph"><p><strong>/var/cache/pbuilder/hooks/A10ccache</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>#!/bin/sh
set -e
# increase the ccache caching size
ccache -M 4G
# output the current statistics
ccache -s</code></pre>
</div></div>
<div class="paragraph"><p><strong>/var/cache/pbuilder/hooks/B90lintian</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>#!/bin/sh
set -e
apt-get -y --force-yes install lintian
echo "+++ lintian output +++"
su -c "lintian -i -I --show-overrides /tmp/buildd/*.changes; :" -l pbuilder
echo "+++ end of lintian output +++"</code></pre>
</div></div>
<div class="paragraph"><p><strong>/var/cache/pbuilder/hooks/C10shell</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>#!/bin/sh
set -e
apt-get -y --force-yes install vim bash mc
# invoke shell if build fails
cd /tmp/buildd/*/debian/..
/bin/bash &lt; /dev/tty &gt; /dev/tty 2&gt; /dev/tty</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">All these scripts need to be set world executable: <code>-rwxr-xr-x 1 root root</code>.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The <strong>ccache</strong> cache directory <strong>/var/cache/pbuilder/ccache</strong> needs to be set world writable: <code>-rwxrwxrwx 1 root root</code> for the <strong>pbuilder</strong> command.  You should be aware of associated security concerns.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="gbp-setup">git-buildpackage</h3>
<div class="paragraph"><p>You may wish to set several global configuration in <strong>~/.gbp.conf</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code># Configuration file for "gbp &lt;command&gt;"

[DEFAULT]
# the default build command:
builder = git-pbuilder -i -I -us -uc
# use pristine-tar:
pristine-tar = True
# Use color when on a terminal, alternatives: on/true, off/false or auto
color = auto</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The <strong>gbp</strong> command is the alias of the <strong>git-buildpackage</strong> command.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="proxy">HTTP proxy</h3>
<div class="paragraph"><p>You should set up local HTTP caching proxy to save the bandwidth for the Debian package repository access.  There are several choices:</p></div>
<div class="ulist"><ul>
<li>
<p>
Simple HTTP caching proxy using the <strong>squid</strong> package.
</p>
</li>
<li>
<p>
Specialized HTTP caching proxy using the <strong>apt-cacher-ng</strong> package.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="repropro">Private Debian repository</h3>
<div class="paragraph"><p>You can set up a private Debian package repository with the <strong>reprepro</strong> package.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="simple">Simple Debian package</h2>
<div class="sectionbody">
<div class="paragraph"><p>There is an old Latin saying: &#8220;<strong>Longum iter est per praecepta, breve et efficax per exempla</strong>&#8221; (&#8220;It&#8217;s a long way by the rules, but short and efficient with examples&#8221;).</p></div>
<div class="paragraph"><p>Let&#8217;s start with an example of creating a simple Debian package.</p></div>
<div class="sect2">
<h3 id="_hello_c">hello-c</h3>
<div class="paragraph"><p>Let&#8217;s consider a simple C source <strong>hello-c</strong> with the upstream version <strong>1.0</strong> following the <strong>$(DESTDIR)</strong> feature of the <a href="http://www.gnu.org/prep/standards/">GNU Coding Standards</a> and <a href="http://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">FHS</a> for the file installation path as an example.</p></div>
<div class="paragraph"><p>The C source <strong>hello.c</strong> is a very simple one.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cat hello-c-1.0/hello.c
#include &lt;stdio.h&gt;
int
main()
{
        printf("Hello, Debian packager!\n");
        return 0;
}</code></pre>
</div></div>
<div class="paragraph"><p><strong>Makefile</strong> supports <strong>$(DESTDIR)</strong> and <strong>FHS</strong>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cat hello-c-1.0/Makefile
all: hello

hello: hello.c
        gcc -Wall -o hello hello.c

install: hello
        install -D hello $(DESTDIR)/usr/bin/hello

clean:
        -rm -f hello

distclean: clean

.PHONY: all install clean distclean</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_hello_c_1_0_tar_gz">hello-c-1.0.tar.gz</h3>
<div class="paragraph"><p>Let&#8217;s make an upstream tarball <strong>hello-c-1.0.tar.gz</strong>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ tar -czf hello-c-1.0.tar.gz hello-c-1.0
 $ tree
.
├── hello-c-1.0
│   ├── hello.c
│   └── Makefile
└── hello-c-1.0.tar.gz

1 directory, 3 files</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="debmake">debmake</h3>
<div class="paragraph"><p>The <strong>debmake</strong> command is the helper script for the Debian packaging. Let&#8217;s note its 4 most important features. <span class="footnote"><br />[See <a href="debmake.html">Debmake tutorial</a> for the extensive list of features.]<br /></span></p></div>
<div class="ulist"><ul>
<li>
<p>
It always sets most of the obvious option states and values to reasonable defaults.
</p>
</li>
<li>
<p>
It doesn&#8217;t overwrite existing configuration files in the <strong>debian/</strong> directory.
</p>
</li>
<li>
<p>
It supports the <strong>multiarch</strong> package.
</p>
</li>
<li>
<p>
It creates good template files such as the <strong>debian/copyright</strong> file complaint to <strong>DEP-5</strong>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>These 4 features make Debian packaging simple and modern.  Let&#8217;s use this <strong>debmake</strong> command.</p></div>
</div>
<div class="sect2">
<h3 id="_big_picture">Big picture</h3>
<div class="paragraph"><p>Let&#8217;s get the big picture for the making of the Debian package from the upstream tarball <strong>hello-c-1.0.tar.gz</strong>.</p></div>
<div class="paragraph"><p>A single non-native Debian binary package can be made with the <strong>debmake</strong> command as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd hello-c-1.0
 $ debmake
   ... (skipped)
 $ debuild</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The <strong>debuild</strong> command in these examples may be substituted by the equivalent commands such as the <strong>pdebuild</strong> command.</td>
</tr></table>
</div>
<div class="paragraph"><p>Since manual adjustments of auto-generated configuration files are skipped, the generated binary package lacks meaningful package description and some of the policy requirements are missed.  This package functions well under the <strong>dpkg</strong> command, and is good enough for your local deployment.</p></div>
</div>
<div class="sect2">
<h3 id="_debmake_step_by_step">debmake: step-by-step</h3>
<div class="paragraph"><p>The output from the <strong>debmake</strong> command was intentionally skipped in the above.  The actual command output is very verbose and explains what it does as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd hello-c-1.0
 $ debmake
D: /usr/bin/debmake started
D: PYTHONPATH = /usr/bin:/usr/lib/python3.4:/usr/lib/python3.4/plat-x86_64-...
I: set parameters
I: sanity check of parameters
I: pkg="hello-c", ver="1.0", rev="1"
I: *** start packaging in "hello-c-1.0". ***
I: provide hello-c_1.0.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf hello-c-1.0.tar.gz hello-c_1.0.orig.tar.gz
I: pwd = "/path/to/hello-c-1.0"
I: parse binary package settings:
I: binary package=hello-c Type=bin / Arch=any M-A=foreign
I: analyze the source tree
I: build_type = make
I: scan source for copyright+license text and file extensions
I: 100 %, ext = c
I: check_all_licenses
I: ..
I: check_all_licenses completed for 2 files.
I: bunch_all_licenses
I: format_all_licenses
I: make debian/* template files
I: single binary package
I: debmake -x "1" ...
I: creating =&gt; debian/control
I: creating =&gt; debian/copyright
I: creating =&gt; debian/changelog
I: creating =&gt; debian/rules
I: creating =&gt; debian/README.Debian
I: creating =&gt; debian/compat
I: creating =&gt; debian/watch
I: creating =&gt; debian/source/format
I: creating =&gt; debian/source/local-options
I: creating =&gt; debian/patches/series
I: run "debmake -x2" to get more template files
I: $ wrap-and-sort</code></pre>
</div></div>
<div class="paragraph"><p>The <strong>debmake</strong> command generates all these template files based on the command line option.  Since no options are specified, the <strong>debmake</strong> command choses reasonable default values for you:</p></div>
<div class="ulist"><ul>
<li>
<p>
The source package name: <strong>hello-c</strong>
</p>
</li>
<li>
<p>
The upstream version: <strong>1.0</strong>
</p>
</li>
<li>
<p>
The binary package name: <strong>hello-c</strong>
</p>
</li>
<li>
<p>
The Debian revision: <strong>1</strong>
</p>
</li>
<li>
<p>
The package type: <strong>bin</strong> (the ELF binary executable package)
</p>
</li>
<li>
<p>
The <strong>-x</strong> option: <strong>-x1</strong> (default for the single binary package)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let’s inspect generated template files.</p></div>
<div class="paragraph"><p>The <strong>debian/rules</strong> file is the build script provided by the package maintainer.</p></div>
<div class="listingblock">
<div class="title"><strong>debian/rules</strong>:</div>
<div class="content">
<pre><code> $ cat debian/rules
#!/usr/bin/make -f
### See debhelper(7) (uncomment to enable)
### This is a autogenerated template for debian/rules.
### You must remove unused comment lines for the released package.
###
### Output every command that modifies files on the build system.
#DH_VERBOSE = 1
###
### Make debian/rules to behave like dpkg-buildpackage.
### See /usr/share/doc/debmake/maint-guide.html#variablesrules
###include /usr/share/dpkg/architecture.mk
###
### Copy variable definition lines in pkg-info.mk and vendor.mk
### under /usr/share/dpkg/ to here if they are useful.
###
### See FEATURE AREAS in dpkg-buildflags(1)
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all
###
### See ENVIRONMENT in dpkg-buildflags(1)
### Package maintainers to append CFLAGS
#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
### Package maintainers to append LDFLAGS
#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

### main packaging script based on dh7 syntax
%:
        dh $@

### debmake generated override targets
### DEB_HOST_MULTIARCH set by include /usr/share/dpkg/default.mk
### This is example for Cmake (See http://bugs.debian.org/641051 )
###override_dh_auto_configure:
###     dh_auto_configure -- \
###     -DCMAKE_LIBRARY_PATH=$(DEB_HOST_MULTIARCH)</code></pre>
</div></div>
<div class="paragraph"><p>This is essentially the standard <strong>debian/rules</strong> file with the <strong>dh</strong> command. (There are some commented out contents for you to customize it.)</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Configuration files used by the <strong>dh_</strong>* commands from the <strong>debhelper</strong> package usually treat <strong>#</strong> as the start of the comment line.</td>
</tr></table>
</div>
<div class="paragraph"><p>The <strong>debian/control</strong> file provides the main meta data for the Debian package.</p></div>
<div class="listingblock">
<div class="title"><strong>debian/control</strong>:</div>
<div class="content">
<pre><code> $ cat debian/control
Source: hello-c
Section: unknown
Priority: extra
Maintainer: "Firstname Lastname" &lt;email.address@example.org&gt;
Build-Depends: debhelper (&gt;=9)
Standards-Version: 3.9.5
Homepage: &lt;insert the upstream URL, if relevant&gt;

Package: hello-c
Architecture: any
Multi-Arch: foreign
Depends: ${misc:Depends}, ${shlibs:Depends}
Description: auto-generated package by debmake
 This Debian binary package was auto-generated by the
 debmake(1) command provided by the debmake package.
 .
 ===== This comes from the unmodified template file =====
 .
 Please edit this template file (debian/control) and other package files
 (debian/*) to make them meet all the requirements of the Debian Policy
 before uploading this package to the Debian archive.
 .
 See
  * http://www.debian.org/doc/manuals/maint-guide/dreq.en.html#control
  * http://www.debian.org/doc/manuals/developers-reference/best-pkging-prac...
 .
 The synopsis description at the top should be about 60 characters and
 written as a phrase.  No extra capital letters or a final period.  No
 articles — "a", "an", or "the".
 .
 The package description for general-purpose applications should be
 written for a less technical user.  This means that we should avoid
 jargon.  GNOME or KDE is fine but GTK+ is probably not.
 .
 Use the canonical forms of words:
  * Use X Window System, X11, or X; not X Windows, X-Windows, or X Window.
  * Use GTK+, not GTK or gtk.
  * Use GNOME, not Gnome.
  * Use PostScript, not Postscript or postscript.</code></pre>
</div></div>
<div class="paragraph"><p>Since this is the ELF binary executable package, the <strong>debmake</strong> command sets "<strong>Architecture: any</strong>" and "<strong>Multi-Arch: foreign</strong>".  Also, it sets required <strong>substvar</strong> parameters as "<strong>Depends: ${shlibs:Depends}, ${misc:Depends}</strong>".  These are explained in <a href="#deb">[deb]</a>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Please note this <strong>debian/control</strong> file uses the RFC-822 style as documented in <a href="http://www.debian.org/doc/debian-policy/ch-controlfields.html#s-sourcecontrolfiles">5.2 Source package control files&#8201;&#8212;&#8201;debian/control</a> of the &#8220;Debian Policy Manual&#8221;. The use of the empty line and the leading space are significant.</td>
</tr></table>
</div>
<div class="paragraph"><p>There are several other template files under the <strong>debian/</strong> directory.  These are explained in <a href="#deb">[deb]</a>.</p></div>
<div class="listingblock">
<div class="title">The source tree after the basic <strong>debmake</strong> execution.</div>
<div class="content">
<pre><code> $ cd ..
 $ tree
.
├── hello-c-1.0
│   ├── debian
│   │   ├── changelog
│   │   ├── compat
│   │   ├── control
│   │   ├── copyright
│   │   ├── patches
│   │   │   └── series
│   │   ├── README.Debian
│   │   ├── rules
│   │   ├── source
│   │   │   ├── format
│   │   │   └── local-options
│   │   └── watch
│   ├── hello.c
│   └── Makefile
├── hello-c_1.0.orig.tar.gz -&gt; hello-c-1.0.tar.gz
└── hello-c-1.0.tar.gz

4 directories, 14 files</code></pre>
</div></div>
<div class="paragraph"><p>For the proper packaging, you are required to make further modification here.</p></div>
<div class="paragraph"><p>For learning purpose, let&#8217;s leave such details and move on for now.</p></div>
</div>
<div class="sect2">
<h3 id="_debuild_step_by_step">debuild: step-by-step</h3>
<div class="paragraph"><p>You can create a non-native Debian package using the <strong>debuild</strong> command (or its equivalents) in this source tree.  The command output is very verbose and explains what it does as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd hello-c-1.0
 $ debuild
 dpkg-buildpackage -rfakeroot -D -us -uc -i
 ...
 fakeroot debian/rules clean
dh clean
 ...
 debian/rules build
dh build
 ...
 fakeroot debian/rules binary
dh binary
 ...
Finished running lintian.</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If you wish a more fine grained build report, please uncomment "<strong>#DH_VERBOSE = 1</strong>" in the <strong>debian/rules</strong> file before running the <strong>debuild</strong> command.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let’s inspect the result.</p></div>
<div class="listingblock">
<div class="title">The generated files of <strong>hello-c</strong> version <strong>1.0</strong> by the <strong>debuild</strong> command:</div>
<div class="content">
<pre><code> $ cd ..
 $ tree -L 1
.
├── hello-c-1.0
├── hello-c_1.0-1_amd64.build
├── hello-c_1.0-1_amd64.changes
├── hello-c_1.0-1_amd64.deb
├── hello-c_1.0-1.debian.tar.xz
├── hello-c_1.0-1.dsc
├── hello-c_1.0.orig.tar.gz -&gt; hello-c-1.0.tar.gz
└── hello-c-1.0.tar.gz

1 directory, 7 files</code></pre>
</div></div>
<div class="paragraph"><p>You see all the generated files.</p></div>
<div class="ulist"><ul>
<li>
<p>
The <strong>hello-c_1.0.orig.tar.gz</strong> is a symlink to the upstream tarball.
</p>
</li>
<li>
<p>
The <strong>hello-c_1.0-1.debian.tar.xz</strong> contains the maintainer generated contents.
</p>
</li>
<li>
<p>
The <strong>hello-c_1.0-1.dsc</strong> is the meta data file for the Debian source package.
</p>
</li>
<li>
<p>
The <strong>hello-c_1.0-1_amd64.deb</strong> is the Debian binary package.
</p>
</li>
<li>
<p>
The <strong>hello-c_1.0-1_amd64.changes</strong> is the meta data file for the Debian binary package.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The <strong>hello-c_1.0-1.debian.tar.xz</strong> contains the Debian changes to the upstream source as follows.</p></div>
<div class="listingblock">
<div class="title">The compressed archive contents of <strong>hello-c_1.0-1.debian.tar.xz</strong>:</div>
<div class="content">
<pre><code> $ tar -tJf hello-c_1.0-1.debian.tar.xz
debian/
debian/rules
debian/compat
debian/control
debian/watch
debian/copyright
debian/source/
debian/source/format
debian/README.Debian
debian/patches/
debian/patches/series
debian/changelog
 $ tar -tzf hello-c-1.0.tar.gz
hello-c-1.0/
hello-c-1.0/hello.c
hello-c-1.0/Makefile</code></pre>
</div></div>
<div class="paragraph"><p>The <strong>hello-c_1.0-1_amd64.deb</strong> contains the files to be installed as follows.</p></div>
<div class="listingblock">
<div class="title">The binary package contents of <strong>hello-c_1.0-1_amd64.deb</strong>:</div>
<div class="content">
<pre><code> $ dpkg -c hello-c_1.0-1_amd64.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/hello-c/
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/README.Debian
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/changelog.Debian.gz
drwxr-xr-x root/root ...  ./usr/bin/
-rwxr-xr-x root/root ...  ./usr/bin/hello</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Much more details need to be addressed before uploading the package to the Debian archive.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deb">Debian Package</h2>
<div class="sectionbody">
<div class="paragraph"><p>It&#8217;s time to learn the basic rules of the Debian packaging.</p></div>
<div class="paragraph"><p>The Debian source package is a set of input files used to build the Debian binary package and is not a single file.</p></div>
<div class="paragraph"><p>The Debian binary package is a special archive file which holds a set of installable binary data with their associated information.</p></div>
<div class="paragraph"><p>A single Debian source package may generate multiple Debian binary packages defined in the <strong>debian/control</strong> file.</p></div>
<div class="paragraph"><p>The non-native Debian package in the "<strong>3.0 (quilt)</strong>" format is the most normal Debian binary package format.</p></div>
<div class="paragraph"><p>Some people promote to package even programs which have been written especially for Debian in the non-native package format with the above workflow while generating the required tarball without <strong>debian/</strong>* files by oneself in advance. They claim that the use of non-native package format eases communication with the downstream distributions.</p></div>
<div class="sect2">
<h3 id="workflow">Packaging workflow</h3>
<div class="paragraph"><p>The Debian packaging workflow to create the Debian binary package involves generating several specifically named files (see <a href="#name-version">[name-version]</a>) as defined in the &#8220;Debian Policy Manual&#8221;.</p></div>
<div class="paragraph"><p>The oversimplified method for the Debian packaging workflow can be summarized in 5 steps as follows.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
The upstream tarball is downloaded as the <em>package-version</em><strong>.tar.gz</strong> file.
</p>
</li>
<li>
<p>
The upstream tarball is untared to create many files under the <em>package-version</em><strong>/</strong> directory.
</p>
</li>
<li>
<p>
The upstream tarball is copied (or symlinked) to the particular filename <em>packagename_version</em><strong>.orig.tar.gz</strong>.
</p>
<div class="ulist"><ul>
<li>
<p>
the character separating <em>package</em> and <em>version</em> is changed from <strong>-</strong> (hyphen) to <strong>_</strong> (underscore)
</p>
</li>
<li>
<p>
<strong>.orig</strong> is added in the file extension.
</p>
</li>
</ul></div>
</li>
<li>
<p>
The Debian package specification files are added to the upstream source under the <em>package-version</em><strong>/debian/</strong> directory.
</p>
<div class="ulist"><ul>
<li>
<p>
Required specification files under the <strong>debian/</strong>*:
</p>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>debian/rules</strong>
</dt>
<dd>
<p>
The executable script for building the Debian package (see <a href="#rules">[rules]</a>)
</p>
</dd>
<dt class="hdlist1">
<strong>debian/control</strong>
</dt>
<dd>
<p>
The package configuration file containing the source package name, the source build dependency, the binary package name, the binary dependency, etc. (see <a href="#control">[control]</a>)
</p>
</dd>
<dt class="hdlist1">
<strong>debian/changelog</strong>
</dt>
<dd>
<p>
The Debian package history file defining the upstream package version and the Debian revision in its first line (see <a href="#changelog">[changelog]</a>)
</p>
</dd>
<dt class="hdlist1">
<strong>debian/copyright</strong>
</dt>
<dd>
<p>
The copyright and license summary (see <a href="#copyright">[copyright]</a>)
</p>
</dd>
</dl></div>
</li>
<li>
<p>
Optional specification files under the <strong>debian/</strong>* (see <a href="#debianconf">[debianconf]</a>):
</p>
</li>
<li>
<p>
The <strong>debmake</strong> command invoked in the <em>package-version/</em> directory provides the initial set of these template configuration files.
</p>
<div class="ulist"><ul>
<li>
<p>
Required specification files are generated even with the <strong>-x0</strong> option.
</p>
</li>
<li>
<p>
The <strong>debmake</strong> command does not overwrite any existing configuration files.
</p>
</li>
</ul></div>
</li>
<li>
<p>
These files must be manually edited to their perfection according to the &#8220;Debian Policy Manual&#8221; and &#8220;Debian Developer’s Reference&#8221;.
</p>
</li>
</ul></div>
</li>
<li>
<p>
The <strong>dpkg-buildpackage</strong> command (usually from its wrapper <strong>debuild</strong> or <strong>pdebuild</strong>) is invoked in the <em>package-version/</em> directory to make the Debian source and binary packages by invoking the <strong>debian/rules</strong> script.
</p>
<div class="ulist"><ul>
<li>
<p>
The current directory is set as: <strong>$(CURDIR)=</strong><em>/path/to/package-version/</em>
</p>
</li>
<li>
<p>
Create the Debian source package in "<strong>3.0 (quilt)</strong>" format using <strong>dpkg-source</strong>(1)
</p>
<div class="ulist"><ul>
<li>
<p>
<em>package_version</em>.<strong>orig.tar.gz</strong> (copy or symlink of <em>package-version</em>.<strong>tar.gz</strong>)
</p>
</li>
<li>
<p>
<em>package_version-revision</em>.<strong>debian.tar.xz</strong> (tarball of <em>package-version</em>/<strong>debian/</strong>*)
</p>
</li>
<li>
<p>
<em>package_version-revision</em>.<strong>dsc</strong>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Build the source using "<strong>debian/rules build</strong>" into <strong>$(DESTDIR)</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>DESTDIR=debian</strong>/<em>binarypackage/</em> (single binary package)
</p>
</li>
<li>
<p>
<strong>DESTDIR=debian/tmp/</strong> (multi binary package)
</p>
</li>
</ul></div>
</li>
<li>
<p>
Create the Debian binary package using <strong>dpkg-deb</strong>(1), and <strong>dpkg-genchanges</strong>(1).
</p>
<div class="ulist"><ul>
<li>
<p>
<em>binarypackage_version-revision_arch</em>.<strong>deb</strong>
</p>
</li>
<li>
<p>
&#8230; (There may be multiple Debian binary package files.)
</p>
</li>
<li>
<p>
<em>package_version-revision_arch</em>.<strong>changes</strong>
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Check the quality of the Debian package with the <strong>lintian</strong> command. (recommemded)
</p>
<div class="ulist"><ul>
<li>
<p>
Follow the rejection guideline from <a href="https://ftp-master.debian.org/">ftp-master</a>.
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="https://ftp-master.debian.org/REJECT-FAQ.html">REJECT-FAQ</a>
</p>
</li>
<li>
<p>
<a href="https://ftp-master.debian.org/NEW-checklist.html">NEW checklist</a>
</p>
</li>
<li>
<p>
<a href="https://ftp-master.debian.org/#lintianrejects">Lintian Autorejects</a> (<a href="https://ftp-master.debian.org/static/lintian.tags">lintian tag list</a>)
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Sign the <em>package_version-revision</em>.<strong>dsc</strong> and <em>package_version-revision_arch</em>.<strong>changes</strong> with the <strong>debsign</strong> command using your private GPG key.
</p>
</li>
<li>
<p>
Upload the set of the Debian source and binary package files with the <strong>dput</strong> command to the Debian archive.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Here, please replace each part of the filename as:</p></div>
<div class="ulist"><ul>
<li>
<p>
the <em>package</em> part with the Debian source package name
</p>
</li>
<li>
<p>
the <em>binarypackage</em> part with the Debian binary package name
</p>
</li>
<li>
<p>
the <em>version</em> part with the upstream version
</p>
</li>
<li>
<p>
the <em>revision</em> part with the Debian revision
</p>
</li>
<li>
<p>
the <em>arch</em> part with the package architecture
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">There is very extensive documentation in <a href="http://www.debian.org/doc/manuals/developers-reference/best-pkging-practices.html">Chapter 6. Best Packaging Practices</a> of the &#8220;Debian Developer&#8217;s Reference&#8221;.  Please read it.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="name-version">Package name and version</h3>
<div class="paragraph"><p>If the upstream source comes as <strong>hello-0.9.12.tar.gz</strong>, you can take <strong>hello</strong> as the upstream source package name and <strong>0.9.12</strong> as the upstream version.</p></div>
<div class="paragraph"><p><strong>debmake</strong> is meant to provide template files for the package maintainer to work on.  Comment lines started by <strong>&#35;&#35;&#35;</strong> are the tutorial text.  You must remove or edit such comment lines before uploading to the Debian archive.</p></div>
<div class="paragraph"><p>There  are some limitations for what characters may be used as a part of the Debian package.  The most notable limitation is the prohibition of uppercase letters in the package name.  Here is the summary in the regular expression.</p></div>
<div class="ulist"><ul>
<li>
<p>
Upstream package name (<strong>-p</strong>): [-+.a-z0-9]{2,}
</p>
</li>
<li>
<p>
Binary package name (<strong>-b</strong>): [-+.a-z0-9]{2,}
</p>
</li>
<li>
<p>
Upstream version (<strong>-u</strong>): [0-9][-+.:~a-z0-9A-Z]*
</p>
</li>
<li>
<p>
Debian revision (<strong>-r</strong>): [0-9][+.~a-z0-9A-Z]*
</p>
</li>
</ul></div>
<div class="paragraph"><p>See the exact definition in <a href="http://www.debian.org/doc/debian-policy/ch-controlfields.html">Chapter 5 - Control files and their fields</a> of the &#8220;Debian Policy Manual&#8221;.</p></div>
<div class="paragraph"><p>You must adjust the package name and upstream version accordingly for the Debian packaging.</p></div>
<div class="paragraph"><p>In order to manage the package name and version information effectively under popular tools such as the <strong>aptitude</strong> command, it is a good idea to keep the length of package name to be equal or less than 30 characters; and the total length of version and revision to be equal or less than 14 characters. <span class="footnote"><br />[For more than 90% of packages, the package name is equal or less than 24 characters; the upstream version is equal or less than 10 characters and the Debian revision is equal or less than 3 characters.]<br /></span></p></div>
<div class="paragraph"><p>In order to avoid name collisions, the user visible binary package name should not be chosen from any generic words.</p></div>
<div class="paragraph"><p>If upstream does not use a normal versioning scheme such as <strong>2.30.32</strong> but uses some kind of date such as <strong>11Apr29</strong>, a random codename string, or a VCS hash value as part of the version, make sure to remove them from the upstream version. Such information can be recorded in the <strong>debian/changelog</strong> file. If you need to invent a version string, use the <strong>YYYYMMDD</strong> format such as <strong>20110429</strong> as upstream version. This ensures that dpkg interprets later versions correctly as upgrades. If you need to ensure smooth transition to the normal version scheme such as <strong>0.1</strong> in future, use the <strong>0~YYMMDD</strong> format such as <strong>0~110429</strong> as upstream version, instead.</p></div>
<div class="paragraph"><p>Version strings can be compared using the <strong>dpkg</strong> command as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ dpkg --compare-versions ver1 op ver2</code></pre>
</div></div>
<div class="paragraph"><p>The version comparison rule can be summarized as:</p></div>
<div class="ulist"><ul>
<li>
<p>
Strings are compared from the head to the tail.
</p>
</li>
<li>
<p>
Letters are larger than digits.
</p>
</li>
<li>
<p>
Numbers are compared as integers.
</p>
</li>
<li>
<p>
Letters are compared in ASCII code order.
</p>
</li>
</ul></div>
<div class="paragraph"><p>There are special rules for period (<strong>.</strong>), plus (<strong>+</strong>), and tilde (<strong>~</strong>) characters, as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>0.0 &lt; 0.5 &lt; 0.10 &lt; 0.99 &lt; 1 &lt; 1.0~rc1 &lt; 1.0 &lt; 1.0+b1 &lt; 1.0+nmu1 &lt; 1.1 &lt; 2.0</code></pre>
</div></div>
<div class="paragraph"><p>One tricky case occurs when upstream releases <strong>hello-0.9.12-ReleaseCandidate-99.tar.gz</strong> as the pre-release of <strong>hello-0.9.12.tar.gz</strong>. You can ensure the upgrade to work properly by renaming the upstream source to <strong>hello-0.9.12~rc99.tar.gz</strong> having the proper version order.</p></div>
</div>
<div class="sect2">
<h3 id="rules">debian/rules</h3>
<div class="paragraph"><p>The <strong>debian/rules</strong> script is the executable script to build the Debian package.</p></div>
<div class="ulist"><ul>
<li>
<p>
The <strong>debian/rules</strong> script re-targets the upstream build system (see <a href="#build">[build]</a>) to install files in the <strong>$(DESTDIR)</strong> and creates the archive file of the generated files as the <strong>deb</strong> file.
</p>
<div class="ulist"><ul>
<li>
<p>
The <strong>deb</strong> file is used for the binary distribution and installed to the system using the <strong>dpkg</strong> command.
</p>
</li>
</ul></div>
</li>
<li>
<p>
The <strong>dh</strong> command is normally used as the front-end to the build system inside the <strong>debian/rules</strong> script.
</p>
</li>
<li>
<p>
<strong>$(DESTDIR)</strong> path depends on the build type.
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>$(DESTDIR)=debian/</strong><em>binarypackage</em>  (single binary package)
</p>
</li>
<li>
<p>
<strong>$(DESTDIR)=debian/tmp</strong>  (multiple binary package)
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="sect3">
<h4 id="dh">dh</h4>
<div class="paragraph"><p>The <strong>dh</strong> command from the <strong>debhelper</strong> package with the help from its associated packages functions as the wrapper to the typical upstream build systems and offers us with the uniform access to them by supporting all the Debian policy stipulated targets of the <strong>debian/rules</strong> file.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>dh clean</strong> : clean files in the source tree.
</p>
</li>
<li>
<p>
<strong>dh build</strong> : build the source tree
</p>
</li>
<li>
<p>
<strong>dh build-arch</strong> : build the source tree for architecture dependent packages
</p>
</li>
<li>
<p>
<strong>dh build-indep</strong> : build the source tree for architecture independent packages
</p>
</li>
<li>
<p>
<strong>dh install</strong> : install the binary files to <strong>$(DESTDIR)</strong>
</p>
</li>
<li>
<p>
<strong>dh install-arch</strong> : install the binary files to <strong>$(DESTDIR)</strong> for architecture dependent packages
</p>
</li>
<li>
<p>
<strong>dh install-indep</strong> : install the binary files to <strong>$(DESTDIR)</strong> for architecture independent packages
</p>
</li>
<li>
<p>
<strong>dh binary</strong> : generate the <strong>deb</strong> file
</p>
</li>
<li>
<p>
<strong>dh binary-arch</strong> : generate the <strong>deb</strong> file for architecture dependent packages
</p>
</li>
<li>
<p>
<strong>dh binary-indep</strong> : generate the <strong>deb</strong> file for architecture independent packages
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The <strong>dh</strong> command exports compiler flags (<strong>CFLAGS</strong>, <strong>CXXFLAGS</strong>, <strong>FFLAGS</strong>, <strong>CPPFLAGS</strong> and <strong>LDFLAGS</strong>) with values as returned by <strong>dpkg-buildflags</strong>.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="simplerules">Simple debian/rules</h4>
<div class="paragraph"><p>Thanks to this abstraction of the <strong>dh</strong> command <span class="footnote"><br />[This simplicity is available since the version 7 of the <strong>debhelper</strong> package.  This guide assumes the use of the <strong>debhelper</strong> version 9 or newer.]<br /></span>, the Debian policy compliant <strong>debian/rules</strong> file supporting all the required targets can be written as simple as <span class="footnote"><br />[The <strong>debmake</strong> command generates a bit more complicated <strong>debian/rules</strong> file.  But this is the core part.]<br /></span>:</p></div>
<div class="listingblock">
<div class="title">Simple <strong>debian/rules</strong>:</div>
<div class="content">
<pre><code>#!/usr/bin/make -f
#DH_VERBOSE = 1

%:
        dh $@</code></pre>
</div></div>
<div class="paragraph"><p>Essentially, this <strong>dh</strong> command functions as the sequencer to call all required <strong>dh_</strong>* commands at the right moment.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The <strong>debmake</strong> command sets the <strong>debian/control</strong> file with "<strong>Build-Depends: debhelper (&gt;=9)</strong>".</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Setting "<code>DH_VERBOSE = 1</code>" outputs every command that modifies files on
the build system.  Also it enables verbose build logs for some build systems.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="customrules">Customized debian/rules</h4>
<div class="paragraph"><p>Flexible customization of the <strong>debian/rules</strong> is realized by adding appropriate <strong>override_dh_</strong>* targets and their rules.</p></div>
<div class="paragraph"><p>Whenever some special operation is required for a certain <strong>dh_</strong><em>foo</em> command invoked by the <strong>dh</strong> command, any automatic execution of it can be overridden by adding the makefile target <strong>override_dh_</strong><em>foo</em> in the <strong>debian/rules</strong> file.</p></div>
<div class="paragraph"><p>The <strong>debmake</strong> command creates the initial template file taking advantage of the above simple <strong>debian/rules</strong> while adding some extra customizations for the package hardening, etc.</p></div>
<div class="paragraph"><p>You need to know how underlying build systems work under the hood (see <a href="#build">[build]</a>) to address their irregularities using the package customization.</p></div>
<div class="paragraph"><p>See <a href="#simple">[simple]</a> for the actual simple <strong>debian/rules</strong> generated by the <strong>debmake</strong> command which comes with the commented out parts addressing the hardening via compile options (see <a href="#harden">[harden]</a>) and the multiarch customization (see <a href="#multiarch">[multiarch]</a>).</p></div>
</div>
<div class="sect3">
<h4 id="variablesrules">Variables for debian/rules</h4>
<div class="paragraph"><p>Some variable definitions useful for customizing <strong>debian/rules</strong> can be found in files under <strong>/usr/share/dpkg/</strong>.  Notably:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>pkg-info.mk</strong>
</dt>
<dd>
<p>
  <strong>DEB_SOURCE</strong>, <strong>DEB_VERSION</strong>, <strong>DEB_VERSION_EPOCH_UPSTREAM</strong>, <strong>DEB_VERSION_UPSTREAM_REVISION</strong>, <strong>DEB_VERSION_UPSTREAM</strong>, and <strong>DEB_DISTRIBUTION</strong> variables.
 <br />
  These are useful for the backport support etc..
</p>
</dd>
<dt class="hdlist1">
<strong>vender.mk</strong>
</dt>
<dd>
<p>
  <strong>DEB_VENDOR</strong> and <strong>DEB_PARENT_VENDOR</strong> variables; and <strong>dpkg_vendor_derives_from</strong> macro.
 <br />
  These are useful for the vendor support (Debian, Ubuntu, &#8230;).
</p>
</dd>
<dt class="hdlist1">
<strong>architecture.mk</strong>
</dt>
<dd>
<p>
  Set <strong>DEB_HOST_</strong>* and  <strong>DEB_BUILD_</strong>* variables.
 <br />
  These are normally exported by <strong>dpkg-buildpackages</strong>.
</p>
</dd>
<dt class="hdlist1">
<strong>buildflags.mk</strong>
</dt>
<dd>
<p>
  Set <strong>CFLAGS</strong>, <strong>CPPFLAGS</strong>, <strong>CXXFLAGS</strong>, <strong>OBJCFLAGS</strong>, <strong>OBJCXXFLAGS</strong>, <strong>GCJFLAGS</strong>, <strong>FFLAGS</strong>, <strong>FCFLAGS</strong>, and <strong>LDFLAGS</strong> buildflag variables.
 <br />
  These are normally exported by <strong>dh</strong> for the script in the <strong>override_</strong>** target.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>If you wish to use some of these useful variables, copy relevant codes to <strong>debian/rules</strong> to keep <strong>debian/rules</strong> simple.</p></div>
<div class="paragraph"><p>For example, you can add an extra option to <strong>CONFIGURE_FLAGS</strong> for <strong>linux-any</strong> target architectures by adding the followings to <strong>debian/rules</strong>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>DEB_HOST_ARCH_OS = $(shell dpkg-architecture -qDEB_HOST_ARCH_OS)
 ...
ifeq ($(DEB_HOST_ARCH_OS),linux)
CONFIGURE_FLAGS += --enable-wayland
endif</code></pre>
</div></div>
<div class="paragraph"><p>See <strong>dpkg-buildflags</strong>(8) and read the files in the <strong>/usr/share/dpkg</strong> directory.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Adding "<code>include /usr/share/dpkg/architecture.mk</code>" to <strong>debian/rules</strong> allows us to use <strong>debian/rules</strong> for the quick test building.  But it is good idea to remove it for the released package since the official build always use <strong>dpkg-buildpackages</strong>.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="control">debian/control</h3>
<div class="paragraph"><p>The <strong>debian/control</strong> file consists of blocks of meta data separated by the blank line.  Each block of meta data defines the following in this order:</p></div>
<div class="ulist"><ul>
<li>
<p>
meta data for the Debian source package
</p>
</li>
<li>
<p>
meta data for the Debian binary packages
</p>
</li>
</ul></div>
<div class="paragraph"><p>The <strong>debmake</strong> command with the <strong>-b</strong> option (see <a href="#boption">[boption]</a>) creates the initial template <strong>debian/control</strong> file with followings:</p></div>
<div class="ulist"><ul>
<li>
<p>
a set of <strong>Package</strong> stanzas defining the split of the Debian binary packages
</p>
</li>
<li>
<p>
a basic set of substvar used in each pertinent stanza
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="split">Split of the Debian binary package</h4>
<div class="paragraph"><p>For well behaving build systems, the split of the Debian binary package into small ones can be realized as follows.</p></div>
<div class="ulist"><ul>
<li>
<p>
Create binary package entries for all binary packages in the <strong>debian/control</strong> file.
</p>
</li>
<li>
<p>
List all file paths (relative to <strong>debian/tmp</strong>) in the corresponding <strong>debian/</strong><em>binarypackage</em><strong>.install</strong> files.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Please check examples in this guide:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="#multipkg">[multipkg]</a> (simple multi binary package example)
</p>
</li>
<li>
<p>
<a href="#librarypkg">[librarypkg]</a> (library related multi binary package example)
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="substvar">Substvar</h4>
<div class="paragraph"><p>The <strong>debian/control</strong> file also defines the package dependency in which the <a href="http://www.debian.org/doc/debian-policy/ch-source.html#s-substvars">variable substitutions mechanism</a> (substvar) may be used.  See <strong>deb-substvars</strong>(5).</p></div>
<div class="paragraph"><p>The <strong>debmake</strong> command supports following substvars.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>${misc:Depends}</strong> for all binary packages
</p>
</li>
<li>
<p>
<strong>${misc:Pre-Depends}</strong> for all multiarch packages
</p>
</li>
<li>
<p>
<strong>${shlibs:Depends}</strong> for all binary executable and library packages
</p>
</li>
<li>
<p>
<strong>${python:Depends}</strong> for all Python packages
</p>
</li>
<li>
<p>
<strong>${python3:Depends}</strong> for all Python3 packages
</p>
</li>
<li>
<p>
<strong>${perl:Depends}</strong> for all Perl packages
</p>
</li>
<li>
<p>
<strong>${ruby:Depends}</strong> for all Ruby packages
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="binnmu">binNMU safe</h4>
<div class="paragraph"><p>For the safe <a href="https://wiki.debian.org/binNMU">binNMU</a>, the dependency among binary packages from a same source package needs attention if there are both "<strong>Architecture: any</strong>" and "<strong>Architecture: all</strong>" packages involved in it.</p></div>
<div class="ulist"><ul>
<li>
<p>
"<strong>Architecture: any</strong>" package depends on "<strong>Architecture: any</strong>" <em>foo</em> package
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>Depends:</strong> <em>foo</em> <strong>(== ${binary:Version})</strong>
</p>
</li>
</ul></div>
</li>
<li>
<p>
"<strong>Architecture: any</strong>" package depends on "<strong>Architecture: all</strong>" <em>bar</em> package
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>Depends:</strong> <em>bar</em> <strong>(== ${source:Version}</strong>
</p>
</li>
</ul></div>
</li>
<li>
<p>
"<strong>Architecture: all</strong>" package depends on "<strong>Architecture: any</strong>" <em>baz</em> package
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>Depends:</strong> <em>baz</em> <strong>(&gt;= ${source:Version})</strong>, <em>baz</em> <strong>(&lt;&lt; ${source:Upstream-Version}.0~)</strong>
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="libnames">The library package name</h4>
<div class="paragraph"><p>Let&#8217;s consider that the upstream source tarball of the <strong>lib</strong><em>foo</em> library is updated from <strong>lib</strong><em>foo-7.0</em><strong>.tar.gz</strong> to <strong>lib</strong><em>foo-8.0</em><strong>.tar.gz</strong> with the new SONAME major version.</p></div>
<div class="paragraph"><p>In order to distinguish the SONAME major version, their binary library pakages are named as <strong>lib</strong><em>foo7</em> and <strong>lib</strong><em>foo8</em> respectively.</p></div>
<div class="paragraph"><p>You need to transition all dependent packages using <a href="https://wiki.debian.org/binNMU">binNMU</a> by working with the <a href="https://wiki.debian.org/Teams/ReleaseTeam">release team</a>.</p></div>
<div class="paragraph"><p>In order to transition smoothly, the <strong>-dev</strong> package must follow one of the following naming rules:</p></div>
<div class="ulist"><ul>
<li>
<p>
Use the <strong>unversioned -dev</strong> package name: <strong>lib</strong><em>foo</em><strong>-dev</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
This is the normal rule.
</p>
</li>
<li>
<p>
Only one version of the library package is allowed in the archive.
</p>
</li>
<li>
<p>
This is good idea if the number of dependent packages are limited.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Use the <strong>versioned -dev</strong> package names: <strong>lib</strong><em>foo7</em><strong>-dev</strong> and <strong>lib</strong><em>foo8</em><strong>-dev</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
This is the special rule when you need to support both <strong>lib</strong><em>foo7</em> and <strong>lib</strong><em>foo8</em> simultaneously.
</p>
<div class="ulist"><ul>
<li>
<p>
Make all dependent packages depend on <strong>lib</strong><em>foo</em><strong>-dev</strong>.
</p>
</li>
<li>
<p>
Make both <strong>lib</strong><em>foo7</em><strong>-dev</strong> and <strong>lib</strong><em>foo8</em><strong>-dev</strong> provide <strong>lib</strong><em>foo</em><strong>-dev</strong>.
</p>
</li>
<li>
<p>
The source package needs to be renamed as <strong>lib</strong><em>foo7-7.0</em><strong>.tar.gz</strong> and <strong>lib</strong><em>foo8-8.0</em><strong>.tar.gz</strong> respectively to make them both available in the archive.
</p>
</li>
<li>
<p>
The package specific install file path including <strong>lib</strong><em>foo7</em> and <strong>lib</strong><em>foo8</em> respectively for header files etc. needs to be chosen to make them co-installable.
</p>
</li>
</ul></div>
</li>
<li>
<p>
This is useful if the number of dependent packages are huge and their migration poses major resource drain such as manual code updates, etc.  Otherwise, please do not do this.
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>See <a href="http://www.debian.org/doc/debian-policy/ch-sharedlibs.html">Chapter 8 - Shared libraries</a> of the &#8220;Debian Policy Manual&#8221;.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="boption">debmake -b</h3>
<div class="paragraph"><p>The <strong>-b</strong> option of the <strong>debmake</strong> command provides intuitive and flexible methods to customize packaging parameters in the <strong>debian/control</strong> file.  It sets the following stanza values.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Package:</strong>
</p>
</li>
<li>
<p>
<strong>Architecture:</strong>
</p>
</li>
<li>
<p>
<strong>Multi-Arch:</strong>
</p>
</li>
<li>
<p>
<strong>Depends:</strong>
</p>
</li>
<li>
<p>
<strong>Pre-Depends:</strong>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let&#8217;s quote the pertinent part from the <strong>debmake</strong> manpage here.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-b</strong> "<em>binarypackage[:type],&#8230;</em>", <strong>--binaryspec</strong> "<em>binarypackage[:type],&#8230;</em>"
</dt>
<dd>
<p>
set binary package specs by the comma separated list of <em>binarypackage:type</em> pairs, e.g., in full form "<strong>foo:bin,foo-doc:doc,libfoo1:lib,libfoo1-dbg:dbg,libfoo-dev:dev</strong>" or in short form "<strong>,-doc,libfoo1,libfoo1-dbg, libfoo-dev</strong>".
</p>
<div class="paragraph"><p>Here, <em>binarypackage</em> is the binary package name; and optional <em>type</em> is chosen from the following <em>type</em> values:</p></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
<strong>bin</strong>: C/C++ compiled ELF binary code package (any, foreign) (default, alias: <strong>""</strong>, i.e., <em>null-string</em>)
</p>
</li>
<li>
<p>
<strong>data</strong>: Data (fonts, graphics, &#8230;) package (all, foreign) (alias: <strong>da</strong>)
</p>
</li>
<li>
<p>
<strong>dbg</strong>: Debug symbol package (any, same) (alias: <strong>db</strong>)
</p>
</li>
<li>
<p>
<strong>dev</strong>: Library development package (any, same) (alias: <strong>de</strong>)
</p>
</li>
<li>
<p>
<strong>doc</strong>: Documentation package (all, foreign) (alias: <strong>do</strong>)
</p>
</li>
<li>
<p>
<strong>lib</strong>: Library package (any, same) (alias: <strong>l</strong>)
</p>
</li>
<li>
<p>
<strong>perl</strong>: Perl script package (all, foreign) (alias: <strong>pl</strong>)
</p>
</li>
<li>
<p>
<strong>python</strong>: Python script package (all, foreign) (alias: <strong>py</strong>)
</p>
</li>
<li>
<p>
<strong>python3</strong>: Python3 script package (all, foreign) (alias: <strong>py3</strong>)
</p>
</li>
<li>
<p>
<strong>ruby</strong>: Ruby script package (all, foreign) (alias: <strong>rb</strong>)
</p>
</li>
<li>
<p>
<strong>script</strong>: Shell script package (all, foreign) (alias: <strong>sh</strong>)
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>The pair values in the parentheses, such as (any, foreign), are the <strong>Architecture</strong> and <strong>Multi-Arch</strong> stanza values set in the <strong>debian/control</strong> file.</p></div>
<div class="paragraph"><p>In many cases, the <strong>debmake</strong> command makes good guesses for <em>type</em> from <em>binarypackage</em>.  If <em>type</em> is not obvious, <em>type</em> is set to <strong>bin</strong>.  For example, <strong>libfoo</strong> sets <em>type</em> to <strong>lib</strong>, and <strong>font-bar</strong> sets <em>type</em> to <strong>data</strong>, &#8230;</p></div>
<div class="paragraph"><p>If the source tree contents do not match settings for <em>type</em>, <strong>debmake</strong> warns you.</p></div>
</dd>
</dl></div>
</div></div>
<div class="paragraph"><p>Here are some typical multiarch package split scenarios for the following upstream source examples:</p></div>
<div class="ulist"><ul>
<li>
<p>
a library source <em>libfoo-1.0</em><strong>.tar.gz</strong>
</p>
</li>
<li>
<p>
a tool source <em>bar-1.0</em><strong>.tar.gz</strong> written in a compiled language
</p>
</li>
<li>
<p>
a tool source <em>baz-1.0</em><strong>.tar.gz</strong> written in an interpreted language
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="11%" />
<col width="16%" />
<col width="11%" />
<col width="44%" />
<thead>
<tr>
<th align="left" valign="top"><em>binarypackage</em>   </th>
<th align="left" valign="top"><em>type</em>   </th>
<th align="left" valign="top"><strong>Architecture:</strong></th>
<th align="left" valign="top"><strong>Multi-Arch:</strong>     </th>
<th align="left" valign="top">Package content</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>lib</strong><em>foo1</em></p></td>
<td align="left" valign="top"><p class="table"><strong>lib</strong><sup>*</sup></p></td>
<td align="left" valign="top"><p class="table">any</p></td>
<td align="left" valign="top"><p class="table">same</p></td>
<td align="left" valign="top"><p class="table">the shared library, co-installable</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>lib</strong><em>foo1</em><strong>-dbg</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>dbg</strong><sup>*</sup></p></td>
<td align="left" valign="top"><p class="table">any</p></td>
<td align="left" valign="top"><p class="table">same</p></td>
<td align="left" valign="top"><p class="table">the shared library debug symbols, co-installable</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>lib</strong><em>foo</em><strong>-dev</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>dev</strong><sup>*</sup></p></td>
<td align="left" valign="top"><p class="table">any</p></td>
<td align="left" valign="top"><p class="table">same</p></td>
<td align="left" valign="top"><p class="table">the shared library header files etc., co-installable</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>lib</strong><em>foo</em><strong>-tools</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>bin</strong><sup>*</sup></p></td>
<td align="left" valign="top"><p class="table">any</p></td>
<td align="left" valign="top"><p class="table">foreign</p></td>
<td align="left" valign="top"><p class="table">the run-time support programs, not co-installable</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>lib</strong><em>foo</em><strong>-doc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>doc</strong><sup>*</sup></p></td>
<td align="left" valign="top"><p class="table">all</p></td>
<td align="left" valign="top"><p class="table">foreign</p></td>
<td align="left" valign="top"><p class="table">the shared library documentation files</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><em>bar</em></p></td>
<td align="left" valign="top"><p class="table"><strong>bin</strong><sup>*</sup></p></td>
<td align="left" valign="top"><p class="table">any</p></td>
<td align="left" valign="top"><p class="table">foreign</p></td>
<td align="left" valign="top"><p class="table">the compiled program files, not co-installable</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><em>bar</em><strong>-doc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>doc</strong><sup>*</sup></p></td>
<td align="left" valign="top"><p class="table">all</p></td>
<td align="left" valign="top"><p class="table">foreign</p></td>
<td align="left" valign="top"><p class="table">the documentation files for the program</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><em>baz</em></p></td>
<td align="left" valign="top"><p class="table"><strong>script</strong></p></td>
<td align="left" valign="top"><p class="table">all</p></td>
<td align="left" valign="top"><p class="table">foreign</p></td>
<td align="left" valign="top"><p class="table">the interpreted program files</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>For the cases marked with <sup>*</sup> in the above table, the <em>type</em> values are guessed right from the package names.</p></div>
<div class="paragraph"><p>The default type is the <strong>bin</strong> type which means the compiled ELF binary executables.  This is why the example in <a href="#simple">[simple]</a> does not specify <strong>-b</strong> option.</p></div>
<div class="paragraph"><p>For programs written in other compiled languages, you may need to add its run-time library package dependency to the resulting binary package by adjusting the <strong>Depends:</strong> stanza of the <strong>debian/control</strong> file.</p></div>
<div class="paragraph"><p>The development package for the shared library should depend on it and should contain a version numberless symlink to it. E.g.: <strong>/usr/lib/x86_64-linux-gnu/</strong><em>libfoo</em><strong>.so</strong> &#8594; <em>libfoo</em><strong>.so.</strong><em>1</em></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">If any <strong>dbg</strong> type packages are to be generated, they should be made for all <strong>bin</strong> and <strong>lib</strong> type packages.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="changelog">debian/changelog</h3>
<div class="paragraph"><p>The <strong>debian/changelog</strong> file records the Debian package history and defines the upstream package version and the Debian revision in its first line.</p></div>
<div class="paragraph"><p>The <strong>debmake</strong> command creates the initial template file with the upstream package version and the Debian revision.  The distribution is set to <strong>UNRELEASED</strong> to prevent accidental upload to the Debian archive.</p></div>
<div class="paragraph"><p>The <strong>debchange</strong> command (alias <strong>dch</strong>) is used to edit this.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The date string used in the <strong>debian/changelog</strong> file can be manually generated by "<strong>LANG=C date -R</strong>".</td>
</tr></table>
</div>
<div class="paragraph"><p>This is installed in the <strong>/usr/share/doc/</strong><em>binarypackage</em> directory as <strong>changelog.Debian.gz</strong> by the <strong>dh_installchangelogs</strong>.</p></div>
<div class="paragraph"><p>The upstream changelog is installed in the <strong>/usr/share/doc/</strong><em>binarypackage</em> directory as <strong>changelog.gz</strong>.</p></div>
<div class="paragraph"><p>The upstream changelog is automatically found by the <strong>dh_installchangelogs</strong> using the case insensitive match of its file name to <strong>changelog</strong>, <strong>changes</strong>, <strong>changelog.txt</strong>, <strong>changes.txt</strong>, <strong>history</strong>, <strong>history.txt</strong>, or <strong>changelog.md</strong> and searched in the <strong>./</strong> <strong>doc/</strong>, or <strong>docs/</strong> directories.</p></div>
<div class="paragraph"><p>After finishing your packaging and verifying its quality, please execute the "<strong>dch -r</strong>" and save the finalized <strong>debian/changelog</strong> file with the distribution set to <strong>sid</strong>. <span class="footnote"><br />[If you are using the <strong>vim</strong> editor, save with the "<strong>:wq</strong>" command.]<br /></span></p></div>
</div>
<div class="sect2">
<h3 id="copyright">debian/copyright</h3>
<div class="paragraph"><p>Debian takes the copyright and license matters very seriously. The &#8220;Debian Policy Manual&#8221; enforces to have summary of them in the <strong>debian/copyright</strong> file in the package.</p></div>
<div class="paragraph"><p>You should format it as the <a href="http://www.debian.org/doc/packaging-manuals/copyright-format/1.0/">machine-readable debian/copyright file</a> (DEP-5).</p></div>
<div class="paragraph"><p>The <strong>debmake</strong> command creates the initial DEP-5 compatible template file by scanning the entire source tree.  It uses an internal license checker to classify each license text. <span class="footnote"><br />[The <strong>licensecheck</strong> command from the <strong>devscripts</strong> package was referenced to make this internal checker.]<br /></span></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">If you find issues with this license checker, please file a bug report to the <strong>debmake</strong> package with the problematic part of text containing the copyright and license.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="dfsg">DFSG</h3>
<div class="paragraph"><p>Debian takes software freedom seriously and follows the <a href="https://www.debian.org/social_contract.html#guidelines">DFSG</a>.</p></div>
<div class="paragraph"><p>The non-<a href="https://www.debian.org/social_contract.html#guidelines">DFSG</a> components in the upstream source tarball can be easily removed when the <strong>uscan</strong> command is used to update the Debian package.</p></div>
<div class="ulist"><ul>
<li>
<p>
List the files to be removed in the <strong>Files-Excluded</strong> stanza of the  <strong>debian/copyright</strong> file.
</p>
</li>
<li>
<p>
List the URL to download the upstream tarball in the <strong>debian/watch</strong> file.
</p>
</li>
<li>
<p>
Run the <strong>uscan</strong> command to download the new upstream tarball.
</p>
<div class="ulist"><ul>
<li>
<p>
Alternatively, use the "<strong>gbp import-orig --uscan --pristine-tar</strong>" command.
</p>
</li>
</ul></div>
</li>
<li>
<p>
The resulting tarball has the version number with an additional suffix <strong>+dfsg</strong>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="debianconf">Other debian/*</h3>
<div class="paragraph"><p>Optional configuration files may be added under the <strong>debian/</strong> directory.  Most of them are to control <strong>dh_</strong>* commands offered by the <strong>debhelper</strong> package but there are some for <strong>lintian</strong> and <strong>gbp</strong> commands.  Here is the alphabetical list of notable optional configuration files.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<em>binarypackage</em><strong>.bug-control</strong>  <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
installed as <strong>usr/share/bug/</strong><em>binarypackage</em><strong>/control</strong> in <em>binarypackage</em>. See <a href="#bug">[bug]</a>.
</p>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.bug-presubj</strong>  <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
installed as <strong>usr/share/bug/</strong><em>binarypackage</em><strong>/presubj</strong> in <em>binarypackage</em>. See <a href="#bug">[bug]</a>.
</p>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.bug-script</strong>  <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
installed as <strong>usr/share/bug/</strong><em>binarypackage</em> or <strong>usr/share/bug/</strong><em>binarypackage</em><strong>/script</strong> in <em>binarypackage</em>. See <a href="#bug">[bug]</a>.
</p>
</dd>
<dt class="hdlist1">
<strong>clean</strong> <sup><strong>-x2</strong></sup>
</dt>
<dd>
<p>
List files which should be removed but are not cleaned by the <strong>dh_auto_clean</strong> command.
</p>
<div class="paragraph"><p>See <strong>dh_auto_clean</strong>(1) and <strong>dh_clean</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<strong>compat</strong> <sup><strong>-x1</strong></sup>
</dt>
<dd>
<p>
Set the <strong>debhelper</strong> compatibility level (currently, "<strong>9</strong>").
</p>
<div class="paragraph"><p>See &#8220;COMPATIBILITY LEVELS&#8221; in <strong>debhelper</strong>(8).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.conffile</strong>
</dt>
<dd>
<p>
No need for this file under compat &gt;= 3  since all files in the <strong>etc/</strong> directory are conffiles.
</p>
<div class="paragraph"><p>See <strong>dh_installdeb</strong>(1).</p></div>
<div class="paragraph"><p>If the program you&#8217;re packaging requires every user to modify the configuration files in the <strong>/etc</strong> directory, there are two popular ways to arrange for them to not be conffiles, keeping the <strong>dpkg</strong> command happy and quiet.</p></div>
<div class="ulist"><ul>
<li>
<p>
Create a symlink under the <strong>/etc</strong> directory pointing to a file under the <strong>/var</strong> directory generated by the maintainer scripts.
</p>
</li>
<li>
<p>
Create a file generated by the maintainer scripts under the <strong>/etc</strong> directory.
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.config</strong>
</dt>
<dd>
<p>
This is the <strong>debconf</strong> <strong>config</strong> script used for asking any questions necessary to configure the package.  See <a href="#debconf">[debconf]</a>.
</p>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.cron.hourly</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
Installed into the <strong>etc/cron/hourly/</strong><em>binarypackage</em> file in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installcron</strong>(1) and <strong>cron</strong>(8).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.cron.daily</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
Installed into the <strong>etc/cron/daily/</strong><em>binarypackage</em> file in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installcron</strong>(1) and <strong>cron</strong>(8).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.cron.weekly</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
Installed into the <strong>etc/cron/weekly/</strong><em>binarypackage</em> file in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installcron</strong>(1) and <strong>cron</strong>(8).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.cron.monthly</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
Installed into the <strong>etc/cron/monthly/</strong><em>binarypackage</em> file in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installcro</strong>*(1) and <strong>cron</strong>(8).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.cron.d</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
Installed into the <strong>etc/cron.d/</strong><em>binarypackage</em> file in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installcron</strong>(1), <strong>cron</strong>(8), and <strong>crontab</strong>(5).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.default</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
If this exists, it is installed into <strong>etc/default/</strong><em>binarypackage</em> in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installinit</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.dirs</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
List directories to be created in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installdirs</strong>(1).</p></div>
<div class="paragraph"><p>Usually, this is not needed since all <strong>dh_install</strong>* commands create required directories automatically.  Use this only when you run into trouble.</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.doc-base</strong> <sup><strong>-x2</strong></sup>
</dt>
<dd>
<p>
Installed as the <strong>doc-base</strong> control file in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installdocs</strong>(1) and <a href="file:///usr/share/doc/doc-base/doc-base.html/index.html">Debian doc-base Manual</a> provided by the <strong>doc-base</strong> package.</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.docs</strong> <sup><strong>-x2</strong></sup>
</dt>
<dd>
<p>
List documentation files to be installed in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installdocs</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.emacsen-compat</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
Installed into <strong>usr/lib/emacsen-common/packages/compat/</strong><em>binarypackage</em> in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installemacsen</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.emacsen-install</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
Installed into <strong>usr/lib/emacsen-common/packages/install/</strong><em>binarypackage</em> in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installemacsen</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.emacsen-remove</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
Installed into <strong>usr/lib/emacsen-common/packages/remove/</strong><em>binarypackage</em> in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installemacsen</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.emacsen-startup</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
Installed into <strong>usr/lib/emacsen-common/packages/startup/</strong><em>binarypackage</em> in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installemacsen</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.examples</strong> <sup><strong>-x2</strong></sup>
</dt>
<dd>
<p>
List example files or directories to be installed into <strong>usr/share/doc/</strong><em>binarypackage</em><strong>/examples/</strong> in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installexamples</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<strong>gbp.conf</strong>
</dt>
<dd>
<p>
If this exists, it functions as the configuration file for the <strong>gbp</strong> command.
</p>
<div class="paragraph"><p>See <strong>gbp.conf</strong>(5), <strong>gbp</strong>(1), and <strong>git-buildpackage</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.info</strong> <sup><strong>-x2</strong></sup>
</dt>
<dd>
<p>
List info files to be installed in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installinfo</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.init</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
Installed into <strong>etc/init.d/</strong><em>binarypackage</em> in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_installinit</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.install</strong> <sup><strong>-x2</strong></sup>
</dt>
<dd>
<p>
List files which should be installed but are not installed by the <strong>dh_auto_install</strong> command.
</p>
<div class="paragraph"><p>See <strong>dh_install</strong>(1) and <strong>dh_auto_install</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<strong>license-examples/</strong>* <sup><strong>-x4</strong></sup>
</dt>
<dd>
<p>
These are copyright file examples generated by the <strong>debmake</strong> command.  Use these as the reference for making <strong>copyright</strong> file.
</p>
<div class="paragraph"><p>Please make sure to erase these files.</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.links</strong> <sup><strong>-x2</strong></sup>
</dt>
<dd>
<p>
List pairs of source and destination files to be symlinked. Each pair should be put on its own line, with the source and destination separated by the whitespace.
</p>
<div class="paragraph"><p>See <strong>dh_link</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.lintian-overrides</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
Installed into <strong>usr/share/lintian/overrides/</strong><em>binarypackage</em> in the package build directory. This file is used to suppress erroneous <strong>lintian</strong> diagnostics.
</p>
<div class="paragraph"><p>See <strong>dh_lintian</strong>(1) and <strong>lintian</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<strong>manpage.</strong>* <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
These are manpage template files generated by the <strong>debmake</strong> command.  Please rename these to appropriate file names and update their contents.
</p>
<div class="paragraph"><p>Debian Policy requires that each program, utility, and function should have an associated manual page included in the same package. Manual pages are written in <strong>nroff</strong>(1).</p></div>
<div class="paragraph"><p>If you are new to making manpage, use <strong>manpage.asciidoc</strong> or <strong>manpage.1</strong> as the starting point.</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.manpages</strong> <sup><strong>-x2</strong></sup>
</dt>
<dd>
<p>
List man pages to be installed.
</p>
<div class="paragraph"><p>See <strong>dh_installman</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.menu</strong> <sup><strong>-x2</strong></sup>
</dt>
<dd>
<p>
Debian menu file installed into <strong>usr/share/menu/</strong><em>binarypackage</em> in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>menufile</strong>(5) for its format.  See <strong>dh_installmenu</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<strong>NEWS</strong>
</dt>
<dd>
<p>
Installed into <strong>usr/share/doc/</strong><em>binarypackage</em><strong>/NEWS.Debian</strong>.
</p>
<div class="paragraph"><p>See <strong>dh_installchangelogs</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<strong>patches/</strong>*
</dt>
<dd>
<p>
Collection of <strong>-p1</strong> patch files which are applied to the upstream source before building the source.
</p>
<div class="paragraph"><p>See dpkg-source(8), <a href="#quilt">[quilt]</a> and <a href="#modpkg">[modpkg]</a>.</p></div>
<div class="paragraph"><p>No patch files are generated by the <strong>debmake</strong> command.</p></div>
</dd>
<dt class="hdlist1">
<strong>patches/series</strong> <sup><strong>-x1</strong></sup>
</dt>
<dd>
<p>
The application sequence of the <strong>patches/</strong>* patch files.
</p>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.preinst</strong> <sup><strong>-x2</strong></sup>
</dt>
<dt class="hdlist1">
<em>binarypackage</em><strong>.postinst</strong> <sup><strong>-x2</strong></sup>
</dt>
<dt class="hdlist1">
<em>binarypackage</em><strong>.prerm</strong> <sup><strong>-x2</strong></sup>
</dt>
<dt class="hdlist1">
<em>binarypackage</em><strong>.postrm</strong> <sup><strong>-x2</strong></sup>
</dt>
<dd>
<p>
These maintainer scripts are installed into the <strong>DEBIAN</strong> directory.
</p>
<div class="paragraph"><p>Inside the scripts, the token <strong>#DEBHELPER#</strong> is replaced with shell script snippets generated by other <strong>debhelper</strong> commands.</p></div>
<div class="paragraph"><p>See <strong>dh_installdeb</strong>(1) and <a href="http://www.debian.org/doc/debian-policy/ch-maintainerscripts.html">Chapter 6 - Package maintainer scripts and installation procedure</a> of the &#8220;Debian Policy Manual&#8221;.</p></div>
<div class="paragraph"><p>See also <strong>debconf-devel</strong>(7) and <a href="http://www.debian.org/doc/debian-policy/ch-binary.html#s-maintscriptprompt">3.9.1 Prompting in maintainer scripts</a> of the &#8220;Debian Policy Manual&#8221;.</p></div>
</dd>
<dt class="hdlist1">
<strong>README.Debian</strong> <sup><strong>-x1</strong></sup>
</dt>
<dd>
<p>
Installed into the first binary package listed in the <strong>debian/control</strong> file as <strong>usr/share/doc/</strong><em>binarypackage</em><strong>/README.Debian</strong>.
</p>
<div class="paragraph"><p>See <strong>dh_installdocs</strong>(1).</p></div>
<div class="paragraph"><p>This file provides the information specific to the Debian package.</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.service</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
If this exists, it is installed into <strong>lib/systemd/system/</strong><em>binarypackage</em><strong>.service</strong> in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_systemd_enable</strong>(1), <strong>dh_systemd_start</strong>(1), and <strong>dh_installinit</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<strong>source/format</strong> <sup><strong>-x1</strong></sup>
</dt>
<dd>
<p>
The Debian package format.
</p>
<div class="ulist"><ul>
<li>
<p>
Use "<strong>3.0 (quilt)</strong>" to make this non-native package (recommended)
</p>
</li>
<li>
<p>
Use "<strong>3.0 (native)</strong>" to make this native package
</p>
<div class="paragraph"><p>See &#8220;SOURCE PACKAGE FORMATS&#8221; in <strong>dpkg-source</strong>(8).</p></div>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
<strong>source/lintian-overrides</strong> or <strong>source.lintian-overrides</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
These files are not installed, but will be scanned by the <strong>lintian</strong> command to provide overrides for the source package.
</p>
<div class="paragraph"><p>See <strong>dh_lintian</strong>(1) and <strong>lintian</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<strong>source/local-options</strong> <sup><strong>-x1</strong></sup>
</dt>
<dd>
<p>
This is not included in the generated source package but committed to the VCS for its smooth operation.
</p>
<div class="paragraph"><p>See &#8220;FILE FORMATS&#8221; in <strong>dpkg-source</strong>(8).</p></div>
</dd>
<dt class="hdlist1">
<strong>source/options</strong>
</dt>
<dd>
<p>
See the <strong>dpkg-source</strong>(1) manpage under "FILE FORMATS" to learn about the package formats and the patch mechanisms.
</p>
<div class="paragraph"><p>See &#8220;FILE FORMATS&#8221; in <strong>dpkg-source</strong>(8).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.symbols</strong> <sup><strong>-x2</strong></sup>
</dt>
<dd>
<p>
The symbols files, if present, are passed to the <strong>dpkg-gensymbols</strong> command to be processed and installed.
</p>
<div class="paragraph"><p>See <strong>dh_makeshlibs</strong>(1) and <a href="#symbols">[symbols]</a>..</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.templates</strong>
</dt>
<dd>
<p>
This is the <strong>debconf</strong> <strong>templates</strong> file used for asking any questions necessary to configure the package.  See <a href="#debconf">[debconf]</a>.
</p>
</dd>
<dt class="hdlist1">
<strong>tests/control</strong>
</dt>
<dd>
<p>
This is the RFC822-style test metadata file defined in <a href="http://dep.debian.net/deps/dep8/">DEP-8</a>.  See <strong>adt-run</strong>(1) and <a href="#ci">[ci]</a>.
</p>
</dd>
<dt class="hdlist1">
<strong>TODO</strong>
</dt>
<dd>
<p>
Installed into the first binary package listed in the <strong>debian/control</strong> file as <strong>usr/share/doc/</strong><em>binarypackage</em><strong>/TODO.Debian</strong>.
</p>
<div class="paragraph"><p>See <strong>dh_installdocs</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.tmpfile</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
If this exists, it is installed into <strong>usr/lib/tmpfiles.d/</strong><em>binarypackage</em><strong>.conf</strong> in <em>binarypackage</em>.
</p>
<div class="paragraph"><p>See <strong>dh_systemd_enable</strong>(1), <strong>dh_systemd_start</strong>(1), and <strong>dh_installinit</strong>(1).</p></div>
</dd>
<dt class="hdlist1">
<em>binarypackage</em><strong>.upstart</strong> <sup><strong>-x3</strong></sup>
</dt>
<dd>
<p>
If this exists, it is installed into etc/init/package.conf in the package build directory.
</p>
<div class="paragraph"><p>See <strong>dh_installinit</strong>(1) and <a href="#emptypkg">[emptypkg]</a>.</p></div>
</dd>
<dt class="hdlist1">
<strong>watch</strong> <sup><strong>-x1</strong></sup>
</dt>
<dd>
<p>
The control file for the <strong>uscan</strong> command to download the latest upstream version
</p>
<div class="paragraph"><p>This control file may be configured to verify the authenticity of the tarball using its GPG signature (see <a href="#signing-key">[signing-key]</a>).</p></div>
<div class="paragraph"><p>See <a href="#dfsg">[dfsg]</a> and <strong>uscan</strong>(1).</p></div>
</dd>
</dl></div>
<div class="paragraph"><p>Here are a few reminders to the above list.</p></div>
<div class="ulist"><ul>
<li>
<p>
For the single binary package, <em>binarypackage</em><strong>.</strong> part of the filename in the list may be removed.
</p>
</li>
<li>
<p>
For the multi binary package, configuration file missing <em>binarypackage</em><strong>.</strong> part of the filename is applied to the first binary package listed in the <strong>debian/control</strong>.
</p>
</li>
<li>
<p>
When there are many binary packages, their configurations can be specified independently by prefixing their name to their configuration filenames such as <em>package-1</em><strong>.install</strong>, <em>package-2</em><strong>.install</strong>, etc.
</p>
</li>
<li>
<p>
Configuration template filenames with <sup><strong>-x1</strong></sup>, <sup><strong>-x2</strong></sup>, <sup><strong>-x3</strong></sup>, or <sup><strong>-x4</strong></sup> in the above mean that they are generated by the <strong>debmake</strong> command with that <strong>-x</strong> option (see <a href="#xoption">[xoption]</a>).
</p>
</li>
<li>
<p>
Some template configuration files may not be created by the <strong>debmake</strong> command. In such cases, you need to create them with an editor.
</p>
</li>
<li>
<p>
Unusual configuration template files generated by the <strong>debmake</strong> command with the extra <strong>.ex</strong> suffix needs to be activated by removing that suffix.
</p>
</li>
<li>
<p>
Unused configuration template files generated by the <strong>debmake</strong> command should be removed.
</p>
</li>
<li>
<p>
Copy configuration template files as needed to the filenames matching their pertinent binary package names.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="signing-key">signing-key.pgp</h3>
<div class="paragraph"><p>Some packages are signed by the GPG key.</p></div>
<div class="paragraph"><p>For example, <a href="http://www.gnu.org/software/hello/">GNU hello</a> can be downloaded via HTTP from <a href="http://ftp.gnu.org/gnu/hello/">http://ftp.gnu.org/gnu/hello/</a> .  There are sets of files:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>hello-</strong><em>version</em><strong>.tar.gz</strong> (upstream source)
</p>
</li>
<li>
<p>
<strong>hello-</strong><em>version</em><strong>.tar.gz.sig</strong> (detached signature)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let&#8217;s pick the latest version set.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ wget http://ftp.gnu.org/gnu/hello/hello-2.9.tar.gz
 ...
$ wget http://ftp.gnu.org/gnu/hello/hello-2.9.tar.gz.sig
 ...
$ gpg --verify hello-2.9.tar.gz.sig
gpg: Signature made Thu 10 Oct 2013 08:49:23 AM JST using DSA key ID 80EE4A00
gpg: Can't check signature: public key not found</code></pre>
</div></div>
<div class="paragraph"><p>If you know the public GPG key of the upstream from the mailing list, use it as the <strong>debian/upstream/signing-key.pgp</strong> file.  Otherwise, use the hkp keyserver and check it via your <a href="http://en.wikipedia.org/wiki/Web_of_trust">web of trust</a>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-key 80EE4A00
gpg: requesting key 80EE4A00 from hkp server keyserver.ubuntu.com
gpg: key 80EE4A00: public key "Reuben Thomas &lt;rrt@sc3d.org&gt;" imported
gpg: no ultimately trusted keys found
gpg: Total number processed: 1
gpg:               imported: 1
$ gpg --verify hello-2.9.tar.gz.sig
gpg: Signature made Thu 10 Oct 2013 08:49:23 AM JST using DSA key ID 80EE4A00
gpg: Good signature from "Reuben Thomas &lt;rrt@sc3d.org&gt;"
  ...
Primary key fingerprint: 9297 8852 A62F A5E2 85B2  A174 6808 9F73 80EE 4A00</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Here "<strong>hkp://keyserver.ubuntu.com:80</strong>" is used to avoid the firewall policy blocking HPK port <strong>11371</strong>.</td>
</tr></table>
</div>
<div class="paragraph"><p>After confirming the key ID <strong>80EE4A00</strong> is trust worthy one, download its public key into the <strong>debian/upstream/signing-key.pgp</strong> file.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ gpg --armor --export 80EE4A00 &gt;debian/upstream/signing-key.pgp</code></pre>
</div></div>
<div class="paragraph"><p>Then set the corresponding <strong>debian/watch</strong> file as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>version=3
pgpsigurlmangle=s/$/.sig/  http://ftp.gnu.org/gnu/hello/ hello-(\d[\d.]*)\.tar\.(?:gz|bz2|xz)</code></pre>
</div></div>
<div class="paragraph"><p>Now the <strong>uscan</strong> command will check the authenticity of the package using the GPG signature.</p></div>
</div>
<div class="sect2">
<h3 id="custom">Package customization</h3>
<div class="paragraph"><p>Some upstream sources do not behave well and you may need to add customization to the build system of those upstream sources.</p></div>
<div class="paragraph"><p>The package should be customized by the least invasive way to address the root cause of the Debian packaging problem.  Your packaging shall be more robust for the future upgrades in this way.  (You should also solve the root cause of the problem and send its patch to the upstream.)</p></div>
<div class="paragraph"><p>Here, there are a few technical approaches to customize the build system:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>patches/</strong>* approach
</p>
</li>
<li>
<p>
<strong>debian/rules</strong> approach
</p>
</li>
<li>
<p>
<strong>debian/</strong><em>bianrypackage</em>.* approach
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="patchapproach">patches/* approach</h4>
<div class="paragraph"><p>Modifications to the upstream source before building it can be done by placing the collection of the <strong>-p1</strong> patches in the <strong>patches/</strong> directory and applying them in sequence defined in the  <strong>patches/series</strong> file.</p></div>
<div class="paragraph"><p>There are several methods to prepare the required <strong>-p1</strong> patches for this.</p></div>
<div class="ulist"><ul>
<li>
<p>
The <strong>diff</strong> command (manual)
</p>
</li>
<li>
<p>
The "<strong>git format-patches</strong>" command (manual for the git repository)
</p>
</li>
<li>
<p>
The <strong>dquilt</strong> command (manual, elegant) (alias of the <strong>quilt</strong> command, see <a href="#quilt">[quilt]</a>)
</p>
</li>
<li>
<p>
The <strong>gbp-pq</strong> command (specialized, simple)
</p>
</li>
<li>
<p>
The <strong>git-dpm</strong> command (specialized, elegant)
</p>
</li>
<li>
<p>
Patches used in other distros and floating on the mailing list
</p>
</li>
<li>
<p>
&#8230;
</p>
</li>
</ul></div>
<div class="paragraph"><p>Wherever these patches come from, it is good idea to tag them with <a href="http://dep.debian.net/deps/dep3/">DEP-3</a> compatible header.</p></div>
<div class="paragraph"><p>These patches should apply cleanly.  You must normalize them by the <strong>dquilt</strong> command (see <a href="#quilt">[quilt]</a>).</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ while dquilt push; do dquilt refresh ; done
 $ dquilt pop -a</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Don&#8217;t forget to normalize patches when you upgrade to the new upstream source or import the externally generated patches.</td>
</tr></table>
</div>
<div class="paragraph"><p>See  <a href="#modpkg">[modpkg]</a> for example.</p></div>
</div>
<div class="sect3">
<h4 id="rulesapproach">debian/rules approach</h4>
<div class="paragraph"><p>The customization to the Debian package build system can be done through the <strong>debian/rules</strong> file.</p></div>
<div class="paragraph"><p>See <a href="#customrules">[customrules]</a>.</p></div>
</div>
<div class="sect3">
<h4 id="configapproach">debian/binarypackage.* approach</h4>
<div class="paragraph"><p>Add customized configuration files for the <strong>dh_</strong>* command from the <strong>debhelper</strong> package in the <strong>debian/</strong> directory.</p></div>
<div class="paragraph"><p>See <a href="#debianconf">[debianconf]</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="build">Upstream build systems</h3>
<div class="paragraph"><p>Upstream build systems are designed to go through several steps to install generated binary files to the system from the source distribution.</p></div>
<div class="sect3">
<h4 id="autotools">Autotools</h4>
<div class="paragraph"><p>Autotools (<strong>autoconf</strong> + <strong>automake</strong>) has 4 steps.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
setup the build system ("<strong>vim configure.ac Makefile.am</strong>" and "<strong>autoreconf -ivf</strong>")
</p>
</li>
<li>
<p>
configure the build system ("<strong>./configure</strong>")
</p>
</li>
<li>
<p>
build the source tree ("<strong>make</strong>")
</p>
</li>
<li>
<p>
install the binary files ("<strong>make install</strong>")
</p>
</li>
</ol></div>
<div class="paragraph"><p>The upstream usually performs the step 1 and builds the upstream tarball for distribution using the "<strong>make dist</strong>" command.   (The generated tarball contains not only the pristine upstream VCS contents but also other generated files.)</p></div>
<div class="paragraph"><p>The package maintainer needs to take care step 2 to 4 at least.  This is realized by the "<strong>dh $@ --with autotools-dev</strong>" command used in the <strong>debian/rules</strong> file.</p></div>
<div class="paragraph"><p>The package maintainer wishes to take care step 1 to 4.  This is realized by the "<strong>dh $@ --with autoreconf</strong>" command used in the <strong>debian/rules</strong> file.  This rebuilds all auto-generated files to the latest version and provides better porting supports.</p></div>
</div>
<div class="sect3">
<h4 id="python">Python distutils</h4>
<div class="paragraph"><p>Python distutils has 3 steps.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
setup and configure the build system ("<strong>vim setup.py</strong>")
</p>
</li>
<li>
<p>
build the source tree ("<strong>python setup.py build</strong>")
</p>
</li>
<li>
<p>
install the binary files ("<strong>python setup.py install</strong>")
</p>
</li>
</ol></div>
<div class="paragraph"><p>The upstream usually performs the step 1 and builds the upstream tarball for distribution using the "<strong>python setup.py sdist</strong>" command.</p></div>
<div class="paragraph"><p>The package maintainer needs to take care step 2.  This is realized simply by the "<strong>dh $@</strong>" command used in the <strong>debian/rules</strong> file, after <strong>jessie</strong>.</p></div>
<div class="paragraph"><p>The situation of other build systems, such as CMake, are very similar to this Python one.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_debugging_information">Debugging information</h3>
<div class="paragraph"><p>The Debian package is build with the debugging information but packaged into the binary package after stripping the debugging information as required by <a href="https://www.debian.org/doc/debian-policy/ch-files.html">Chapter 10 - Files</a> of the &#8220;Debian Policy Manual&#8221;.</p></div>
<div class="paragraph"><p>The debugging information can be packaged separately as the debug packege using the "<strong>dh_strip --dbg-package=</strong><em>package</em>" command in the <strong>override_dh_strip:</strong> target of the <strong>debian/rules</strong> file.</p></div>
<div class="paragraph"><p>The installation path of the debugging information is as follows to enable auto-loading of it by the <strong>gdb</strong> command.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>/usr/lib/debug/.build-id/</strong><em>12/3456&#8230;</em> (compat&gt;=9, for <strong>buildID</strong>=<em>123456&#8230;</em>)
</p>
</li>
<li>
<p>
<strong>/usr/lib/debug/</strong><em>path/to/binary</em> (compat&lt;&lt;9, for <em>/path/to/binary</em>)
</p>
</li>
</ul></div>
<div class="paragraph"><p>See</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.debian.org/doc/manuals/developers-reference/best-pkging-practices.html#bpp-dbg">6.7.9. Best practices for debug packages</a> of the &#8220;Debian Developer&#8217;s Reference&#8221;.
</p>
</li>
<li>
<p>
<a href="https://sourceware.org/gdb/current/onlinedocs/gdb/Separate-Debug-Files.html#Separate-Debug-Files">18.2 Debugging Information in Separate Files</a> of the &#8220;Debugging with gdb&#8221;
</p>
</li>
<li>
<p>
<strong>dh_strip</strong>(1)
</p>
</li>
<li>
<p>
<strong>strip</strong>(1)
</p>
</li>
<li>
<p>
<strong>readelf</strong>(1)
</p>
</li>
<li>
<p>
<strong>objcopy</strong>(1)
</p>
</li>
<li>
<p>
Debian wiki <a href="https://wiki.debian.org/DebugPackage">DebugPackage</a>
</p>
</li>
<li>
<p>
Debian wiki <a href="https://wiki.debian.org/AutomaticDebugPackages">AutomaticDebugPackages</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_library_package">Library package</h3>
<div class="paragraph"><p>Packaging the library software requires you to perform much more work than usual.  Here are some reminders for packaging the library software:</p></div>
<div class="ulist"><ul>
<li>
<p>
Debian ships shared library such as <strong>/usr/lib/&lt;triplet&gt;/lib</strong><em>foo-0.1</em><strong>.so.</strong><em>1.0.0</em> (see <a href="#multiarch">[multiarch]</a>).
</p>
</li>
<li>
<p>
Debian encourages to use versioned symbols in the shared library (see <a href="#symbols">[symbols]</a>).
</p>
</li>
<li>
<p>
Debian doesn&#8217;t ship <strong>*.la</strong>  libtool library archive files.
</p>
</li>
<li>
<p>
Debian discourages to use and ship <strong>*.a</strong> static library files.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Before packaging the shared library software, see:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://www.debian.org/doc/debian-policy/ch-sharedlibs.html">Chapter 8 - Shared libraries</a> of the &#8220;Debian Policy Manual&#8221;
</p>
</li>
<li>
<p>
<a href="https://www.debian.org/doc/debian-policy/ch-files.html">10.2 Libraries</a> of the &#8220;Debian Policy Manual&#8221;
</p>
</li>
<li>
<p>
<a href="https://www.debian.org/doc/manuals/developers-reference/best-pkging-practices.html#bpp-libraries">6.7.2. Libraries</a> of the &#8220;Debian Developer&#8217;s Reference&#8221;
</p>
</li>
</ul></div>
<div class="paragraph"><p>For the historic background study, see:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://debconf4.debconf.org/talks/dependency-hell/img1.html">Escaping the Dependency Hell</a> <span class="footnote"><br />[This document was written before the introduction of the <strong>symbols</strong> file.]<br /></span>
</p>
<div class="ulist"><ul>
<li>
<p>
This encourages to have versioned symbols in the shared library.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<a href="http://www.netfort.gr.jp/<sub>dancer/column/libpkg-guide/libpkg-guide.html">Debian Library Packaging guide</a> <span class="footnote"><br />[The strong preference to use the SONAME versioned <strong>-dev</strong> package names over the single <strong>-dev</strong> package name in its <a href="http://www.netfort.gr.jp/</sub>dancer/column/libpkg-guide/libpkg-guide.html#devpkg">Chapter 6. Development (-DEV) packages</a> does not seem to be shared by the ftp-master (Steve Langasek). This document was written before the introduction of the <strong>multiarch</strong> system and the <strong>symbols</strong> file.]<br /></span>
</p>
<div class="ulist"><ul>
<li>
<p>
Please read the discussion thread following <a href="https://lists.debian.org/debian-devel/2004/06/msg00069.html">its announcenent</a>, too.
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="multiarch">Multiarch</h3>
<div class="paragraph"><p>The multiarch support for cross-architecture installation of binary packages (particularly <strong>i386</strong> <-> <strong>amd64</strong>, but also other combinations) in the <strong>dpkg</strong> and <strong>apt</strong> packages introduced to Debian <strong>wheezy</strong> (7.0, May 2013) demands us to pay extra attention for the packaging.</p></div>
<div class="paragraph"><p>You should read the following references in detail.</p></div>
<div class="ulist"><ul>
<li>
<p>
Ubuntu wiki (upstream)
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="https://wiki.ubuntu.com/MultiarchSpec">MultiarchSpec</a>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Debian wiki (Debian situation)
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="https://wiki.debian.org/Multiarch">Debian multiarch support</a>
</p>
</li>
<li>
<p>
<a href="https://wiki.debian.org/Multiarch/Implementation">Multiarch/Implementation</a>
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>The multiarch is enabled by using the <strong>&lt;triplet&gt;</strong> value such as <strong>i386-linux-gnu</strong> and <strong>x86_64-linux-gnu</strong> in the the install path of shared libraries as <strong>/usr/lib/&lt;triplet&gt;/</strong>, etc.. The actual <strong>&lt;triplet&gt;</strong> value is dynamically set into the <strong>$(DEB_HOST_MULTIARCH)</strong> variable by the <strong>dpkg-architecture</strong> command for each build.  The inclusion of <strong>/usr/share/dpkg/architecture.mk</strong> in the <strong>debian/rules</strong> file as described in <a href="#variablesrules">[variablesrules]</a> ensures to set the <strong>$(DEB_HOST_MULTIARCH)</strong> variable even when running <strong>debian/rules</strong> directly without the <strong>dpkg-buildpackage</strong> command.</p></div>
<div class="sect3">
<h4 id="_the_multiarch_library_path">The multiarch library path</h4>
<div class="paragraph"><p>Debian policy requires to follow <a href="https://www.debian.org/doc/packaging-manuals/fhs/fhs-2.3.html">Filesystem Hierarchy Standard</a>.  Its <a href="https://www.debian.org/doc/packaging-manuals/fhs/fhs-2.3.html#USRLIBLIBRARIESFORPROGRAMMINGANDPA">/usr/lib : Libraries for programming and packages</a> states "<strong>/usr/lib</strong> includes object files, libraries, and internal binaries that are not intended to be executed directly by users or shell scripts."</p></div>
<div class="paragraph"><p>Debian policy makes an exception to <a href="https://www.debian.org/doc/packaging-manuals/fhs/fhs-2.3.html">Filesystem Hierarchy Standard</a> to use <strong>/usr/lib/&lt;triplet&gt;/</strong> instead of <strong>/usr/lib&lt;qual&gt;/</strong> (e.g., <strong>/lib32/</strong> and <strong>/lib64/</strong>) to support the multiarch library.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1. The multiarch library path options</caption>
<col width="25%" />
<col width="37%" />
<col width="37%" />
<thead>
<tr>
<th align="left" valign="top">Classic path   </th>
<th align="left" valign="top">i386 multiarch path            </th>
<th align="left" valign="top">amd64 multiarch path</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>/lib/</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>/lib/i386-linux-gnu/</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>/lib/x86_64-linux-gnu/</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>/usr/lib/</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>/usr/lib/i386-linux-gnu/</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>/usr/lib/x86_64-linux-gnu/</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>For Autotools based packages under the <strong>debhelper</strong> package (compat&gt;=9), this path setting is automatically taken care by the <strong>dh_auto_configure</strong> command.</p></div>
<div class="paragraph"><p>For other packages with non-supported build systems, you need to manually adjust the install path as follows.</p></div>
<div class="ulist"><ul>
<li>
<p>
If <strong>./configure</strong> is used in the part of <strong>override_dh_auto_configure</strong> target in <strong>debian/rules</strong>, make sure to replace it with "<strong>dh_auto_configure --</strong>" while re-targeting the install path from <strong>/usr/lib/</strong> to <strong>/usr/lib/$(DEB_HOST_MULTIARCH)/</strong>.
</p>
</li>
<li>
<p>
Replace all occurrences of <strong>/usr/lib/</strong> with <strong>/usr/lib/*/</strong> in <strong>debian/</strong><em>foo</em><strong>.install</strong> files.
</p>
</li>
</ul></div>
<div class="paragraph"><p>All files installed simultaneously as the multiarch package to the same file path should have exactly the same file content. You must be careful on differences generated by the data byte order and by the compression algorithm.</p></div>
<div class="paragraph"><p>Please note that <strong>--libexecdir</strong> specifies the default path to install executable programs run by other programs rather than by users. Its Autotools default is <strong>/usr/libexec/</strong> but its Debian default is <strong>/usr/lib/</strong>.  If such executable is "Multi-arch: foreign" package, path such as <strong>/usr/lib/</strong> or <strong>/usr/lib/</strong><em>packagename</em> may be more desirable than <strong>/usr/lib/&lt;triplet&gt;/</strong> which <strong>dh_auto_configure</strong> uses.</p></div>
<div class="paragraph"><p>Please also note that the <a href="http://www.gnu.org/prep/standards/html_node/Directory-Variables.html">GNU Coding Standards: 7.2.5 Variables for Installation Directories</a> has description for <strong>libexecdir</strong> as "The definition of <strong>libexecdir</strong> is the same for all packages, so you should install your data in a subdirectory thereof. Most packages install their data under <strong>$(libexecdir)/package-name/</strong> &#8230;". (It is always good idea to follow GNU unless it conflicts with the Debian policy)</p></div>
<div class="paragraph"><p>The shared library files in the default path <strong>/usr/lib/</strong> and <strong>/usr/lib/&lt;triplet&gt;/</strong> are loaded automatically.</p></div>
<div class="paragraph"><p>For the shared library files in the other path, GCC option <strong>-l</strong> must be set by the <strong>pkg-config</strong> command to make them loaded properly.</p></div>
</div>
<div class="sect3">
<h4 id="_the_multiarch_header_file_path">The multiarch header file path</h4>
<div class="paragraph"><p>GCC includes both <strong>/usr/include/</strong> and <strong>/usr/include/&lt;triplet&gt;/</strong> by default on the multiarch Debian system.</p></div>
<div class="paragraph"><p>If the header file is not in those paths, GCC option <strong>-I</strong> must be set by the <strong>pkg-config</strong> command to make "<strong>#include &lt;</strong><em>foo.h</em><strong>&gt;</strong>" work properly.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 2. The multiarch header file path options</caption>
<col width="25%" />
<col width="37%" />
<col width="37%" />
<thead>
<tr>
<th align="left" valign="top">Classic path   </th>
<th align="left" valign="top">i386 multiarch path            </th>
<th align="left" valign="top">amd64 multiarch path</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>/usr/include/</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>/usr/include/i386-linux-gnu/</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>/usr/include/x86_64-linux-gnu/</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>/usr/include/</strong><em>packagename</em><strong>/</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>/usr/include/i386-linux-gnu/</strong><em>packagename</em><strong>/</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>/usr/include/x86_64-linux-gnu/</strong><em>packagename</em><strong>/</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table"><strong>/usr/lib/i386-linux-gnu/</strong><em>packagename</em><strong>/</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>/usr/lib/x86_64-linux-gnu/</strong><em>packagename</em><strong>/</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>The use if the <strong>/usr/lib/&lt;triplet&gt;/</strong><em>packagename</em><strong>/</strong> path for the header files allows the upstream to use the same install script for the multiatch system with <strong>/usr/lib/&lt;triplet&gt;</strong> and the biarch system with <strong>/usr/lib&lt;qual&gt;/</strong>. <span class="footnote"><br />[This path is compliant to the FHS.  <a href="https://www.debian.org/doc/packaging-manuals/fhs/fhs-2.3.html#USRLIBLIBRARIESFORPROGRAMMINGANDPA">Filesystem Hierarchy Standard: /usr/lib : Libraries for programming and packages</a> states "Applications may use a single subdirectory under <strong>/usr/lib</strong>. If an application uses a subdirectory, all architecture-dependent data exclusively used by the application must be placed within that subdirectory."]<br /></span></p></div>
<div class="paragraph"><p>The use of the file path containing <em>packagename</em> enables to have more than 2 development libraries simultaneously installed on a system.</p></div>
</div>
<div class="sect3">
<h4 id="_the_multiarch_strong_pc_strong_file_path">The multiarch <strong>*.pc</strong> file path</h4>
<div class="paragraph"><p>The <strong>pkg-config</strong> program is used to retrieve information about installed libraries in the system.  It stores its configuration parameters in the <strong>*.pc</strong> file and is used for setting the <strong>-I</strong> and <strong>-l</strong> options for GCC.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 3. The <strong>*.pc</strong> file path options</caption>
<col width="25%" />
<col width="37%" />
<col width="37%" />
<thead>
<tr>
<th align="left" valign="top">Classic path   </th>
<th align="left" valign="top">i386 multiarch path            </th>
<th align="left" valign="top">amd64 multiarch path</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>/usr/lib/pkgconfig/</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>/usr/lib/i386-linux-gnu/pkgconfig/</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>/usr/lib/x86_64-linux-gnu/pkgconfig/</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="symbols">Library symbols</h3>
<div class="paragraph"><p>The symbols support in the <strong>dpkg</strong> introduced to Debian <strong>lenny</strong> (5.0, May 2009) helps us to manage the backward ABI compatibility of the library package with the same package name.  The <strong>DEBIAN/symbols</strong> file in the binary package provides the minimal version associated to each symbol.</p></div>
<div class="paragraph"><p>The oversimplified method for the library packaging is as follows.</p></div>
<div class="ulist"><ul>
<li>
<p>
Extract the old <strong>DEBIAN/symbols</strong> file of the immediate previous binary package with the "<strong>dpkg-deb -e</strong>" command.
</p>
<div class="ulist"><ul>
<li>
<p>
Alternatively, the <strong>mc</strong> command may be used to extract the <strong>DEBIAN/symbols</strong> file.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Copy it to the <strong>debian/</strong><em>binarypackage</em><strong>.symbols</strong> file.
</p>
<div class="ulist"><ul>
<li>
<p>
If this is the first package, use an empty content file instead.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Build the binary package.
</p>
<div class="ulist"><ul>
<li>
<p>
If the <strong>dpkg-gensymbols</strong> command warns some new symbols:
</p>
<div class="ulist"><ul>
<li>
<p>
Extract the updated <strong>DEBIAN/symbols</strong> file with the "<strong>dpkg-deb -e</strong>" command.
</p>
</li>
<li>
<p>
Trim the Debian revision such as <strong>-1</strong> in it.
</p>
</li>
<li>
<p>
Copy it to the <strong>debian/</strong><em>binarypackage</em><strong>.symbols</strong> file.
</p>
</li>
<li>
<p>
Re-build the binary package.
</p>
</li>
</ul></div>
</li>
<li>
<p>
If the <strong>dpkg-gensymbols</strong> command does not warn new symbols:
</p>
<div class="ulist"><ul>
<li>
<p>
You are done with the library packaging.
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>For the details, you should read the following primary references.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.debian.org/doc/debian-policy/ch-sharedlibs.html#s-sharedlibs-symbols">8.6.3 The symbols system</a> of the &#8220;Debian Policy Manual&#8221;
</p>
</li>
<li>
<p>
<strong>dh_makeshlibs</strong>(1)
</p>
</li>
<li>
<p>
<strong>dpkg-gensymbols</strong>(1)
</p>
</li>
<li>
<p>
<strong>dpkg-shlibdeps</strong>(1)
</p>
</li>
<li>
<p>
<strong>deb-symbols</strong>(5)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Yous should also check:</p></div>
<div class="ulist"><ul>
<li>
<p>
Debian wiki <a href="https://wiki.debian.org/UsingSymbolsFiles">UsingSymbolsFiles</a>
</p>
</li>
<li>
<p>
Debian wiki <a href="https://wiki.debian.org/Projects/ImprovedDpkgShlibdeps">Projects/ImprovedDpkgShlibdeps</a>
</p>
</li>
<li>
<p>
Debian kde team <a href="http://pkg-kde.alioth.debian.org/symbolfiles.html">Working with symbols files</a>
</p>
</li>
<li>
<p>
<a href="#librarypkg">[librarypkg]</a>
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">For C++ libraries and other cases where the tracking of the symbols is problematic, follow <a href="https://www.debian.org/doc/debian-policy/ch-sharedlibs.html#s-sharedlibs-shlibdeps">8.6.4 The shlibs system</a> of the &#8220;Debian Policy Manual&#8221;, instead.  Please make sure to erase the empty <strong>debian/</strong><em>binarypackage</em><strong>.symbols</strong> file generated by the <strong>debmake</strong> command.  For this case, the <strong>DEBIAN/shlibs</strong> file is used.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="harden">Compiler hardening</h3>
<div class="paragraph"><p>The compiler hardening support spreading for Debian <strong>jessie</strong> (8.0, TBA) demands us to pay extra attention for the packaging.</p></div>
<div class="paragraph"><p>You should read the following references in detail.</p></div>
<div class="ulist"><ul>
<li>
<p>
Debian wiki <a href="https://wiki.debian.org/Hardening">Hardening</a>
</p>
</li>
<li>
<p>
Debian wiki <a href="https://wiki.debian.org/HardeningWalkthrough">Hardening Walkthrough</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>The <strong>debmake</strong> command adds template comments to the <strong>debian/rules</strong> file as needed for <strong>DEB_BUILD_MAINT_OPTIONS</strong>, <strong>DEB_CFLAGS_MAINT_APPEND</strong>, and <strong>DEB_LDFLAGS_MAINT_APPEND</strong> (see <a href="#singlepkg">[singlepkg]</a> and <strong>dpkg-buildflags</strong>(1)).</p></div>
</div>
<div class="sect2">
<h3 id="bug">Bug report</h3>
<div class="paragraph"><p>The <strong>reportbug</strong> command used for the bug report of <em>binarypackage</em> can be customized by the files in <strong>usr/share/bug/</strong><em>binarypackage</em><strong>/</strong>.</p></div>
<div class="paragraph"><p>The <strong>dh_bugfiles</strong> command installs these files from the template files in the <strong>debian/</strong> directory.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>debian/</strong><em>binarypackage</em><strong>.bug-control</strong>  &#8594;  <strong>usr/share/bug/</strong><em>binarypackage</em><strong>/control</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
This file contains some directions such as redirecting the bug report to another package.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>debian/</strong><em>binarypackage</em><strong>.bug-presubj</strong>  &#8594;  <strong>usr/share/bug/</strong><em>binarypackage</em><strong>/presubj</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
This file is displayed to the user by the <strong>reportbug</strong> command.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>debian/</strong><em>binarypackage</em><strong>.bug-script</strong>  &#8594; <strong>usr/share/bug/</strong><em>binarypackage</em> or <strong>usr/share/bug/</strong><em>binarypackage</em><strong>/script</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
The <strong>reportbug</strong> command runs this script to generate a template file for the bug report.
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>See <strong>dh_bugfiles</strong>(1) and <a href="file:///usr/share/doc/reportbug/README.developers.gz">reportbug&#8217;s Features for Developers</a></p></div>
</div>
<div class="sect2">
<h3 id="debconf">debconf</h3>
<div class="paragraph"><p>The <strong>debconf</strong> package enables us to configure packages during their installation in 2 main ways:</p></div>
<div class="ulist"><ul>
<li>
<p>
non-interactively from the <strong>debian-installer</strong> pre-seeding.
</p>
</li>
<li>
<p>
interactively from the menu interface (<strong>dialog</strong>, <strong>gnome</strong>, <strong>kde</strong>, &#8230;)
</p>
<div class="ulist"><ul>
<li>
<p>
the package installation: invoked by the <strong>dpkg</strong> command
</p>
</li>
<li>
<p>
the installed package: invoked by the <strong>dpkg-reconfigure</strong> command
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>All user interactions for the package installation must be handled by this <strong>debconf</strong> system using the following files.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>debian/</strong><em>binarypackage</em><strong>.cofig</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
This is the <strong>debconf</strong> <strong>config</strong> script used for asking any questions necessary to configure the package.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>debian/</strong><em>binarypackage</em><strong>.template</strong>
</p>
<div class="ulist"><ul>
<li>
<p>
This is the <strong>debconf</strong> <strong>templates</strong> file used for asking any questions necessary to configure the package.
</p>
</li>
</ul></div>
</li>
<li>
<p>
package configuration scripts
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>debian/</strong><em>binarypackage</em><strong>.preinst</strong>
</p>
</li>
<li>
<p>
<strong>debian/</strong><em>binarypackage</em><strong>.prerm</strong>
</p>
</li>
<li>
<p>
<strong>debian/</strong><em>binarypackage</em><strong>.postinst</strong>
</p>
</li>
<li>
<p>
<strong>debian/</strong><em>binarypackage</em><strong>.postrm</strong>
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>See <strong>dh_installdebconf</strong>(1), <strong>debconf</strong>(7), <strong>debconf-devel</strong>(7) and <a href="http://www.debian.org/doc/debian-policy/ch-binary.html#s-maintscriptprompt">3.9.1 Prompting in maintainer scripts</a> of the &#8220;Debian Policy Manual&#8221;.</p></div>
</div>
<div class="sect2">
<h3 id="ci">Continuous integration</h3>
<div class="paragraph"><p><a href="http://dep.debian.net/deps/dep8/">DEP-8</a> defines the <strong>debian/tests/control</strong> file as the RFC822-style test metadata file for the <a href="http://en.wikipedia.org/wiki/Continuous_integration">continuous integration</a> (CI) of the Debian package.</p></div>
<div class="paragraph"><p>It is used after building the binary packages from the source package containing this <strong>debian/tests/control</strong> file.  When the <strong>adt-run</strong> command provided by the <strong>autopkgtest</strong> package is run, the generated binary packages are installed and tested in the virtual environment according to this file.</p></div>
<div class="paragraph"><p>See documents in the <strong>/usr/share/doc/autopkgtest/</strong> directory and <a href="http://packaging.ubuntu.com/html/auto-pkg-test.html">3. autopkgtest: Automatic testing for packages</a> of the &#8220;Ubuntu Packaging Guide&#8221;.</p></div>
<div class="paragraph"><p>There are several other CI tools on Debian for you to explore.</p></div>
<div class="ulist"><ul>
<li>
<p>
The <strong>debci</strong> package: CI platform on the top of the <strong>autopkgtest</strong> package
</p>
</li>
<li>
<p>
The <strong>jenkins</strong> package: generic CI platform
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tips">Tips</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="debdiff">debdiff</h3>
<div class="paragraph"><p>You can compare file contents in two source Debian packages with the <strong>debdiff</strong> command.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ debdiff old-package.dsc new-package.dsc</code></pre>
</div></div>
<div class="paragraph"><p>You can also compare file lists in two sets of binary Debian packages with the <strong>debdiff</strong> command.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ debdiff old-package.changes new-package.changes</code></pre>
</div></div>
<div class="paragraph"><p>These are useful to identify what has been changed in the source packages and to check for inadvertent changes made when updating binary packages, such as unintentionally misplacing or removing files.</p></div>
</div>
<div class="sect2">
<h3 id="dget">dget</h3>
<div class="paragraph"><p>You can download the set of files for the Debian source package with the <strong>dget</strong> command.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ dget http://www.example.org/path/to/package_version-rev.dsc</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="debc">debc</h3>
<div class="paragraph"><p>You should install generated packages with the <strong>debc</strong> command to test it locally.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ debc package_version-rev_arch.changes</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="piuparts">piuparts</h3>
<div class="paragraph"><p>You should install generated packages with the <strong>piuparts</strong> command to test it automatically.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ sudo piuparts package_version-rev_arch.changes</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This is very slow proess with the remote APT package repository access.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="debsign">debsign</h3>
<div class="paragraph"><p>After completing the test of the package, you can sign it with the <strong>debsign</strong> command.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ debsign package_version-rev_arch.changes</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="dput">dput</h3>
<div class="paragraph"><p>After signing the package with the <strong>debsign</strong> command, you can upload the set of files for the Debian source and binary package with the <strong>dput</strong> command.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ dput package_version-rev_arch.changes</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="bts">bts</h3>
<div class="paragraph"><p>After uploading the package, you will recieve bug reports.  It is an important duty of a package maintainer to manage these bugs properly as described in <a href="http://www.debian.org/doc/manuals/developers-reference/pkgs.html#bug-handling">5.8. Handling bugs</a> of the &#8220;Debian Developer&#8217;s Reference&#8221;.</p></div>
<div class="paragraph"><p>The <strong>bts</strong> command is a handy tool to manage bugs on <a href="https://www.debian.org/Bugs/">Debian Bug Tracking System</a>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ bts severity 123123 wishlist , tags -1 pending</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="gbp">git-buildpackage</h3>
<div class="paragraph"><p>The <strong>git-buildpackage</strong> package offers many commands to automate packaging activities using the git repository.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>git-import-dsc</strong>: import the previous Debian source package to the git repository.
</p>
</li>
<li>
<p>
<strong>git-import-orig</strong>: import the new upstream tar to the git repository.
</p>
</li>
<li>
<p>
<strong>git-dch</strong>: generate the Debian changelog from the git commit messages.
</p>
</li>
<li>
<p>
<strong>git-buildpackage</strong>: build the Debian binary package from the git repository. (alias <strong>gbp</strong>)
</p>
<div class="ulist"><ul>
<li>
<p>
The <strong>--pristine-tar</strong> option for the <strong>git-buildpackage</strong> command enables to store the upstream tarball in the same git repository.
</p>
</li>
<li>
<p>
The <strong>--uscan</strong> option for the <strong>git-buildpackage</strong> command enables to download and commit the new upstream tarball into the git repository.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>git-pbuilder</strong>: build the Debian binary package from the git repository using the <strong>pbuilder</strong> package.
</p>
<div class="ulist"><ul>
<li>
<p>
The <strong>cowbuilder</strong> package is used as its backend.
</p>
</li>
</ul></div>
</li>
<li>
<p>
The <strong>gbp-pq</strong>, <strong>git-dpm</strong> or <strong>quilt</strong> (or alias <strong>dquilt</strong>) commands are used to manage quilt patches.
</p>
<div class="ulist"><ul>
<li>
<p>
The use of the <strong>dquilt</strong> command is the simplest to learn and requires you to commit the resulting files manually with the <strong>git</strong> command to the <strong>master</strong> branch.
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>The package history management with the <strong>git-buildpackage</strong> package is becoming the standard practice for most Debian maintainers.</p></div>
<div class="paragraph"><p>See:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://wiki.debian.org/GitPackagingWorkflow">https://wiki.debian.org/GitPackagingWorkflow</a>
</p>
</li>
<li>
<p>
<a href="https://wiki.debian.org/GitPackagingWorkflow/DebConf11BOF">https://wiki.debian.org/GitPackagingWorkflow/DebConf11BOF</a>
</p>
</li>
<li>
<p>
<a href="http://raphaelhertzog.com/2010/11/18/4-tips-to-maintain-a-3-0-quilt-debian-source-package-in-a-vcs/">http://raphaelhertzog.com/2010/11/18/4-tips-to-maintain-a-3-0-quilt-debian-source-package-in-a-vcs/</a>
</p>
</li>
<li>
<p>
The <strong>systemd</strong> packaging practice documentation on <a href="http://anonscm.debian.org/gitweb/?p=pkg-systemd/systemd.git;a=blob;f=debian/README.source">Building from source</a>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="debsnap">Package history</h3>
<div class="paragraph"><p>For Debian source packages named <em>&lt;source-package&gt;</em> recorded in the <a href="http://snapshot.debian.org/">snapshot.debian.org</a> archive, an initial git repository with all of the Debian version history can be generated as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git-import-dscs --debsnap --pristine-tar '&lt;source-package&gt;'</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="chroot">chroot</h3>
<div class="paragraph"><p>The <a href="http://en.wikipedia.org/wiki/Chroot">chroot</a> for the clean package build environment can be created and managed using the tools described in <a href="#setup">[setup]</a>.
<span class="footnote"><br />[The <strong>git-pbuilder</strong> style organization is deployed here.  See <a href="https://wiki.debian.org/git-pbuilder">https://wiki.debian.org/git-pbuilder</a> .  Be careful since many HOWTOs use different organization.]<br /></span></p></div>
<div class="paragraph"><p>Here is a quick summary of available package build commands.  There are many ways to do the same thing.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>dpkg-buildpackage</strong> = core of package building tool
</p>
</li>
<li>
<p>
<strong>debuild</strong> = <strong>dpkg-buildpackage</strong> + <strong>lintian</strong> (build under the sanitized environment variables)
</p>
</li>
<li>
<p>
<strong>pbuilder</strong> = core of the Debian chroot environment tool
</p>
</li>
<li>
<p>
<strong>pdebuild</strong> = <strong>pbuilder</strong> + <strong>dpkg-buildpackage</strong> (build in the chroot)
</p>
</li>
<li>
<p>
<strong>cowbuilder</strong> = speed up the <strong>pbuilder</strong> execution
</p>
</li>
<li>
<p>
<strong>git-pbuilder</strong> = the easy-to-use commandline syntax for <strong>pdebuild</strong> (used by <strong>gbp buildpackge</strong>)
</p>
</li>
<li>
<p>
<strong>gbp</strong> = manage the Debian source under the git
</p>
</li>
<li>
<p>
<strong>gbp buildpackge</strong> = <strong>pbuilder</strong> + <strong>dpkg-buildpackage</strong> + <strong>gbp</strong>
</p>
</li>
</ul></div>
<div class="paragraph"><p>A clean <strong>sid</strong> distribution chroot environment can be used as follows.</p></div>
<div class="ulist"><ul>
<li>
<p>
The chroot filesystem creation command for the <strong>sid</strong> distribution
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>pbuilder create</strong>
</p>
</li>
<li>
<p>
<strong>git-pbuilder create</strong>
</p>
</li>
</ul></div>
</li>
<li>
<p>
The master chroot filesystem path for the <strong>sid</strong> distribution chroot
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>/var/cache/pbuilder/base.cow</strong>
</p>
</li>
</ul></div>
</li>
<li>
<p>
The package build command for the <strong>sid</strong> distribution chroot
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>pdebuild</strong>
</p>
</li>
<li>
<p>
<strong>git-pbuilder</strong>
</p>
</li>
<li>
<p>
<strong>gbp buildpackage</strong>
</p>
</li>
</ul></div>
</li>
<li>
<p>
The command to update the <strong>sid</strong> chroot
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>pbuilder --update</strong>
</p>
</li>
<li>
<p>
<strong>git-pbuilder --update</strong>
</p>
</li>
</ul></div>
</li>
<li>
<p>
The command to login to the <strong>sid</strong> chroot to modify it
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>git-pbuilder --login --save-after-login</strong>
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>An arbitrary <em>dist</em> distribution environment can be used as follows.</p></div>
<div class="ulist"><ul>
<li>
<p>
The chroot filesystem creation command for the <em>dist</em> distribution
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>pbuilder create --distribution</strong> <em>dist</em>
</p>
</li>
<li>
<p>
<strong>DIST=</strong><em>dist</em> <strong>git-pbuilder create</strong>
</p>
</li>
</ul></div>
</li>
<li>
<p>
The master chroot filesystem path for the <em>dist</em> distribution chroot
</p>
<div class="ulist"><ul>
<li>
<p>
path: <strong>/var/cache/pbuilder/base-</strong><em>dist</em><strong>.cow</strong>
</p>
</li>
</ul></div>
</li>
<li>
<p>
The package build command for the <em>dist</em> distribution chroot
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>pdebuild -- --basepath=/var/cache/pbuilder/base-</strong><em>dist</em><strong>.cow</strong>
</p>
</li>
<li>
<p>
<strong>DIST=</strong><em>dist</em> <strong>git-pbuilder</strong>
</p>
</li>
<li>
<p>
<strong>gbp buildpackage --git-dist=</strong><em>dist</em>
</p>
</li>
</ul></div>
</li>
<li>
<p>
The command to update the <em>dist</em> chroot
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>pbuilder update --basepath=/var/cache/pbuilder/base-</strong><em>dist</em><strong>.cow</strong>
</p>
</li>
<li>
<p>
<strong>DIST=</strong><em>dist</em> <strong>git-pbuilder --update</strong>
</p>
</li>
</ul></div>
</li>
<li>
<p>
The command to login to the <strong>sid</strong> chroot to modify it
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>pbuilder --login --basepath=/var/cache/pbuilder/base-</strong><em>dist</em><strong>.cow --save-after-login</strong>
</p>
</li>
<li>
<p>
<strong>DIST=</strong><em>dist</em> <strong>git-pbuilder --login --save-after-login</strong>
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">A custom environment with some pre-loaded packages needed for the new experimental packages, this <strong>git-pbuilder --login --save-after-login</strong> command is quite handy.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If your old chroot is missing packages such as <strong>eatmydata</strong>, <strong>ccache</strong>, and <strong>lintian</strong>, you may want to install these with the <strong>git-pbuilder --login --save-after-login</strong> command.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The chroot filesystem can be cloned simply by copying with "<strong>cp -a base-</strong><em>dist</em><strong>.cow base-</strong><em>customdist</em><strong>.cow</strong>".  The new chroot can be accessed as "<strong>gbp buildpackage --git-dist=</strong><em>customdist</em>" and "<strong>DIST=</strong><em>customdist</em> <strong>git-pbuilder &#8230;</strong>".</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The description in this section is too terse to be useful for most of the prospective maintainers.  This is the intentional choice of the author.   You are highly encouraged to search and read all the pertinent documents associated with the commands used.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="newrevision">New Debian revision</h3>
<div class="paragraph"><p>Let&#8217;s assume that a bug report <strong>#</strong><em>bug_number</em> was filed against your package, and it describes a problem that you can solve by editing <strong>buggy</strong> file in the upstream source.  Here&#8217;s what you need to do to create a new Debian revision of the package with the <strong>bugname.patch</strong> file recording the fix.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ dquilt new bugname.patch
 $ dquilt add buggy
 $ vim buggy
 $ dquilt refresh
 $ dquilt header -e
 $ while dquilt push; do dquilt refresh; done
 $ dquilt pop -a
 $ dch -i</code></pre>
</div></div>
<div class="paragraph"><p>Please make sure to describe concisely the changes that fix reported bugs and close those bugs by adding "<strong>Closes: #</strong><em>bug_number</em>" in the <strong>debian/changlog</strong> file.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Use a <strong>debian/changelog</strong> entry with a version string such as <strong>1.0.1-1~rc1</strong> when you experiment. Then, unclutter such <strong>changelog</strong> entries into a single entry for the official package.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="newversion">New upstream release</h3>
<div class="paragraph"><p>If a package <strong>foo</strong> is properly packaged in the modern <strong>3.0 (native)</strong> or <strong>3.0 (quilt)</strong> formats, packaging a new upstream release is essentially moving the old <strong>debian/</strong> directory to the new source. This can be done by running "<strong>tar -xvzf</strong> <em>/path/to/foo_oldversion</em><strong>.debian.tar.gz</strong>" in the new extracted source. <span class="footnote"><br />[If a package <strong>foo</strong> is packaged in the old <strong>1.0</strong> format, this can be done by running "<strong>zcat</strong> <em>/path/to/foo_oldversion</em><strong>.diff.gz|patch -p1</strong>" in the new extracted source, instead.]<br /></span> Of course, you need to do some obvious chores.</p></div>
<div class="paragraph"><p>There are several tools to handle this situation.  After updating to the new upstream release with these tools, please make sure to describe concisely the changes in the new upstream release that fix reported bugs and close those bugs by adding "<strong>Closes: #</strong><em>bug_number</em>" in the <strong>debian/changlog</strong> file.</p></div>
<div class="sect3">
<h4 id="uupdate">uupdate + tarball</h4>
<div class="paragraph"><p>You can update to the new upstream source with the <strong>uupdate</strong> command from the <strong>devscripts</strong> package.  It requires to have the old Debian source package and the new upstream tarball.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ wget http://example.org/foo/foo-newversion.tar.gz
 $ cd foo-oldversion
 $ uupdate -v newversion ../foo-newversion.tar.gz
 ...
 $ cd ../foo-newversion
 $ while dquilt push; do dquilt refresh; done
 $ dch</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="uscan">uscan</h4>
<div class="paragraph"><p>You can update to the new upstream source with the <strong>uscan</strong> command from the <strong>devscripts</strong> package.  It requires to have the old Debian source package and the <strong>debian/watch</strong> file in it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd foo-oldversion
 $ uscan
 ...
 $ while dquilt push; do dquilt refresh; done
 $ dch</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="gbp-orig">gbp</h4>
<div class="paragraph"><p>You can update to the new upstream source with the "<strong>gbp import-orig --pristine-tar</strong>" command from the <strong>git-buildpackage</strong> package.  It requires to have the old Debian source in the git repository and the new upstream tarball.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ ln -sf foo-newversion.tar.gz foo_newversion.orig.tar.gz
 $ cd foo-vcs
 $ git checkout master
 $ gbp import-orig --pristine-tar  ../foo_newversion.orig.tar.gz
 ...
 $ while dquilt push; do dquilt refresh; done
 $ git commit -a -m "Refresh patches"
 $ dch</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="gbp-uscan">gbp + uscan</h4>
<div class="paragraph"><p>You can update to the new upstream source with the "<strong>gbp import-orig --pristine-tar --uscan</strong>" command from the <strong>git-buildpackage</strong> package.  It requires to have the old Debian source in the git repository and the <strong>debian/watch</strong> file in it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd foo-vcs
 $ git checkout master
 $ gbp import-orig --pristine-tar --uscan
 ...
 $ while dquilt push; do dquilt refresh; done
 $ git commit -a -m "Refresh patches"
 $ dch</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="ai-option">Shortcut options (-a, -i)</h3>
<div class="paragraph"><p>The <strong>debmake</strong> command offers 2 shortcut options.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>-a</strong> : open the upstream tarball
</p>
</li>
<li>
<p>
<strong>-i</strong> : execute script to build the binary package
</p>
</li>
</ul></div>
<div class="paragraph"><p>The example in the above <a href="#simple">[simple]</a> can be done simply as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ debmake -a package-1.0.tar.gz -i debuild</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">URL such as "<em>http://www.example.org/DL/package-1.0.tar.gz</em>" may be used for the <strong>-a</strong> option.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">URL such as "http://arm.koji.fedoraproject.org/packages/ibus/1.5.7/3.fc21/src/ibus-1.5.7-3.fc21.src.rpm" may be used for the <strong>-a</strong> option, too.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="dt-option">Upstream snapshot (-d, -t)</h3>
<div class="paragraph"><p>The upstream snapshot from the upstream source tree in VCS can be made with the <strong>-d</strong> option if the upstream supports the "<strong>make dist</strong>" equivalence.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd /path/to/upstream-vcs
 $ debmake -d -i debuild</code></pre>
</div></div>
<div class="paragraph"><p>Alternatively, the same can be made with the <strong>-t</strong> option if the upstream tarball can be made with the <strong>tar</strong> command.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd /path/to/upstream-vcs
 $ debmake -p package -t -i debuild</code></pre>
</div></div>
<div class="paragraph"><p>Unless you provide the upstream version with the <strong>-u</strong> option or with the <strong>debian/changelog</strong> file, a snapshot upstream version is generated in the <strong>0~%y%m%d%H%M</strong> format, e.g., <em>0~1403012359</em>, from the UTC date and time.</p></div>
<div class="paragraph"><p>If the upstream VCS is hosted in the <em>package/</em> directory instead of the <em>upstream-vcs/</em> directory, the "<strong>-p</strong> <em>package</em>" can be skipped.</p></div>
<div class="paragraph"><p>If the upstream source tree in the VCS contains the <strong>debian/</strong>* files, the <strong>debmake</strong> command with either the <strong>-d</strong> option or the <strong>-t</strong> option combined with the <strong>-i</strong> option automates making of the non-native Debian packages from the VCS snapshot while using these <strong>debian/</strong>* files.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cp -r /path/to/package-0~1403012359/debian/. /path/to/upstream-vcs/debian
 $ dch
   ... update debian/changelog
 $ git add -A .; git commit -m "vcs with debian/*"
 $ debmake -t -p package -i debuild</code></pre>
</div></div>
<div class="paragraph"><p>This Debian <strong>non-native</strong> binary package building scheme using the "<strong>debmake -t -i debuild</strong>" command may be considered as the <strong>quasi-native</strong> Debian package scheme since the packaging situation resembles the Debian <strong>native</strong> binary package building case using the <strong>debuild</strong> command without the upstream tarball.</p></div>
<div class="paragraph"><p>Use of the <strong>non-native</strong> Debian package helps to ease communication with the downstream distros such as Ubuntu for bug fixes etc.</p></div>
</div>
<div class="sect2">
<h3 id="pythonmod">Python module</h3>
<div class="paragraph"><p>You can generate a functioning single binary Debian package with a reasonable package description directly from the Python module package offered as a tarball <em>pythonmodule-1.0</em><strong>.tar.gz</strong>.  The <strong>-b</strong> option specifying the package type <strong>python</strong> and the <strong>-s</strong> option to copy the package description from the upstream package need to be specified.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ debmake -s -b':python' -a pythonmodule-1.0.tar.gz -i debuild</code></pre>
</div></div>
<div class="paragraph"><p>For other interpreted languages with the <strong>-b</strong> option support, specify the pertinent <em>type</em> for the <strong>-b</strong> option.</p></div>
<div class="paragraph"><p>For interpreted languages without the <strong>-b</strong> option support, specify the <strong>script</strong> type instead and add the interpreter package as the dependency of the resulting binary package by adjusting the <strong>debian/control</strong> file.</p></div>
</div>
<div class="sect2">
<h3 id="c-option">debmake -cc</h3>
<div class="paragraph"><p>The the <strong>debmake</strong> command with the <strong>-cc</strong> option can make a summary of the copyright and license for the entire source tree to the standard output.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ tar -xvzf package-1.0.tar.gz
 $ cd package-1.0
 $ debmake -cc | less</code></pre>
</div></div>
<div class="paragraph"><p>With <strong>-c</strong>, this provides shorter report.</p></div>
</div>
<div class="sect2">
<h3 id="k-option">debmake -k</h3>
<div class="paragraph"><p>When updating a package for the new upstream release, the <strong>debmake</strong> command can verify the content of the existing <strong>debian/copyright</strong> file against the copyright and license situation of the entire updated source tree.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd package-vcs
 $ gbp import-orig --uscan --pristine-tar
 ... update source with the new upstream release
 $ debmake -k | less</code></pre>
</div></div>
<div class="paragraph"><p>The "<strong>debmake -k</strong>" command parses the <strong>debian/copyright</strong> file from the top to the bottom and compare the license of all the non-binary files in the current package with the license described in the last matching file pattern entry of the <strong>debian/copyright</strong> file.</p></div>
<div class="paragraph"><p>When editing the auto-generated <strong>debian/copyright</strong> file, please make sure to keep the generic file patterns at the top of the list.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">For all new upstream releases, run the "<strong>debmake -k</strong>" command to ensure that the <strong>debian/copyright</strong> file is current.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="j-option">debmake -j</h3>
<div class="paragraph"><p>The generation of the functioning multi binary package always requires extra manual works than that of the functioning single binary package.  The test build of the source package is essential part of it.</p></div>
<div class="paragraph"><p>For example, let&#8217;s package the same <em>package-1.0</em><strong>.tar.gz</strong> (see <a href="#simple">[simple]</a>) into a multi binary package.  At the line invoking the <strong>debmake</strong> command, let&#8217;s invoke it with the <strong>-j</strong> option instead for the test building and the report generation.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ debmake -j</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The <strong>-j</strong> option for <strong>debmake</strong> invokes <strong>dpkg-depcheck</strong>(1) to run <strong>debian/rules</strong> under <strong>strace</strong>(1) to obtain library dependencies.  Unfortunately, this is very slow.  If you know the library package dependencies from other sources such as the SPEC file in the source, you may just run "<strong>debmake</strong> &#8230;" without <strong>-j</strong> and "<strong>debian/rules install</strong>" to check the install paths of the generated files.</td>
</tr></table>
</div>
<div class="ulist"><ul>
<li>
<p>
Check the last lines of <em>package</em><strong>.build-dep.log</strong> to judge build dependencies for <strong>Build-Depends</strong>. (You do not need to list packages used by <strong>debhelper</strong>, <strong>perl</strong>, or <strong>fakeroot</strong> explicitly in <strong>Build-Depends</strong>.  This technique is useful for the generation of the single binary package, too.)
</p>
</li>
<li>
<p>
Check the contents of <em>package</em><strong>.install.log</strong> to identify the install paths for files to decide how you split them into multiple packages.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code> $ rm -rf package-1.0
 $ tar -xvzf package-1.0.tar.gz
 $ cd package-1.0
 $ debmake -b"package1:type1, ..."</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
Update <strong>debian/control</strong> and <strong>debian/</strong><em>binarypackage</em><strong>.install</strong> files using the above information.
</p>
</li>
<li>
<p>
Update other <strong>debian/</strong>* files as needed.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code> $ debuild</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
Each <em>binarypackage_version-revision_arch</em><strong>.deb</strong> has files specified by the <strong>debian/</strong><em>binarypackage</em><strong>.install</strong> file.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The binary package name starting with a "<strong>-</strong>" (hyphen) is treated as the abbreviated name and the real binary package name is generated by attaching it to the source package name.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="xoption">debmake -x</h3>
<div class="paragraph"><p>The amount of template files generated by the <strong>debmake</strong> command depends on the <strong>-x</strong>[01234] option.</p></div>
<div class="ulist"><ul>
<li>
<p>
See <a href="maint-guide2.html#emptypkg">Cherry-pick templates</a> for the cherry-picking of the template files.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">None of the existing configuration files are modified by the <strong>debmake</strong> command.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="deb3">3.0 source format</h3>
<div class="paragraph"><p>Updating the package style is not a required activity for the update of a package. However, doing so lets you use the full capabilities of the modern <strong>debhelper</strong> system and the <strong>3.0</strong> source format.</p></div>
<div class="ulist"><ul>
<li>
<p>
If you need to recreate deleted template files for any reason, you can run <strong>debmake</strong> again in the same Debian package source tree. Then edit them appropriately.
</p>
</li>
<li>
<p>
If the package has not been updated to use the <strong>dh</strong> command for the <strong>debian/rules</strong> file, update it to use it (see <a href="#simplerules">[simplerules]</a>). Update the <strong>debian/control</strong> file accordingly.
</p>
</li>
<li>
<p>
If you have a <strong>1.0</strong> source package with the <strong>foo.diff.gz</strong> file, you can update it to the newer <strong>3.0 (quilt)</strong> source format by creating <strong>debian/source/format</strong> with <strong>3.0 (quilt)</strong>. The rest of the <strong>debian/</strong>* files can just be copied. Import the <strong>big.diff</strong> file generated by the command "<strong>filterdiff -z -x <em><strong>/debian/</strong></em> foo.diff.gz &gt; big.diff</strong>" to your quilt system, if needed. <span class="footnote"><br />[You can split <strong>big.diff</strong> into many small incremental patches using the <strong>splitdiff</strong> command.]<br /></span>
</p>
</li>
<li>
<p>
If it was packaged using another patch system such as <strong>dpatch</strong>, <strong>dbs</strong>, or <strong>cdbs</strong> with <strong>-p0</strong>, <strong>-p1</strong>, or <strong>-p2</strong>, convert it to the quilt command using the <strong>deb3</strong> script in the <strong>quilt</strong> package.
</p>
</li>
<li>
<p>
If it was packaged with the <strong>dh</strong> command with the "<strong>--with quilt</strong>" option or with the <strong>dh_quilt_patch</strong> and <strong>dh_quilt_unpatch</strong> commands, remove these and make it use the newer <strong>3.0 (quilt)</strong> source format.
</p>
</li>
<li>
<p>
If you have a <strong>1.0</strong> source package without the <strong>foo.diff.gz</strong> file, you can update it to the newer <strong>3.0 (native)</strong> source format by creating <strong>debian/source/format</strong> with <strong>3.0 (native)</strong>. The rest of the <strong>debian/</strong>* files can just be copied.
</p>
</li>
</ul></div>
<div class="paragraph"><p>You should check <a href="http://dep.debian.net/">DEP - Debian Enhancement Proposals</a> and adopt ACCEPTED proposals.</p></div>
<div class="paragraph"><p>See <a href="https://wiki.debian.org/Projects/DebSrc3.0">ProjectsDebSrc3.0</a> to check the support status of the new Debian source formats by the Debian tool chains.</p></div>
</div>
<div class="sect2">
<h3 id="cdbs">CDBS</h3>
<div class="paragraph"><p>The Common Debian Build System (<strong>CDBS</strong>) is a wrapper system over the <strong>debhelper</strong> package.  The <strong>CDBS</strong> is based on the Makefile inclusion mechanism and configured by the <strong>DEB_</strong>* configuration variables set in the <strong>debian/rules</strong> file.</p></div>
<div class="paragraph"><p>Before the introduction of the <strong>dh</strong> command to the <strong>debhelper</strong> package at the version 7, the <strong>CDBS</strong> was the only approach to create a simple and clean <strong>debian/rules</strong> file.</p></div>
<div class="paragraph"><p>For many simple packages, the <strong>dh</strong> command alone allows us to make a simple and clean <strong>debian/rules</strong> file, now.  It is desirable to keep the build system simple and clean by not using the superfluous <strong>CDBS</strong>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">&#8220;The <strong>CDBS</strong> magically does the job for me with less typing&#8221; nor &#8220;I don&#8217;t understand the new <strong>dh</strong> syntax&#8221; cannot be the excuse to keep using the <strong>CDBS</strong> system.</td>
</tr></table>
</div>
<div class="paragraph"><p>For some complicated packages such as GNOME related ones, the <strong>CDBS</strong> is used with reasons and offers some value to the packagers.  If this is the case, please do not bother converting from the <strong>CDBS</strong> to the <strong>dh</strong> syntax.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">If you are working with a <a href="https://wiki.debian.org/Teams">team</a> of maintainers, please follow the established practice of the team.</td>
</tr></table>
</div>
<div class="paragraph"><p>When converting packages from the <strong>CDBS</strong> to the <strong>dh</strong> syntax, please use the following as your reference:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://cdbs-doc.duckcorp.org/en/cdbs-doc.xhtml">CDBS Documentation</a>
</p>
</li>
<li>
<p>
<a href="http://meetings-archive.debian.net/pub/debian-meetings/2009/fosdem/slides/The_Common_Debian_Build_System_CDBS/">The Common Debian Build System (CDBS), FOSDEM 2009</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_utf_8_conversion">UTF-8 conversion</h3>
<div class="paragraph"><p>If upstream documents are encoded in old encoding schemes, converting them to <a href="http://en.wikipedia.org/wiki/UTF-8">UTF-8</a> is a good idea.</p></div>
<div class="paragraph"><p>Use the <strong>iconv</strong> command in the <strong>libc-bin</strong> package to convert encodings of plain text files.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>iconv -f latin1 -t utf8 foo_in.txt &gt; foo_out.txt</code></pre>
</div></div>
<div class="paragraph"><p>Use <strong>w3m</strong>(1) to convert from HTML files to UTF-8 plain text files. When you do this, make sure to execute it under UTF-8 locale.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>LC_ALL=en_US.UTF-8 w3m -o display_charset=UTF-8 \
        -cols 70 -dump -no-graph -T text/html \
        &lt; foo_in.html &gt; foo_out.txt</code></pre>
</div></div>
<div class="paragraph"><p>Run these scripts in the <strong>override_dh_</strong>* target of the <strong>debian/rules</strong> file.</p></div>
</div>
<div class="sect2">
<h3 id="source">Source tips</h3>
<div class="paragraph"><p>Although the upstream tarball has all the information to build the Debian package, it is not always easy to figure out which combination of options to use.</p></div>
<div class="paragraph"><p>Also, the upstream may be more focused on the feature enhancements and may be less eager for backward compatibilities etc. which are important aspect of the Debian packaging practice.</p></div>
<div class="paragraph"><p>The leveraging of information from other distributions is an option to address above issues.</p></div>
<div class="paragraph"><p>If the other distribution in interest is a Debian derivative one, it is trivial to reuse it.</p></div>
<div class="paragraph"><p>If the other distribution in interest is a <a href="http://en.wikipedia.org/wiki/RPM_Package_Manager">RPM</a> based distribution, see <a href="https://wiki.debian.org/Repackage_srcrpm">Repackage src.rpm</a>.</p></div>
<div class="paragraph"><p>Downloading and opening of the <strong>src.rpm</strong> file can be done with the <strong>rget</strong> command.  (Place the <strong>rget</strong> script in your PATH.)</p></div>
<div class="listingblock">
<div class="title">rget script</div>
<div class="content">
<pre><code>#!/bin/sh
FCSRPM=$(basename $1)
mkdir ${FCSRPM}; cd ${FCSRPM}/
wget $1
rpm2cpio ${FCSRPM} | cpio -dium</code></pre>
</div></div>
<div class="paragraph"><p>Many upstream tarballs contain the SPEC file named as <em>packagename</em>.<strong>spec</strong> or <em>packagename</em>.<strong>spec.in</strong> used by the RPM system.  This can be used as the baseline for the Debian package, too.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples">Packaging examples</h2>
<div class="sectionbody">
<div class="paragraph"><p>There is an old Latin saying: &#8220;<strong>fabricando fit faber</strong>&#8221; (&#8220;practice makes perfect&#8221;).</p></div>
<div class="paragraph"><p>It is highly recommended to practice and experiment with all the steps of Debian packaging with simple packages.  This chapter provides you with the examples for your practice.</p></div>
<div class="paragraph"><p>The <strong>/usr/share/doc/debmake/examples.tar.xz</strong> tarball has the sources used for testing the <strong>debmake</strong> command and creating the examples in this guide.</p></div>
<div class="sect2">
<h3 id="emptypkg">Cherry-pick templates</h3>
<div class="paragraph"><p>Although executing the <strong>debmake</strong> command with the larger <strong>-x</strong><em>[01234]</em> option in the upstream source adds new template files without overwriting the existing ones, it tends to leave too many unused ones and is quite messy.</p></div>
<div class="paragraph"><p>If you wish to get some template files without making mess in the upstream source tree, please consider the following scheme with an empty directory, e.g., <em>package/</em>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ tree
.
└── package

1 directory, 0 files</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s get the maximum amount of template files by specifying the <strong>-x4</strong> option.</p></div>
<div class="paragraph"><p>Let&#8217;s also use the "<strong>-t -u</strong> <em>0.0</em>" options to make missing upstream tarball with an upstream version <em>0.0</em>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd package
 $ debmake -t -u 0.0 -x4
 ...
I: debmake -x "4" ...
I: creating =&gt; debian/control
I: creating =&gt; debian/copyright
I: creating =&gt; debian/changelog
 ...
I: creating =&gt; debian/license-examples/LGPL-3.0+
I: creating =&gt; debian/license-examples/Artistic-1.0
I: creating =&gt; debian/license-examples/BSD-3-Clause
I: $ wrap-and-sort
I: upon return to the shell, current directory becomes /path/to/package
I: please execute "cd /path/to/package-0.0" before building the binary pack...
I: with dpkg-buildpackage (or debuild, pdebuild, sbuild, ...).</code></pre>
</div></div>
<div class="paragraph"><p>Let’s inspect generated template files.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd ..
 $ tree
.
├── package
├── package-0.0
│   └── debian
│       ├── changelog
│       ├── clean
│       ├── compat
│       ├── control
│       ├── copyright
│       ├── install
│       ├── license-examples
│       │   ├── Apache-2.0
│       │   ├── Artistic-1.0
│       │   ├── BSD-3-Clause
│       │   ├── GPL-2.0+
│       │   ├── GPL-3.0+
│       │   ├── LGPL-2.1+
│       │   ├── LGPL-3.0+
│       │   └── MIT
│       ├── links
│       ├── manpage.1.ex
│       ├── manpage.asciidoc.ex
│       ├── manpage.sgml.ex
│       ├── manpage.xml.ex
│       ├── menu
│       ├── package.bug-control.ex
│       ├── package.bug-presubj.ex
│       ├── package.bug-script.ex
│       ├── package.conffiles.ex
│       ├── package.cron.daily.ex
│       ├── package.cron.d.ex
│       ├── package.cron.hourly.ex
│       ├── package.cron.monthly.ex
│       ├── package.cron.weekly.ex
│       ├── package.default.ex
│       ├── package.dirs.ex
│       ├── package.emacsen-install.ex
│       ├── package.emacsen-remove.ex
│       ├── package.emacsen-startup.ex
│       ├── package.init.ex
│       ├── package.lintian-overrides.ex
│       ├── package.service.ex
│       ├── package.tmpfile.ex
│       ├── package.upstrat.ex
│       ├── patches
│       │   └── series
│       ├── postinst
│       ├── postrm
│       ├── preinst
│       ├── prerm
│       ├── README.Debian
│       ├── rules
│       ├── source
│       │   ├── format
│       │   └── local-options
│       ├── source.lintian-overrides.ex
│       └── watch
├── package_0.0.orig.tar.gz -&gt; package-0.0.tar.gz
└── package-0.0.tar.gz

6 directories, 52 files</code></pre>
</div></div>
<div class="paragraph"><p>Now you can copy any of these generated template files in the <em>package-0.0/</em><strong>debian/</strong> directory to your package as needed.</p></div>
</div>
<div class="sect2">
<h3 id="modpkg">Modifications</h3>
<div class="paragraph"><p>Let&#8217;s assume we have an older upstream source tarball <strong>hello-c-0.9.tar.gz</strong> than the <strong>hello-c-1.0.tar.gz</strong> in <a href="#simple">[simple]</a>.  The <strong>Makefile</strong> of version 0.9 installs its binary to the fixed location <strong>/usr/local/bin/hello</strong> and does not support <strong>$(DESTDIR)</strong>.</p></div>
<div class="paragraph"><p>There are several methods (see <a href="#patchapproach">[patchapproach]</a>) to prepare the <strong>-p1</strong> patch needed for applying modifications to this <strong>0.9</strong> upstream source.  Let&#8217;s use the <strong>dquilt</strong> command.</p></div>
<div class="sect3">
<h4 id="dquiltex">Patch file by the <strong>dquilt</strong> command</h4>
<div class="paragraph"><p>Here we show the method with the <strong>dquilt</strong> command.</p></div>
<div class="paragraph"><p>The packaging procedure is the same as that of version 1.0 up to running the <strong>debmake</strong> command.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd hello-c-0.9
 $ debmake
D: /usr/bin/debmake started
D: PYTHONPATH = /usr/bin:/usr/lib/python3.4:/usr/lib/python3.4/plat-x86_64-...
I: set parameters
 ...
 ... (snip)
 ...
I: run "debmake -x2" to get more template files
I: $ wrap-and-sort</code></pre>
</div></div>
<div class="paragraph"><p>The "<strong>dquilt new</strong> &#8230;" command sets the name of the patch.</p></div>
<div class="paragraph"><p>The "<strong>dquilt add</strong> &#8230;" command sets the files to be modified.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ dquilt new 0001-destdir.patch
Patch debian/patches/0001-destdir.patch is now on top
 $ dquilt add Makefile
File Makefile added to patch debian/patches/0001-destdir.patch
 $ cat Makefile
all: hello

hello: hello.c
        gcc -Wall -o hello hello.c

install: hello
        install -D hello /usr/local/bin/hello

clean:
        -rm -f hello

distclean: clean

.PHONY: all install clean distclean</code></pre>
</div></div>
<div class="paragraph"><p>The <strong>vim</strong> command edits the <strong>Makefile</strong> to support <strong>$(DESTDIR)</strong>..</p></div>
<div class="paragraph"><p>The "<strong>dquilt refresh</strong> &#8230;" command records the modification as the <strong>-p1</strong> patch in the <strong>debian/patches/</strong> directory.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ vim Makefile
 ...
 $ cat Makefile
all: hello

hello: hello.c
        gcc -Wall -o hello hello.c

install: hello
        install -D hello $(DESTDIR)/usr/bin/hello

clean:
        -rm -f hello

distclean: clean

.PHONY: all install clean distclean
 $ dquilt refresh
Refreshed patch debian/patches/0001-destdir.patch
 $ cat debian/patches/0001-destdir.patch
Index: hello-c-0.9/Makefile
===================================================================
--- hello-c-0.9.orig/Makefile
+++ hello-c-0.9/Makefile
@@ -4,7 +4,7 @@ hello: hello.c
        gcc -Wall -o hello hello.c

 install: hello
-       install -D hello /usr/local/bin/hello
+       install -D hello $(DESTDIR)/usr/bin/hello

 clean:
        -rm -f hello</code></pre>
</div></div>
<div class="paragraph"><p>The "<strong>dquilt header -e</strong> &#8230;" command adds the <a href="http://dep.debian.net/deps/dep3/">DEP-3: Patch Tagging Guidelines</a> compatible patch header.</p></div>
<div class="paragraph"><p>The "<strong>dquilt pop -a</strong>" command removes all applied patches from the source.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ dquilt header -e
 ...
 $ cat debian/patches/0001-destdir.patch
From: Foo Bar &lt;foo@example.org&gt;
Description: make Makefile to support GNU coding standard
 $DESTDIR: debian/hello-c
 $prefix:  /usr/local -&gt; /usr

Index: hello-c-0.9/Makefile
===================================================================
--- hello-c-0.9.orig/Makefile
+++ hello-c-0.9/Makefile
@@ -4,7 +4,7 @@ hello: hello.c
        gcc -Wall -o hello hello.c

 install: hello
-       install -D hello /usr/local/bin/hello
+       install -D hello $(DESTDIR)/usr/bin/hello

 clean:
        -rm -f hello
 $ dquilt pop -a
Removing patch debian/patches/0001-destdir.patch
Restoring Makefile

No patches applied
 $ cat debian/patches/series
### The patch files of the -p1 format included in the debian/patches direct...
### are applied to the upstream source in the order listed below.
### This is manually managed by users with dquilt (quilt(1) wrapper) etc.
### Also this may be updated by dpkg-source(1) when making a package.
0001-destdir.patch</code></pre>
</div></div>
<div class="paragraph"><p>For the proper packaging, you are required to make further modification here.</p></div>
<div class="paragraph"><p>For learning purpose, let&#8217;s leave such details and move on. You can create a non-native Debian package using the <strong>debuild</strong> command (or its equivalents) in this source tree.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd hello-c-0.9
 $ debuild
 dpkg-buildpackage -rfakeroot -D -us -uc -i
 ...
dpkg-source: info: applying 0001-destdir.patch
 fakeroot debian/rules clean
dh clean
 ...
 debian/rules build
dh build
 ...
 fakeroot debian/rules binary
dh binary
 ...
Finished running lintian.</code></pre>
</div></div>
<div class="paragraph"><p>Let’s inspect files.</p></div>
<div class="listingblock">
<div class="title">The generated files of version 0.9 by the debuild command:</div>
<div class="content">
<pre><code> $ cd ..
 $ tree -L 1
.
├── hello-c-0.9
├── hello-c_0.9-1_amd64.build
├── hello-c_0.9-1_amd64.changes
├── hello-c_0.9-1_amd64.deb
├── hello-c_0.9-1.debian.tar.xz
├── hello-c_0.9-1.dsc
├── hello-c_0.9.orig.tar.gz -&gt; hello-c-0.9.tar.gz
└── hello-c-0.9.tar.gz

1 directory, 7 files</code></pre>
</div></div>
<div class="listingblock">
<div class="title">The source package contents of version 0.9:</div>
<div class="content">
<pre><code> $ dpkg -c hello-c_0.9-1_amd64.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/hello-c/
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/README.Debian
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/changelog.Debian.gz
drwxr-xr-x root/root ...  ./usr/bin/
-rwxr-xr-x root/root ...  ./usr/bin/hello</code></pre>
</div></div>
<div class="listingblock">
<div class="title">The binary package contents of version 0.9:</div>
<div class="content">
<pre><code> $ tar -tJf hello-c_0.9-1.debian.tar.xz
debian/
debian/rules
debian/compat
debian/control
debian/watch
debian/copyright
debian/source/
debian/source/format
debian/README.Debian
debian/patches/
debian/patches/0001-destdir.patch
debian/patches/series
debian/changelog
 $ tar -tzf hello-c-0.9.tar.gz
hello-c-0.9/
hello-c-0.9/hello.c
hello-c-0.9/Makefile</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="snappkg">Snapshot (<strong>simple</strong>)</h3>
<div class="paragraph"><p>Let&#8217;s consider an upstream source in the VCS and make a snapshot package from it.</p></div>
<div class="paragraph"><p>Let&#8217;s inspect files.</p></div>
<div class="listingblock">
<div class="title">VCS source tree</div>
<div class="content">
<pre><code> $ tree
.
└── hello-c
    ├── hello.c
    └── Makefile

1 directory, 2 files</code></pre>
</div></div>
<div class="paragraph"><p>The source is the same one as <a href="#singlepkg">[singlepkg]</a> but the parent directory lacks the version part.  This is typical for the source in the VCS.</p></div>
<div class="paragraph"><p>You create a non-native Debian package source tree from the above upstream example using the <strong>debmake</strong>(1) command.</p></div>
<div class="listingblock">
<div class="title"><strong>git</strong> and <strong>debmake</strong></div>
<div class="content">
<pre><code> $ cd hello-c
 $ git init
Initialized empty Git repository in /path/to/hello-c/.git/
 $ git add .
 $ git commit -m "initial commit"
[master (root-commit) 02e85ec] initial commit
 2 files changed, 21 insertions(+)
 create mode 100644 Makefile
 create mode 100644 hello.c
 $ git checkout -b devel
Switched to a new branch 'devel'
 $ git branch
* devel
  master
 $ debmake -t
D: /usr/bin/debmake started
D: PYTHONPATH = /usr/bin:/usr/lib/python3.4:/usr/lib/python3.4/plat-x86_64-...
I: set parameters
I: sanity check of parameters
I: pkg="hello-c", ver="0~1410121525", rev="1"
I: make the upstream tarball with "tar --exclude=debian"
I: pwd = "/path/to/hello-c"
I: pwd = "/path/to"
I: $ rsync -aCv --link-dest=/path/to/hello-c hello-c/. hello-c-0~1410121525...
sending incremental file list
 ...
I: debmake -x "1" ...
 ...
I: run "debmake -x2" to get more template files
I: $ wrap-and-sort
I: upon return to the shell, current directory becomes /path/to/hello-c
I: please execute "cd /path/to/hello-c-0~1410121525" before building the bi...
I: with dpkg-buildpackage (or debuild, pdebuild, sbuild, ...).</code></pre>
</div></div>
<div class="paragraph"><p>Let’s inspect files.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd ..
 $ tree
.
├── hello-c
│   ├── hello.c
│   └── Makefile
├── hello-c-0~1410121525
│   ├── debian
│   │   ├── changelog
│   │   ├── compat
│   │   ├── control
│   │   ├── copyright
│   │   ├── patches
│   │   │   └── series
│   │   ├── README.Debian
│   │   ├── rules
│   │   ├── source
│   │   │   ├── format
│   │   │   └── local-options
│   │   └── watch
│   ├── hello.c
│   └── Makefile
├── hello-c_0~1410121525.orig.tar.gz -&gt; hello-c-0~1410121525.tar.gz
└── hello-c-0~1410121525.tar.gz

5 directories, 16 files</code></pre>
</div></div>
<div class="paragraph"><p>There are many files:</p></div>
<div class="ulist"><ul>
<li>
<p>
the snapshot upstream tarball: <strong>hello-0~1410121525.tar.gz</strong> (<strong>hello-c_0~1410121525.orig.tar.gz</strong>)
</p>
</li>
<li>
<p>
the snapshot upstream source tree with template files generated by the <strong>debmake</strong> command: <strong>hello-c-0~1410121525/</strong>*
</p>
</li>
<li>
<p>
the cleaned VCS directory: <strong>hello-c-0~1410121525/</strong>*
</p>
</li>
</ul></div>
<div class="paragraph"><p>For the proper packaging, you are required to make further modification using these auto-generated template files in the <strong>hello-c-0~1410121525/debian</strong> directory. For learning purpose, let&#8217;s leave such details and move on. You can create a non-native Debian package using the <strong>debuild</strong> command (or its equivalent) in this source tree.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd hello-c-0~1410121525
 $ debuild
 dpkg-buildpackage -rfakeroot -D -us -uc -i
 ...
 fakeroot debian/rules clean
dh clean
 ...
 debian/rules build
dh build
 ...
 fakeroot debian/rules binary
dh binary
 ...
Finished running lintian.</code></pre>
</div></div>
<div class="paragraph"><p>Let’s inspect the result.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd ..
 $ tree -L 1
.
├── hello-c
├── hello-c-0~1410121525
├── hello-c_0~1410121525-1_amd64.build
├── hello-c_0~1410121525-1_amd64.changes
├── hello-c_0~1410121525-1_amd64.deb
├── hello-c_0~1410121525-1.debian.tar.xz
├── hello-c_0~1410121525-1.dsc
├── hello-c_0~1410121525.orig.tar.gz -&gt; hello-c-0~1410121525.tar.gz
└── hello-c-0~1410121525.tar.gz

2 directories, 7 files</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code> $ dpkg -c hello-c_0~1410121525-1_amd64.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/hello-c/
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/README.Debian
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/changelog.Debian.gz
drwxr-xr-x root/root ...  ./usr/bin/
-rwxr-xr-x root/root ...  ./usr/bin/hello</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code> $ tar -tJf hello-c_0~1410121525-1.debian.tar.xz
debian/
debian/rules
debian/compat
debian/control
debian/watch
debian/copyright
debian/source/
debian/source/format
debian/README.Debian
debian/patches/
debian/patches/series
debian/changelog
 $ tar -tzf hello-c-0~1410121525.tar.gz
hello-c-0~1410121525/
hello-c-0~1410121525/hello.c
hello-c-0~1410121525/Makefile</code></pre>
</div></div>
<div class="paragraph"><p>Your development branch holding the working upstream source tree and the <strong>debian/</strong>* files is the <strong>devel</strong> branch.</p></div>
<div class="paragraph"><p>The following will import generated Debian packages to <strong>master</strong>, <strong>upstream</strong>, and <strong>pristine-tar</strong> branches. (These are the 3 typical branches used by the <strong>gbp</strong> command.)</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd hello-c
 $ git-import-dsc ../hello-c_0~1410121525-1.dsc  \
                  --pristine-tar --create-missing-branches
gbp:info: Tag upstream/0_1410121525 not found, importing Upstream tarball
gbp:info: Creating missing branch 'upstream'
pristine-tar: committed hello-c_0~1410121525.orig.tar.gz.delta to branch pr...
gbp:info: Version '0~1410121525-1' imported under 'hello-c'
 $ git branch
* devel
  master
  pristine-tar
  upstream
 $ gitk --all</code></pre>
</div></div>
<div class="paragraph"><p>The <strong>gitk</strong> command shows the VCS history nicely.</p></div>
</div>
<div class="sect2">
<h3 id="autopkg">Snapshot (<strong>Autotools</strong>)</h3>
<div class="paragraph"><p>Let&#8217;s make this upstream source in the VCS more fun to use the Autotools (=Autoconf + Automake).  The upstream VCS does not contain auto-generated files while the distributed tarball for the snapshot package has many auto-generated files.</p></div>
<div class="paragraph"><p>Let&#8217;s inspect files.</p></div>
<div class="listingblock">
<div class="title">VCS source tree</div>
<div class="content">
<pre><code> $ tree
.
└── vcsdir
    ├── configure.ac
    ├── hello.c
    └── Makefile.am

1 directory, 3 files</code></pre>
</div></div>
<div class="paragraph"><p>Here are minimalistic configuration files for Autotools specifying the upstream version to be <strong>1.5</strong>.</p></div>
<div class="listingblock">
<div class="title"><strong>configure.ac</strong>:</div>
<div class="content">
<pre><code> $ cat vcsdir/configure.ac
#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.
AC_PREREQ([2.69])
AC_INIT([hello-c], [1.5], [foo@example.org])
AC_CONFIG_SRCDIR([hello.c])
AC_CONFIG_HEADERS([config.h])
# Manually added
AM_INIT_AUTOMAKE([foreign])
# Checks for programs.
AC_PROG_CC
AC_CONFIG_FILES([Makefile])
AC_OUTPUT</code></pre>
</div></div>
<div class="listingblock">
<div class="title"><strong>Makefile.am</strong>:</div>
<div class="content">
<pre><code> $ cat vcsdir/Makefile.am
bin_PROGRAMS = hello
hello_SOURCES = hello.c</code></pre>
</div></div>
<div class="paragraph"><p>The C source <strong>hello.c</strong> is the same one as before.</p></div>
<div class="paragraph"><p>You create a non-native Debian package source tree from the above upstream example using the <strong>debmake</strong>(1) command.</p></div>
<div class="listingblock">
<div class="title"><strong>git</strong> and <strong>debmake</strong></div>
<div class="content">
<pre><code> $ cd vcsdir
 $ git init
Initialized empty Git repository in /path/to/vcsdir/.git/
 $ git add .
 $ git commit -m "initial commit"
[master (root-commit) 6cea3b5] initial commit
 3 files changed, 21 insertions(+)
 create mode 100644 Makefile.am
 create mode 100644 configure.ac
 create mode 100644 hello.c
 $ git checkout -b devel
Switched to a new branch 'devel'
 $ git branch
* devel
  master
 $ debmake -d
D: /usr/bin/debmake started
D: PYTHONPATH = /usr/bin:/usr/lib/python3.4:/usr/lib/python3.4/plat-x86_64-...
I: set parameters
I: sanity check of parameters
I: pkg="", ver="", rev="1"
I: make the upstream tarball with "make dist" equivalents
I: pwd = "/path/to/vcsdir"
I: $ autoreconf -ivf &amp;&amp; ./configure --prefix "/usr" &amp;&amp; make distcheck
autoreconf: Entering directory `.'
 ...
I: debmake -x "1" ...
 ...
I: run "debmake -x2" to get more template files
I: $ wrap-and-sort
I: upon return to the shell, current directory becomes /path/to/vcsdir
I: please execute "cd /path/to/hello-c-1.5" before building the binary pack...
I: with dpkg-buildpackage (or debuild, pdebuild, sbuild, ...).</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s clean <strong>vcsdir/</strong> since it has so many Autotools generated files.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ git clean -d -f -x
Removing .deps/
Removing Makefile
Removing Makefile.in
Removing aclocal.m4
Removing autom4te.cache/
Removing compile
Removing config.h
Removing config.h.in
Removing config.log
Removing config.status
Removing configure
Removing depcomp
Removing hello-c-1.5.tar.gz
Removing install-sh
Removing missing</code></pre>
</div></div>
<div class="paragraph"><p>Let’s inspect files.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd ..
 $ tree
.
├── hello-c-1.5
│   ├── aclocal.m4
│   ├── compile
│   ├── config.h.in
│   ├── configure
│   ├── configure.ac
│   ├── debian
│   │   ├── changelog
│   │   ├── compat
│   │   ├── control
│   │   ├── copyright
│   │   ├── patches
│   │   │   └── series
│   │   ├── README.Debian
│   │   ├── rules
│   │   ├── source
│   │   │   ├── format
│   │   │   └── local-options
│   │   └── watch
│   ├── depcomp
│   ├── hello.c
│   ├── install-sh
│   ├── Makefile.am
│   ├── Makefile.in
│   └── missing
├── hello-c_1.5.orig.tar.gz -&gt; hello-c-1.5.tar.gz
├── hello-c-1.5.tar.gz
└── vcsdir
    ├── configure.ac
    ├── hello.c
    └── Makefile.am

5 directories, 26 files</code></pre>
</div></div>
<div class="paragraph"><p>There are many files:</p></div>
<div class="ulist"><ul>
<li>
<p>
the snapshot upstream tarball: <strong>hello-1.5.tar.gz</strong> (<strong>hello-c_1.5.orig.tar.gz</strong>)
</p>
</li>
<li>
<p>
the snapshot upstream source tree with template files generated by the <strong>debmake</strong> command: <strong>hello-c-1.5/</strong>*
</p>
</li>
<li>
<p>
the cleaned VCS directory: <strong>vcsdir/</strong>*
</p>
</li>
</ul></div>
<div class="paragraph"><p>For the proper packaging, you are required to make further modification using these auto-generated template files in the <strong>hello-c-1.5/debian</strong> directory. For learning purpose, let&#8217;s leave such details and move on. You can create a non-native Debian package using the <strong>debuild</strong> command (or its equivalent) in this source tree.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd hello-c-1.5
 $ debuild
 dpkg-buildpackage -rfakeroot -D -us -uc -i
 ...
 fakeroot debian/rules clean
dh clean --with autoreconf
 ...
 debian/rules build
dh build --with autoreconf
 ...
 fakeroot debian/rules binary
dh binary --with autoreconf
 ...
Finished running lintian.</code></pre>
</div></div>
<div class="paragraph"><p>Let’s inspect the result.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd ..
 $ tree -L 1
.
├── hello-c-1.5
├── hello-c_1.5-1_amd64.build
├── hello-c_1.5-1_amd64.changes
├── hello-c_1.5-1_amd64.deb
├── hello-c_1.5-1.debian.tar.xz
├── hello-c_1.5-1.dsc
├── hello-c_1.5.orig.tar.gz -&gt; hello-c-1.5.tar.gz
├── hello-c-1.5.tar.gz
└── vcsdir

2 directories, 7 files</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code> $ dpkg -c hello-c_1.5-1_amd64.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/hello-c/
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/README.Debian
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/changelog.Debian.gz
drwxr-xr-x root/root ...  ./usr/bin/
-rwxr-xr-x root/root ...  ./usr/bin/hello</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code> $ tar -tJf hello-c_1.5-1.debian.tar.xz
debian/
debian/rules
debian/compat
debian/control
debian/watch
debian/copyright
debian/source/
debian/source/format
debian/README.Debian
debian/patches/
debian/patches/series
debian/changelog
 $ tar -tzf hello-c-1.5.tar.gz
hello-c-1.5/
hello-c-1.5/install-sh
hello-c-1.5/missing
hello-c-1.5/depcomp
hello-c-1.5/aclocal.m4
hello-c-1.5/compile
hello-c-1.5/configure.ac
hello-c-1.5/config.h.in
hello-c-1.5/hello.c
hello-c-1.5/Makefile.am
hello-c-1.5/configure
hello-c-1.5/Makefile.in</code></pre>
</div></div>
<div class="paragraph"><p>Your development branch holding the real upstream source tree is the <strong>devel</strong> branch.</p></div>
<div class="paragraph"><p>The following will import generated Debian packages to <strong>master</strong>, <strong>upstream</strong>, and <strong>pristine-tar</strong> branches.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd vcsdir
 $ git-import-dsc ../hello-c_1.5-1.dsc  \
                  --pristine-tar --create-missing-branches
gbp:info: Tag upstream/1.5 not found, importing Upstream tarball
gbp:info: Creating missing branch 'upstream'
pristine-tar: committed hello-c_1.5.orig.tar.gz.delta to branch pristine-ta...
gbp:info: Version '1.5-1' imported under 'hello-c'
 $ git branch
* devel
  master
  pristine-tar
  upstream
 $ gitk --all</code></pre>
</div></div>
<div class="paragraph"><p>The <strong>gitk</strong> command shows the VCS history nicely.</p></div>
</div>
<div class="sect2">
<h3 id="pythonpkg">Snapshot (<strong>Python</strong>)</h3>
<div class="paragraph"><p>Let&#8217;s consider another upstream source in the VCS and make a snapshot package from it.  Let&#8217;s assume this is a <a href="https://docs.python.org/3/">Python3</a> source package with the <a href="https://docs.python.org/3/distutils/">distutils</a>.</p></div>
<div class="paragraph"><p>Let&#8217;s inspect files.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ tree
.
└── vcsdir
    ├── hello-py
    │   └── __init__.py
    ├── MANIFEST
    ├── MANIFEST.in
    ├── PKG-INFO
    ├── scripts
    │   └── hello
    └── setup.py

3 directories, 6 files</code></pre>
</div></div>
<div class="paragraph"><p>Here are minimalistic configuration files for distutils with the upstream version <strong>1.0</strong>..</p></div>
<div class="listingblock">
<div class="title"><strong>setup.py</strong>:</div>
<div class="content">
<pre><code> $ cat vcsdir/setup.py
#!/usr/bin/python3
# vi:se ts=4 sts=4 et ai:
from distutils.core import setup

setup(name='hello-py',
    version='1.0',
    description='Hello Python',
    long_description='Hello Python program.',
    author='Osamu Aoki',
    author_email='osamu@debian.org',
    url='http://people.debian.org/~osamu/',
    packages=['hello-py'],
    package_dir={'hello-py': 'hello-py'},
    scripts=['scripts/hello'],
    classifiers = ['Development Status :: 3 - Alpha',
        'Environment :: Console',
        'Intended Audience :: Developers',
        'License :: OSI Approved :: MIT License',
        'Natural Language :: English',
        'Operating System :: POSIX :: Linux',
        'Programming Language :: Python :: 3',
        'Topic :: Utilities',
    ],
    platforms   = 'POSIX',
    license     = 'MIT License'
)</code></pre>
</div></div>
<div class="paragraph"><p>The Python program code is as follows.</p></div>
<div class="listingblock">
<div class="title"><strong>scripts/hello</strong> and <strong>hello-py/<em>init</em>.py</strong></div>
<div class="content">
<pre><code> $ cat vcsdir/scripts/hello
#!/usr/bin/python3
# vim:se tw=0 sts=4 ts=4 et si:
"""
Copyright © 2014 Osamu Aoki
 ...
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
"""

import hello-py

if __name__ == '__main__':
    hello.main()

 $ cat vcsdir/hello-py/__init__.py
#!/usr/bin/python3
# vim:se tw=0 sts=4 ts=4 et ai:

def main():
    print('Hello Python3!')
    return

if __name__ == '__main__':
    main()</code></pre>
</div></div>
<div class="paragraph"><p>You create a non-native Debian package source tree from the above upstream example using the <strong>debmake</strong>(1) command.  Here package description is copied from the upstream <strong>setup.py</strong> content by the <strong>-s</strong> option.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd vcsdir
 $ git init
Initialized empty Git repository in /path/to/vcsdir/.git/
 $ git add .
 $ git commit -m "initial commit"
[master (root-commit) fadb74d] initial commit
 6 files changed, 93 insertions(+)
 create mode 100644 MANIFEST
 create mode 100644 MANIFEST.in
 create mode 100644 PKG-INFO
 create mode 100755 hello-py/__init__.py
 create mode 100755 scripts/hello
 create mode 100755 setup.py
 $ git branch devel
 $ git branch upstream
 $ git branch
  devel
* master
  upstream
 $ debmake -s -b':python3' -d -i debuild
 ...
I: debmake -x "1" ...
 ...
Finished running lintian.
I: upon return to the shell, current directory becomes /path/to/vcsdir
I: please execute "cd .." and inspect the build results.
 $ git clean -d -f
Removing dist/</code></pre>
</div></div>
<div class="paragraph"><p>Let’s inspect the result.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd ..
 $ tree -L 1
.
├── hello-py-1.0
├── hello-py_1.0-1_all.deb
├── hello-py_1.0-1_amd64.build
├── hello-py_1.0-1_amd64.changes
├── hello-py_1.0-1.debian.tar.xz
├── hello-py_1.0-1.dsc
├── hello-py_1.0.orig.tar.gz -&gt; hello-py-1.0.tar.gz
├── hello-py-1.0.tar.gz
└── vcsdir

2 directories, 7 files</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code> $ dpkg -c hello-py_1.0-1_all.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/hello-py/
-rw-r--r-- root/root ...  ./usr/share/doc/hello-py/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/hello-py/README.Debian
-rw-r--r-- root/root ...  ./usr/share/doc/hello-py/changelog.Debian.gz
drwxr-xr-x root/root ...  ./usr/bin/
-rwxr-xr-x root/root ...  ./usr/bin/hello
drwxr-xr-x root/root ...  ./usr/lib/
drwxr-xr-x root/root ...  ./usr/lib/python3/
drwxr-xr-x root/root ...  ./usr/lib/python3/dist-packages/
-rw-r--r-- root/root ...  ./usr/lib/python3/dist-packages/hello_py-1.0.egg-...
drwxr-xr-x root/root ...  ./usr/lib/python3/dist-packages/hello-py/
-rw-r--r-- root/root ...  ./usr/lib/python3/dist-packages/hello-py/__init__...</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code> $ tar -tJf hello-py_1.0-1.debian.tar.xz
debian/
debian/rules
debian/compat
debian/control
debian/watch
debian/copyright
debian/source/
debian/source/format
debian/README.Debian
debian/patches/
debian/patches/series
debian/changelog
 $ tar -tzf hello-py-1.0.tar.gz
hello-py-1.0/
hello-py-1.0/scripts/
hello-py-1.0/scripts/hello
hello-py-1.0/MANIFEST
hello-py-1.0/PKG-INFO
hello-py-1.0/hello-py/
hello-py-1.0/hello-py/__init__.py
hello-py-1.0/setup.py
hello-py-1.0/MANIFEST.in</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s check the generated control file content.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ dpkg -e hello-py_1.0-1_all.deb
 $ tree DEBIAN
DEBIAN
├── control
├── md5sums
├── postinst
└── prerm

0 directories, 4 files</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s compare how the packaging process converts the <strong>substvar</strong> etc.</p></div>
<div class="listingblock">
<div class="title"><strong>debian/control</strong> in the source package</div>
<div class="content">
<pre><code> $ cat hello-py-1.0/debian/control
Source: hello-py
Section: unknown
Priority: extra
Maintainer: "Firstname Lastname" &lt;email.address@example.org&gt;
Build-Depends: debhelper (&gt;=9), dh-python, python3-all
Standards-Version: 3.9.5
Homepage: &lt;insert the upstream URL, if relevant&gt;
X-Python3-Version: &gt;= 3.2

Package: hello-py
Architecture: all
Multi-Arch: foreign
Depends: ${misc:Depends}, ${python3:Depends}
Description: Hello Python
 Hello Python program.</code></pre>
</div></div>
<div class="listingblock">
<div class="title"><strong>DEBIAN/control</strong> in the binary package</div>
<div class="content">
<pre><code> $ cat DEBIAN/control
Package: hello-py
Version: 1.0-1
Architecture: all
Maintainer: "Firstname Lastname" &lt;email.address@example.org&gt;
Installed-Size: 50
Depends: python3, python3:any (&gt;= 3.3.2-2~)
Section: unknown
Priority: extra
Multi-Arch: foreign
Homepage: &lt;insert the upstream URL, if relevant&gt;
Description: Hello Python
 Hello Python program.</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="multipkg">Multi binary package</h3>
<div class="paragraph"><p>Let&#8217;s consider an upstream package <strong>hello-1.1.tar.gz</strong> and untar it to inspect files.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ tree
.
├── hello-1.1
│   ├── hello.c
│   ├── hello.data
│   ├── hello-sh
│   └── Makefile
└── hello-1.1.tar.gz

1 directory, 5 files</code></pre>
</div></div>
<div class="paragraph"><p>This is similar to the previously shown <strong>hello-c-1.0.tar.gz</strong>  but with a few additional files and changes.</p></div>
<div class="paragraph"><p>The C source <strong>hello.c</strong> is the same one.</p></div>
<div class="paragraph"><p><strong>Makefile</strong> is updated to support <strong>$(DESTDIR)</strong> for all files.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cat hello-1.1/Makefile
all: hello

hello: hello.c
        gcc -Wall -o hello hello.c

install: hello hello.data
        install -D hello $(DESTDIR)/usr/bin/hello
        install -D hello-sh $(DESTDIR)/usr/bin/hello-sh
        install -D hello.data $(DESTDIR)/usr/share/hello/hello.data

clean:
        -rm -f hello

distclean: clean

.PHONY: all install clean distclean</code></pre>
</div></div>
<div class="paragraph"><p>There is an additional simple shell script <strong>hello-sh</strong>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cat hello-1.1/hello-sh
#!/bin/sh
echo "Hello from the shell!"</code></pre>
</div></div>
<div class="paragraph"><p>The <strong>hello.data</strong> file is a dummy data for this training.</p></div>
<div class="paragraph"><p>Let&#8217;s create a set of the following non-native binary Debian packages.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>hello-c</strong> : <em>type</em>=<strong>bin</strong>, This package contains an ELF executable <strong>hello</strong> file compiled from the source file <strong>hello.c</strong>.
</p>
</li>
<li>
<p>
<strong>hello-c-dbg</strong> : <em>type</em>=<strong>dbg</strong>, This package contains debug symbols data of the ELF executable file <strong>hello</strong>.
</p>
</li>
<li>
<p>
<strong>hello-sh</strong> : <em>type</em>=<strong>script</strong>, This contains the shell script <strong>hello-sh</strong>.
</p>
</li>
<li>
<p>
<strong>hello-data</strong> : <em>type</em>=<strong>data</strong>, This contains the data file <strong>hello.data</strong>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Since we are splitting the generated files into multiple packages, we package this in two steps.  The first step is the "<strong>debmake -j</strong> &#8230;" command (see <a href="#testbuild">[testbuild]</a>).</p></div>
<div class="listingblock">
<div class="title">The <strong>debmake</strong> execution (1st stage)</div>
<div class="content">
<pre><code> $ cd hello-1.1
 $ debmake -j -b'-c,-c-dbg,-data:data,-sh:script'
 ...
 ... (snip)
 ...
I: $ LANG=C ; sed -e "1d" &lt; ../hello.depcheck.log | sort &gt;../hello.build-de...
I: $ LANG=C; find debian/tmp -type f 2&gt;&amp;1 | sed -e "s/^debian\/tmp\///" | s...
I: upon return to the shell, current directory becomes /path/to/hello-1.1
I: please execute "cd /path/to/hello-1.1" before building the binary packag...
I: with dpkg-buildpackage (or debuild, pdebuild, sbuild, ...).</code></pre>
</div></div>
<div class="listingblock">
<div class="title">The parent directory after the "<strong>debmake -j</strong> &#8230;" execution.</div>
<div class="content">
<pre><code> $ cd ..
 $ tree -L 1
.
├── hello-1.1
├── hello_1.1.orig.tar.gz -&gt; hello-1.1.tar.gz
├── hello-1.1.tar.gz
├── hello.build-dep.log
├── hello.build.log
├── hello.depcheck.log
└── hello.install.log

1 directory, 6 files</code></pre>
</div></div>
<div class="paragraph"><p>There are 2 log files in the parent directory.</p></div>
<div class="listingblock">
<div class="title"><strong>hello.build-dep.log</strong> generated by the <strong>dpkg-depcheck</strong> command</div>
<div class="content">
<pre><code> $ cat hello.build-dep.log
  debhelper
  libfakeroot:amd64
  liblocale-gettext-perl
  make-guile
  perl-modules</code></pre>
</div></div>
<div class="paragraph"><p>The build dependency to the <strong>debhelper</strong> package is always implemented by the <strong>debmake</strong> command.</p></div>
<div class="paragraph"><p>The dependency to other packages (<strong>libfakeroot:amd64</strong>, <strong>liblocale-gettext-perl</strong>, <strong>perl-modules</strong>) seems to be false positives caused by the build tools used such as the <strong>pdebuild</strong> command.</p></div>
<div class="paragraph"><p>For this packaging case, there is no additional package required be listed as the build dependency.</p></div>
<div class="listingblock">
<div class="title"><strong>hello.install.log</strong> listing files under the <strong>debian/tmp</strong> directory</div>
<div class="content">
<pre><code> $ cat hello.install.log
usr/bin/hello
usr/bin/hello-sh
usr/share/hello/hello.data</code></pre>
</div></div>
<div class="paragraph"><p>Now we know what files are generated in the <strong>debian/tmp</strong> directory.</p></div>
<div class="paragraph"><p>Let&#8217;s start with the fresh source tree and build package from there.  Let&#8217;s skip generating tutorial comment lines by using the <strong>-Q</strong> option.</p></div>
<div class="listingblock">
<div class="title">The <strong>debmake</strong> execution (2nd stage)</div>
<div class="content">
<pre><code> $ rm -rf hello-1.1
 $ debmake -Q -b'-c,-c-dbg,-data:data,-sh:script' -a hello-1.1.tar.gz
D: /usr/bin/debmake started
D: PYTHONPATH = /usr/bin:/usr/lib/python3.4:/usr/lib/python3.4/plat-x86_64-...
I: set parameters
 ...
I: parse binary package settings: -c,-c-dbg,-data:data,-sh:script
I: binary package=hello-c Type=bin / Arch=any M-A=foreign
I: binary package=hello-c-dbg Type=dbg / Arch=any M-A=same
I: binary package=hello-data Type=data / Arch=all M-A=foreign
I: binary package=hello-sh Type=script / Arch=all M-A=foreign
 ...
I: debmake -x "2" ...
 ...
I: $ wrap-and-sort
I: upon return to the shell, current directory becomes /path/to
I: please execute "cd /path/to/hello-1.1" before building the binary packag...
I: with dpkg-buildpackage (or debuild, pdebuild, sbuild, ...).</code></pre>
</div></div>
<div class="paragraph"><p>Please note that the <strong>debmake</strong> command is run with the <strong>-x2</strong> option as the default for the new multi binary packages.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd hello-1.1
 $ tree
.
├── debian
│   ├── changelog
│   ├── clean
│   ├── compat
│   ├── control
│   ├── copyright
│   ├── hello-c.doc-base
│   ├── hello-c.docs
│   ├── hello-c.examples
│   ├── hello-c.info
│   ├── hello-c.install
│   ├── hello-c.links
│   ├── hello-c.manpages
│   ├── hello-c.menu
│   ├── hello-c.postinst
│   ├── hello-c.postrm
│   ├── hello-c.preinst
│   ├── hello-c.prerm
│   ├── hello-data.install
│   ├── hello-sh.install
│   ├── patches
│   │   └── series
│   ├── README.Debian
│   ├── rules
│   ├── source
│   │   ├── format
│   │   └── local-options
│   └── watch
├── hello.c
├── hello.data
├── hello-sh
└── Makefile

3 directories, 29 files</code></pre>
</div></div>
<div class="paragraph"><p>Let’s inspect generated template files.</p></div>
<div class="listingblock">
<div class="title"><strong>debian/rules</strong>:</div>
<div class="content">
<pre><code> $ cat debian/rules
#!/usr/bin/make -f
#DH_VERBOSE = 1
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all
#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

%:
        dh $@

override_dh_strip:
        dh_strip --dbg-package=hello-c-dbg</code></pre>
</div></div>
<div class="paragraph"><p>This is essentially the standard <strong>debian/rules</strong> file with the <strong>dh</strong> command with <strong>override_dh_strip</strong> to create a debug package. (There are some commented out contents for you to customize it.)</p></div>
<div class="listingblock">
<div class="title"><strong>debian/control</strong>:</div>
<div class="content">
<pre><code> $ cat debian/control
Source: hello
Section: unknown
Priority: extra
Maintainer: "Firstname Lastname" &lt;email.address@example.org&gt;
Build-Depends: debhelper (&gt;=9)
Standards-Version: 3.9.5
Homepage: &lt;insert the upstream URL, if relevant&gt;

Package: hello-c
Architecture: any
Multi-Arch: foreign
Depends: ${misc:Depends}, ${shlibs:Depends}
Description: auto-generated package by debmake: bin
 This package contains the compiled binary executable.
 ...
 ... (snip)
 ...

Package: hello-c-dbg
Section: debug
Architecture: any
Multi-Arch: same
Depends: hello-c (= ${binary:Version}), ${misc:Depends}
Description: auto-generated package by debmake: dbg
 This package contains the debugging symbols.

Package: hello-data
Architecture: all
Multi-Arch: foreign
Depends: ${misc:Depends}
Description: auto-generated package by debmake: data
 This package contains the architecture independent data.

Package: hello-sh
Architecture: all
Multi-Arch: foreign
Depends: ${misc:Depends}
Description: auto-generated package by debmake: script
 This package contains the script program.</code></pre>
</div></div>
<div class="paragraph"><p>It is nice to see that the template files are generated with reasonable contents.</p></div>
<div class="paragraph"><p>There are several template files under the <strong>debian/</strong> directory.  Let&#8217;s customize them and erase unnecessary ones. (Here, we are skipping details required by the best practice.)</p></div>
<div class="listingblock">
<div class="title">Manual adjustments of <strong>debian/</strong>*</div>
<div class="content">
<pre><code> $ cd ./debian
 $ rm -f *.do* *.examples *.info *.links *.m*  *.p*
 $ rm hello-c-dbg.install
rm: cannot remove ‘hello-c-dbg.install’: No such file or directory
 $ echo usr/bin/hello &gt; hello-c.install
 $ echo usr/share/hello/hello.data &gt; hello-data.install
 $ echo usr/bin/hello-sh &gt; hello-sh.install</code></pre>
</div></div>
<div class="paragraph"><p>You can create a non-native Debian package using the <strong>debuild</strong> command (or its equivalents) in this source tree.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd ..
 $ debuild
 dpkg-buildpackage -rfakeroot -D -us -uc -i
 ...
dpkg-buildpackage: host architecture amd64
 fakeroot debian/rules clean
dh clean
 ...
 debian/rules build
dh build
 ...
 fakeroot debian/rules binary
dh binary
 ...
Finished running lintian.</code></pre>
</div></div>
<div class="paragraph"><p>Let’s inspect the result.</p></div>
<div class="listingblock">
<div class="title">The generated files of version 1.0 by the <strong>debuild</strong> command:</div>
<div class="content">
<pre><code> $ cd ..
 $ tree -L 1
.
├── hello-1.1
├── hello_1.1-1_amd64.build
├── hello_1.1-1_amd64.changes
├── hello_1.1-1.debian.tar.xz
├── hello_1.1-1.dsc
├── hello_1.1.orig.tar.gz -&gt; hello-1.1.tar.gz
├── hello-1.1.tar.gz
├── hello.build-dep.log
├── hello.build.log
├── hello-c_1.1-1_amd64.deb
├── hello-c-dbg_1.1-1_amd64.deb
├── hello-data_1.1-1_all.deb
├── hello.depcheck.log
├── hello.install.log
└── hello-sh_1.1-1_all.deb

1 directory, 14 files</code></pre>
</div></div>
<div class="listingblock">
<div class="title">The source package contents of version 1.0:</div>
<div class="content">
<pre><code> $ tar -tJf hello_1.1-1.debian.tar.xz
debian/
debian/hello-data.install
debian/rules
debian/compat
debian/hello-sh.install
debian/control
debian/watch
debian/hello-c.install
debian/clean
debian/copyright
debian/source/
debian/source/format
debian/README.Debian
debian/patches/
debian/patches/series
debian/changelog
 $ tar -tzf hello-1.1.tar.gz
hello-1.1/
hello-1.1/hello-sh
hello-1.1/hello.c
hello-1.1/Makefile
hello-1.1/hello.data</code></pre>
</div></div>
<div class="listingblock">
<div class="title">The binary package contents of version 1.0:</div>
<div class="content">
<pre><code> $ dpkg -c hello-c_1.1-1_amd64.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/hello-c/
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/README.Debian
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c/changelog.Debian.gz
drwxr-xr-x root/root ...  ./usr/bin/
-rwxr-xr-x root/root ...  ./usr/bin/hello
 $ dpkg -c hello-c-dbg_1.1-1_amd64.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/hello-c-dbg/
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c-dbg/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/hello-c-dbg/changelog.Debian.gz
drwxr-xr-x root/root ...  ./usr/lib/
drwxr-xr-x root/root ...  ./usr/lib/debug/
drwxr-xr-x root/root ...  ./usr/lib/debug/.build-id/
drwxr-xr-x root/root ...  ./usr/lib/debug/.build-id/e5/
-rw-r--r-- root/root ...  ./usr/lib/debug/.build-id/e5/0948fb440ec9f6ffcf37...
 $ dpkg -c hello-data_1.1-1_all.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/hello-data/
-rw-r--r-- root/root ...  ./usr/share/doc/hello-data/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/hello-data/changelog.Debian.gz
drwxr-xr-x root/root ...  ./usr/share/hello/
-rwxr-xr-x root/root ...  ./usr/share/hello/hello.data
 $ dpkg -c hello-sh_1.1-1_all.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/hello-sh/
-rw-r--r-- root/root ...  ./usr/share/doc/hello-sh/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/hello-sh/changelog.Debian.gz
drwxr-xr-x root/root ...  ./usr/bin/
-rwxr-xr-x root/root ...  ./usr/bin/hello-sh</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">For the normal multi binary package case, you must provide <em>binarypackage</em><strong>.install</strong> files for all binary packages (excluding <strong>dbg</strong> type ones).  The build result is split into the binary packages by moving files from the <strong>debian/tmp/</strong> directory to the directories named after the binary packages.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="librarypkg">Library package</h3>
<div class="paragraph"><p>Let&#8217;s consider an upstream package <strong>libkkc-0.3.2.tar.gz</strong>.</p></div>
<div class="listingblock">
<div class="title">Step 0: Untar &#8230;</div>
<div class="content">
<pre><code> $ tar -xzmf libkkc-0.3.2.tar.gz
 $ cd libkkc-0.3.2
 $ git init
Initialized empty Git repository in /path/to/libkkc-0.3.2/.git/
 $ git add .
 $ git commit -m 'initial import of libkkc-0.3.2.tar.gz'
[master (root-commit) dd36e4b] initial import of libkkc-0.3.2.tar.gz
 423 files changed, 211360 insertions(+)
 ...
 ... (snip)
 ...
 create mode 100644 tools/kkc.vala
 create mode 100644 tools/kkc_vala.stamp
 $ git branch upstream
 $ git tag upstream/0.3.2
 $ pristine-tar commit ../libkkc-0.3.2.tar.gz
pristine-tar: committed libkkc-0.3.2.tar.gz.delta to branch pristine-tar</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s make a test build this with the <strong>-j</strong> option (see <a href="#testbuild">[testbuild]</a>).</p></div>
<div class="listingblock">
<div class="title">Step 1: <strong>debmake -j</strong></div>
<div class="content">
<pre><code> $ debmake -j
D: /usr/bin/debmake started
D: PYTHONPATH = /usr/bin:/usr/lib/python3.4:/usr/lib/python3.4/plat-x86_64-...
I: set parameters
I: sanity check of parameters
I: pkg="libkkc", ver="0.3.2", rev="1"
I: *** start packaging in "libkkc-0.3.2". ***
I: provide libkkc_0.3.2.orig.tar.gz for non-native Debian package
 ...
 ... (snip)
 ...
I: $ wrap-and-sort
I: $ fakeroot dpkg-depcheck -m -C -o ../libkkc.depcheck.log -f -catch-alter...
I: $ LANG=C ; sed -e "1d" &lt; ../libkkc.depcheck.log | sort &gt;../libkkc.build-...
I: $ LANG=C; find debian/libkkc -type f 2&gt;&amp;1 | sed -e "s/^debian\/libkkc\//...
I: upon return to the shell, current directory becomes /path/to/libkkc-0.3....
I: please execute "cd /path/to/libkkc-0.3.2" before building the binary pac...
I: with dpkg-buildpackage (or debuild, pdebuild, sbuild, ...).</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s inspect the package dependency.</p></div>
<div class="listingblock">
<div class="title"><strong>libkkc.build-dep.log</strong></div>
<div class="content">
<pre><code> $ cat ../libkkc.build-dep.log
  bison
  cmake-data
  cpio
  dh-autoreconf
  gawk
  gobject-introspection
  gtk-doc-tools
  gvfs:amd64
  libc6-i386
  libc6-x32
  libexpat1-dev:amd64
  libfakechroot:amd64
  libfakeroot:amd64
  libfreetype6-dev
  libgee-dev
  libgirepository-1.0-1
  libgirepository1.0-dev
  libglib2.0-dev
  libgpg-error-dev
  libgtk-3-dev
  libgtk2.0-dev
  libjson-glib-dev
  liblocale-gettext-perl
  libltdl-dev:amd64
  libmarisa-dev:amd64
  libnspr4-dev
  libpython2.7-stdlib:amd64
  libselinux1:i386
  libwayland-dev
  libxml2-dev:amd64
  mime-support
  perl-modules
  python-gobject-2
  python-imaging
  python-input-pad
  python-marisa
  python-repoze.lru
  python-setuptools
  python-zope.interface
  python2.7-minimal
  valac-0.24
  valac-0.24-vapi
  xfonts-utils
  xtrans-dev
  zlib1g:i386</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s inspect the generated files.</p></div>
<div class="listingblock">
<div class="title"><strong>libkkc.install.log</strong></div>
<div class="content">
<pre><code> $ cat ../libkkc.install.log
usr/bin/kkc
usr/bin/kkc-package-data
usr/include/libkkc/libkkc.h
usr/lib/x86_64-linux-gnu/girepository-1.0/Kkc-1.0.typelib
usr/lib/x86_64-linux-gnu/libkkc.la
usr/lib/x86_64-linux-gnu/libkkc.so.2.0.0
usr/lib/x86_64-linux-gnu/pkgconfig/kkc-1.0.pc
usr/share/doc/libkkc/README.Debian
 ...
 ... (snip)
 ...
usr/share/libkkc/templates/libkkc-data/tools/genfilter.py
usr/share/libkkc/templates/libkkc-data/tools/sortlm.py
usr/share/locale/ja/LC_MESSAGES/libkkc.mo
usr/share/vala/vapi/kkc-1.0.deps
usr/share/vala/vapi/kkc-1.0.vapi</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s clean the source tree first.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ git reset --hard HEAD
HEAD is now at dd36e4b initial import of libkkc-0.3.2.tar.gz
 $ git clean -xfd
Removing Makefile
Removing autom4te.cache/
 ...
 ... (snip)
 ...
Removing tools/kkc
Removing tools/kkc-kkc.o
Removing tools/kkc-package-data</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s create the fresh source tree with the following package split plan.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="33%" />
<col width="33%" />
<col width="33%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><em>binarypackage</em></p></td>
<td align="left" valign="top"><p class="table"><em>type</em></p></td>
<td align="left" valign="top"><p class="table"><strong>-b</strong> option</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>libkkc2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>lib</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>libkkc2</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>libkkc-utils</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>bin</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>-utils</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>libkkc2-dbg</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>dbg</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>libkkc2-dbg</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>libkkc-utils-dbg</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>dbg</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>-utils-dbg</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>libkkc-dev</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>dev</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>-dev</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><strong>libkkc-common</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>data</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>-common:data</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre><code> $ debmake -b'libkkc2,-utils,libkkc2-dbg,-utils-dbg,-dev,-common:data'
D: /usr/bin/debmake started
D: PYTHONPATH = /usr/bin:/usr/lib/python3.4:/usr/lib/python3.4/plat-x86_64-...
I: set parameters
I: sanity check of parameters
I: pkg="libkkc", ver="0.3.2", rev="1"
I: *** start packaging in "libkkc-0.3.2". ***
I: provide libkkc_0.3.2.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf libkkc-0.3.2.tar.gz libkkc_0.3.2.orig.tar.gz
 ...
 ... (snip)
 ...
I: skipping :: debian/libkkc2.install (file exists)
I: creating =&gt; debian/libkkc2.doc-base
I: creating =&gt; debian/libkkc-utils.install
I: creating =&gt; debian/libkkc-dev.install
I: creating =&gt; debian/libkkc-common.install
I: run "debmake -x3" to get more template files
I: $ wrap-and-sort</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s commit this result.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ git add -A .
 $ git commit -m debmake_template
[master d8b23d7] debmake_template
 27 files changed, 2860 insertions(+)
 create mode 100644 debian/README.Debian
 ...
 ... (snip)
 ...</code></pre>
</div></div>
<div class="paragraph"><p>This generates the following source tree. (Too large to list here.)</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ tree
.
├── aclocal.m4
├── AUTHORS
├── autogen.sh
├── ChangeLog
├── compile
├── config.guess
├── config.h.in
├── config.sub
├── configure
├── configure.ac
├── COPYING
├── data
│   ├── Makefile.am
 ...
 ... (snip)
 ...
│   ├── user-segment-dictionary-bad2
│   ├── user-segment-dictionary-good
│   ├── user-sentence-dictionary-bad1
│   ├── user-sentence-dictionary-bad2
│   └── user-sentence-dictionary-good
└── tools
    ├── kkc.c
    ├── kkc-package-data.in
    ├── kkc.vala
    ├── kkc_vala.stamp
    ├── Makefile.am
    └── Makefile.in

95 directories, 438 files
 $ cd debian</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s make manual modifications to the files under the <strong>debian</strong> directory.</p></div>
<div class="listingblock">
<div class="title"><strong>changelog</strong></div>
<div class="content">
<pre><code> $ vim changelog
 ...
 $ cat changelog
libkkc (0.3.2-1) unstable; urgency=low

  * First upload to debian archive (Closes: #715232)
  * Depends skkdic
  * Update debian/license

 -- Mitsuya Shibata &lt;mty.shibata@gmail.com&gt;  Wed, 26 Feb 2014 22:51:39 +090...</code></pre>
</div></div>
<div class="listingblock">
<div class="title"><strong>compat</strong></div>
<div class="content">
<pre><code> $ cat compat
9</code></pre>
</div></div>
<div class="listingblock">
<div class="title"><strong>control</strong></div>
<div class="content">
<pre><code> $ vim control
 ...
 $ cat control
Source: libkkc
Priority: extra
Maintainer: IME Packaging Team &lt;pkg-ime-devel@lists.alioth.debian.org&gt;
Uploaders: Mitsuya Shibata &lt;mty.shibata@gmail.com&gt;,
           Osamu Aoki &lt;osamu@debian.org&gt;
Build-Depends: autotools-dev,
               debhelper (&gt;= 9),
               gobject-introspection,
               intltool,
               libgee-dev,
               libgirepository1.0-dev,
               libglib2.0-dev,
               libjson-glib-dev,
               libmarisa-dev,
               python-marisa,
               valac
Standards-Version: 3.9.5
Section: libs
Homepage: https://bitbucket.org/libkkc/libkkc/wiki/Home
Vcs-Git: git://anonscm.debian.org/pkg-ime/libkkc.git
Vcs-Browser: http://anonscm.debian.org/gitweb/?p=pkg-ime/libkkc.git

Package: libkkc2
Architecture: any
Multi-Arch: same
Pre-Depends: ${misc:Pre-Depends}
Depends: libkkc-common, libkkc-data, skkdic, ${misc:Depends}, ${shlibs:Depe...
Description: Japanese Kana Kanji input library
 libkkc provides a converter from Japanese Kana-string to
 Kana-Kanji-mixed-string. It was named after kkc.el in GNU Emacs, a simple ...
 Kanji converter, while libkkc tries to convert sentences in a bit more com...
 way using N-gram language models.
 .
 This package provides the shared library for libkkc.

Package: libkkc-utils
Section: utils
Architecture: any
Multi-Arch: foreign
Depends: libkkc-data,
         libkkc2 (= ${binary:Version}),
         ${misc:Depends},
         ${shlibs:Depends}
Description: Japanese Kana Kanji input library - testing utility
 libkkc provides a converter from Japanese Kana-string to
 Kana-Kanji-mixed-string. It was named after kkc.el in GNU Emacs, a simple ...
 Kanji converter, while libkkc tries to convert sentences in a bit more com...
 way using N-gram language models.
 .
 This package provides the testing utility for libkkc.

Package: libkkc2-dbg
Section: debug
Architecture: any
Multi-Arch: same
Depends: libkkc2 (= ${binary:Version}), ${misc:Depends}
Description: Japanese Kana Kanji input library - library debugging symbols
 libkkc provides a converter from Japanese Kana-string to
 Kana-Kanji-mixed-string. It was named after kkc.el in GNU Emacs, a simple ...
 Kanji converter, while libkkc tries to convert sentences in a bit more com...
 way using N-gram language models.
 .
 This package contains the debugging symbols for the shared library of libk...

Package: libkkc-utils-dbg
Section: debug
Architecture: any
Multi-Arch: same
Depends: libkkc-utils (= ${binary:Version}), ${misc:Depends}
Description: Japanese Kana Kanji input library - utility debugging symbols
 libkkc provides a converter from Japanese Kana-string to
 Kana-Kanji-mixed-string. It was named after kkc.el in GNU Emacs, a simple ...
 Kanji converter, while libkkc tries to convert sentences in a bit more com...
 way using N-gram language models.
 .
 This package contains the debugging symbols for the testing utility of lib...

Package: libkkc-dev
Section: libdevel
Architecture: any
Multi-Arch: same
Depends: libkkc2 (= ${binary:Version}), ${misc:Depends}
Description: Japanese Kana Kanji input library - development files
 libkkc provides a converter from Japanese Kana-string to
 Kana-Kanji-mixed-string. It was named after kkc.el in GNU Emacs, a simple ...
 Kanji converter, while libkkc tries to convert sentences in a bit more com...
 way using N-gram language models.
 .
 This package provides the files necessary for compiling programs that
 depend on libkkc.

Package: libkkc-common
Section: utils
Architecture: all
Multi-Arch: foreign
Depends: ${misc:Depends}
Description: Japanese Kana Kanji input library - common data
 libkkc provides a converter from Japanese Kana-string to
 Kana-Kanji-mixed-string. It was named after kkc.el in GNU Emacs, a simple ...
 Kanji converter, while libkkc tries to convert sentences in a bit more com...
 way using N-gram language models.
 .
 This package provides common data such as typing rules for libkkc.</code></pre>
</div></div>
<div class="listingblock">
<div class="title"><strong>copyright</strong></div>
<div class="content">
<pre><code> $ vim copyright
 ...
 $ cat copyright
Format: http://www.debian.org/doc/packaging-manuals/copyright-format/1.0/
Upstream-Name: libkkc
Source: https://bitbucket.org/libkkc/libkkc/wiki/Home

Files: *
Copyright: 2011-2013 Daiki Ueno &lt;ueno@gnu.org&gt;
           2011-2013 Red Hat, Inc.
License: GPL-3.0+
 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.
 .
 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.
 .
 You should have received a copy of the GNU General Public License
 along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.

Files: debian/*
 ...
 ... (snip)
 ...

Files: INSTALL
Copyright: 1994-2011 Free Software Foundation, Inc.
License: PERMISSIVE
 Copying and distribution of this file, with or without modification,
 are permitted in any medium without royalty provided the copyright
 notice and this notice are preserved.  This file is offered as-is,
 without warranty of any kind.</code></pre>
</div></div>
<div class="listingblock">
<div class="title"><strong>kkc.1</strong></div>
<div class="content">
<pre><code> $ vim kkc.1
 ...
 $ cat kkc.1
.\"                                      Hey, EMACS: -*- nroff -*-
.\" (C) Copyright 2013 Mitsuya Shibata &lt;mty.shibata@gmail.com&gt;,
.\"
.\" First parameter, NAME, should be all caps
.\" Second parameter, SECTION, should be 1-8, maybe w/ subsection
.\" other parameters are allowed: see man(7), man(1)
.TH KKC 1 "DEC 2013"
.\" Please adjust this date whenever revising the manpage.
.\"
.\" Some roff macros, for reference:
.\" .nh        disable hyphenation
.\" .hy        enable hyphenation
.\" .ad l      left justify
.\" .ad b      justify to both left and right margins
.\" .nf        disable filling
.\" .fi        enable filling
.\" .br        insert line break
.\" .sp &lt;n&gt;    insert n+1 empty lines
.\" for manpage-specific macros, see man(7)
.SH NAME
kkc \- a simple Kana Kanji converter
.SH SYNOPSIS
.B kkc
.I \fR[\fI help \fR|\fI decoder \fR|\fI context \fR]\fI
.RI [ OPTIONS ]
.SH DESCRIPTION
kkc converte from Kana-string to Kana-Kanji-mixed-string and list up
candidates.
.PP
Users can specify parameters through command line options. See
\fBkkc help\fP or \fBkkc command \-\-help\fP for the list of options.
.SH SEE ALSO
See /usr/share/doc/libkkc-utils/README for usage example.</code></pre>
</div></div>
<div class="listingblock">
<div class="title"><strong>install</strong> files</div>
<div class="content">
<pre><code> $ echo 'usr/share/libkkc/rules/*' &gt; libkkc-common.install
 $ echo 'usr/include/*'            &gt; libkkc-dev.install
 $ echo 'usr/lib/*/lib*.so'        &gt;&gt;libkkc-dev.install
 $ echo 'usr/lib/*/pkgconfig/*'    &gt;&gt;libkkc-dev.install
 $ echo 'usr/share/vala/vapi/*'    &gt;&gt;libkkc-dev.install
 $ echo 'usr/bin/kkc'              &gt; libkkc-utils.install
 $ echo 'usr/share/locale/'        &gt;&gt;libkkc-utils.install
 $ echo 'usr/lib/*/lib*.so.*'      &gt;&gt;libkkc2.install
 $ echo 'README'                   &gt; libkkc-utils.docs
 $ echo 'debian/kkc.1'             &gt; libkkc-utils.manpages</code></pre>
</div></div>
<div class="listingblock">
<div class="title"><strong>rules</strong></div>
<div class="content">
<pre><code> $ vim rules
 ...
 $ cat rules
#!/usr/bin/make -f
#DH_VERBOSE = 1

# In case you want to add more flags to the defaults, use
# the followings to harden via compiler options
# see FEATURE AREAS in dpkg-buildflags(1))
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all
# see ENVIRONMENT in dpkg-buildflags(1))
# package maintainers to append CFLAGS
export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
# package maintainers to append LDFLAGS
export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

VALAFLAGS:=$(foreach w,$(CPPFLAGS) $(CFLAGS) $(LDFLAGS),-X $(w))

%:
        dh $@ --with autotools-dev,gir

override_dh_auto_configure:
        dh_auto_configure -- --disable-silent-rules

override_dh_strip:
        dh_strip -Xlibkkc-utils --dbg-package=libkkc2-dbg
        dh_strip -Xlibkkc2 --dbg-package=libkkc-utils-dbg

override_dh_test:
        : # NOP to avoid breakage</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Remove unused template files</div>
<div class="content">
<pre><code> $ rm -f clean
 $ rm -f libkkc2.examples
 $ rm -f libkkc2.info
 $ rm -f libkkc2.postinst
 $ rm -f libkkc2.postrm
 $ rm -f libkkc2.preinst
 $ rm -f libkkc2.prerm</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s record packaging result into VCS.</p></div>
<div class="paragraph"><p>(Hmmm&#8230;. importing upstream with pristine-tar first is better but let&#8217;s not worry now.)</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd ../
 $ git add -A .
 $ git commit -m initial_commit
[master 1fee795] initial_commit
 18 files changed, 539 insertions(+), 2783 deletions(-)
 delete mode 100644 debian/clean
 rewrite debian/control (74%)
 rewrite debian/copyright (87%)
 create mode 100644 debian/kkc.1
 create mode 100644 debian/libkkc-utils.docs
 create mode 100644 debian/libkkc-utils.manpages
 delete mode 100644 debian/libkkc2.examples
 delete mode 100644 debian/libkkc2.info
 delete mode 100644 debian/libkkc2.postinst
 delete mode 100644 debian/libkkc2.postrm
 ...
 ... (snip)
 ...
 delete mode 100644 debian/libkkc2.postinst
 delete mode 100644 debian/libkkc2.postrm
 delete mode 100644 debian/libkkc2.preinst
 delete mode 100644 debian/libkkc2.prerm
 rewrite debian/rules (72%)</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s build this package under the <strong>pdebuild</strong> command.</p></div>
<div class="listingblock">
<div class="title">The first <strong>pdebuild</strong></div>
<div class="content">
<pre><code> $ pdebuild
dpkg-buildpackage: source package libkkc
dpkg-buildpackage: source version 0.3.2-1
 ...
 dpkg-source --before-build libkkc-0.3.2
 fakeroot debian/rules clean
make[3]: Entering directory '/path/to/libkkc-0.3.2'
--
dpkg-buildpackage: host architecture amd64
 fakeroot debian/rules clean
make[3]: Entering directory '/tmp/buildd/libkkc-0.3.2'
 ...
 debian/rules build
make[3]: Entering directory '/tmp/buildd/libkkc-0.3.2'
 ...
 fakeroot debian/rules binary
make[3]: Entering directory '/tmp/buildd/libkkc-0.3.2'
 ...
dpkg-gensymbols: warning: new libraries appeared in the symbols file: libkk...
dpkg-gensymbols: warning: debian/libkkc2/DEBIAN/symbols doesn't match compl...
--- debian/libkkc2.symbols (libkkc2_0.3.2-1_amd64)
+++ dpkg-gensymbolsvrvsOj       2014-06-12 15:36:11.710990854 +0000
@@ -0,0 +1,344 @@
+libkkc.so.2 libkkc2 #MINVER#
+ kkc_bigram_decoder_add_unknown_nodes@Base 0.3.2-1
+ kkc_bigram_decoder_backward_search@Base 0.3.2-1
+ kkc_bigram_decoder_build_trellis@Base 0.3.2-1
+ kkc_bigram_decoder_construct@Base 0.3.2-1
+ kkc_bigram_decoder_forward_search@Base 0.3.2-1
+ kkc_bigram_decoder_get_model@Base 0.3.2-1
 ...
  forking: rm -rf /var/cache/pbuilder/build//cow.25965</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Restore source tree using VCS</div>
<div class="content">
<pre><code> $ git reset --hard HEAD
HEAD is now at 1fee795 initial_commit
 $ git clean -d -f -x
 ...
 ... (snip)
 ...</code></pre>
</div></div>
<div class="paragraph"><p>Using <strong>mc</strong>, copy <strong>DEBIAN/symbols</strong> from the <strong>libkkc2_0.3.2-1_amd64.deb</strong> package to <strong>debian/libkkc2.symbols</strong>. (Of course, you can manually use the <strong>dpkg-deb</strong> command.)</p></div>
<div class="listingblock">
<div class="title">Update <strong>debian/libkkc2.symbols</strong></div>
<div class="content">
<pre><code> $ vim debian/libkkc2.symbols
 ... (:%s/-1$//)
 ... (:wq)
 $ cat debian/libkkc2.symbols
libkkc.so.2 libkkc2 #MINVER#
 kkc_bigram_decoder_add_unknown_nodes@Base 0.3.2
 kkc_bigram_decoder_backward_search@Base 0.3.2
 kkc_bigram_decoder_build_trellis@Base 0.3.2
 kkc_bigram_decoder_construct@Base 0.3.2
 kkc_bigram_decoder_forward_search@Base 0.3.2
 ...
 ... (snip)
 ...</code></pre>
</div></div>
<div class="listingblock">
<div class="title">The second <strong>pdebuild</strong></div>
<div class="content">
<pre><code> $ pdebuild
dpkg-buildpackage: source package libkkc
dpkg-buildpackage: source version 0.3.2-1
 ...
 dpkg-source --before-build libkkc-0.3.2
 fakeroot debian/rules clean
make[3]: Entering directory '/path/to/libkkc-0.3.2'
--
dpkg-buildpackage: host architecture amd64
 fakeroot debian/rules clean
make[3]: Entering directory '/tmp/buildd/libkkc-0.3.2'
 ...
 debian/rules build
make[3]: Entering directory '/tmp/buildd/libkkc-0.3.2'
 ...
 fakeroot debian/rules binary
make[3]: Entering directory '/tmp/buildd/libkkc-0.3.2'
 ...
  forking: rm -rf /var/cache/pbuilder/build//cow.29800</code></pre>
</div></div>
<div class="listingblock">
<div class="title">The build result</div>
<div class="content">
<pre><code> $ cd ..
 $ tree -L 1
.
├── libkkc-0.3.2
├── libkkc_0.3.2-1_amd64.build
├── libkkc_0.3.2-1_amd64.changes
├── libkkc_0.3.2-1.debian.tar.xz
├── libkkc_0.3.2-1.dsc
├── libkkc_0.3.2-1_source.changes
├── libkkc_0.3.2.orig.tar.gz -&gt; libkkc-0.3.2.tar.gz
├── libkkc-0.3.2.tar.gz
├── libkkc2_0.3.2-1_amd64.deb
├── libkkc2-dbg_0.3.2-1_amd64.deb
├── libkkc.build-dep.log
├── libkkc.build.log
├── libkkc-common_0.3.2-1_all.deb
├── libkkc.depcheck.log
├── libkkc-dev_0.3.2-1_amd64.deb
├── libkkc.install.log
├── libkkc-utils_0.3.2-1_amd64.deb
└── libkkc-utils-dbg_0.3.2-1_amd64.deb

1 directory, 17 files</code></pre>
</div></div>
<div class="paragraph"><p>Let’s inspect the result.</p></div>
<div class="listingblock">
<div class="title">The generated files of version 1.0 by the <strong>debuild</strong> command:</div>
<div class="content">
<pre><code> $ cd ..
 $ tree -L 1
.
├── libkkc-0.3.2
├── libkkc_0.3.2-1_amd64.build
├── libkkc_0.3.2-1_amd64.changes
├── libkkc_0.3.2-1.debian.tar.xz
├── libkkc_0.3.2-1.dsc
├── libkkc_0.3.2-1_source.changes
├── libkkc_0.3.2.orig.tar.gz -&gt; libkkc-0.3.2.tar.gz
├── libkkc-0.3.2.tar.gz
├── libkkc2_0.3.2-1_amd64.deb
├── libkkc2-dbg_0.3.2-1_amd64.deb
├── libkkc.build-dep.log
├── libkkc.build.log
├── libkkc-common_0.3.2-1_all.deb
├── libkkc.depcheck.log
├── libkkc-dev_0.3.2-1_amd64.deb
├── libkkc.install.log
├── libkkc-utils_0.3.2-1_amd64.deb
└── libkkc-utils-dbg_0.3.2-1_amd64.deb

1 directory, 17 files</code></pre>
</div></div>
<div class="listingblock">
<div class="title">The source package contents:</div>
<div class="content">
<pre><code> $ tar -tJf libkkc_0.3.2-1.debian.tar.xz
debian/
debian/libkkc-utils.docs
debian/libkkc2.menu
debian/libkkc2.manpages
debian/compat
debian/libkkc2.links
debian/changelog
debian/watch
debian/libkkc2.install
debian/kkc.1
 ...
 $ tar -tzf libkkc-0.3.2.tar.gz
libkkc-0.3.2/
libkkc-0.3.2/missing
libkkc-0.3.2/tools/
libkkc-0.3.2/tools/kkc_vala.stamp
libkkc-0.3.2/tools/kkc.vala
libkkc-0.3.2/tools/Makefile.in
libkkc-0.3.2/tools/kkc-package-data.in
libkkc-0.3.2/tools/Makefile.am
libkkc-0.3.2/tools/kkc.c
libkkc-0.3.2/NEWS
 ...</code></pre>
</div></div>
<div class="listingblock">
<div class="title">The binary package contents:</div>
<div class="content">
<pre><code> $ dpkg -c libkkc2_0.3.2-1_amd64.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/lib/
drwxr-xr-x root/root ...  ./usr/lib/x86_64-linux-gnu/
-rw-r--r-- root/root ...  ./usr/lib/x86_64-linux-gnu/libkkc.so.2.0.0
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/libkkc2/
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc2/changelog.gz
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc2/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc2/README.Debian
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc2/changelog.Debian.gz
drwxr-xr-x root/root ...  ./usr/share/menu/
-rw-r--r-- root/root ...  ./usr/share/menu/libkkc2
lrwxrwxrwx root/root ...  ./usr/lib/x86_64-linux-gnu/libkkc.so.2 -&gt; libkkc....
 $ dpkg -c libkkc2-dbg_0.3.2-1_amd64.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/lib/
drwxr-xr-x root/root ...  ./usr/lib/debug/
drwxr-xr-x root/root ...  ./usr/lib/debug/.build-id/
drwxr-xr-x root/root ...  ./usr/lib/debug/.build-id/17/
-rw-r--r-- root/root ...  ./usr/lib/debug/.build-id/17/96418989f1ba19502b6d...
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/libkkc2-dbg/
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc2-dbg/changelog.gz
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc2-dbg/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc2-dbg/changelog.Debian.gz
 $ dpkg -c libkkc-common_0.3.2-1_all.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/libkkc-common/
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-common/changelog.gz
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-common/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-common/changelog.Debian.gz...
drwxr-xr-x root/root ...  ./usr/share/libkkc/
 ...
 ... (snip)
 ...
-rw-r--r-- root/root ...  ./usr/share/libkkc/rules/default/keymap/hankaku-k...
-rw-r--r-- root/root ...  ./usr/share/libkkc/rules/default/keymap/wide-lati...
-rw-r--r-- root/root ...  ./usr/share/libkkc/rules/default/keymap/direct.js...
-rw-r--r-- root/root ...  ./usr/share/libkkc/rules/default/metadata.json
drwxr-xr-x root/root ...  ./usr/share/libkkc/rules/default/rom-kana/
-rw-r--r-- root/root ...  ./usr/share/libkkc/rules/default/rom-kana/default...
 $ dpkg -c libkkc-dev_0.3.2-1_amd64.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/include/
drwxr-xr-x root/root ...  ./usr/include/libkkc/
-rw-r--r-- root/root ...  ./usr/include/libkkc/libkkc.h
drwxr-xr-x root/root ...  ./usr/lib/
drwxr-xr-x root/root ...  ./usr/lib/x86_64-linux-gnu/
drwxr-xr-x root/root ...  ./usr/lib/x86_64-linux-gnu/pkgconfig/
-rw-r--r-- root/root ...  ./usr/lib/x86_64-linux-gnu/pkgconfig/kkc-1.0.pc
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/libkkc-dev/
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-dev/changelog.gz
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-dev/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-dev/changelog.Debian.gz
drwxr-xr-x root/root ...  ./usr/share/vala/
drwxr-xr-x root/root ...  ./usr/share/vala/vapi/
-rw-r--r-- root/root ...  ./usr/share/vala/vapi/kkc-1.0.vapi
-rw-r--r-- root/root ...  ./usr/share/vala/vapi/kkc-1.0.deps
lrwxrwxrwx root/root ...  ./usr/lib/x86_64-linux-gnu/libkkc.so -&gt; libkkc.so...
 $ dpkg -c libkkc-utils_0.3.2-1_amd64.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/bin/
-rwxr-xr-x root/root ...  ./usr/bin/kkc
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/locale/
drwxr-xr-x root/root ...  ./usr/share/locale/ja/
drwxr-xr-x root/root ...  ./usr/share/locale/ja/LC_MESSAGES/
-rw-r--r-- root/root ...  ./usr/share/locale/ja/LC_MESSAGES/libkkc.mo
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/libkkc-utils/
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-utils/changelog.gz
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-utils/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-utils/changelog.Debian.gz
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-utils/README
drwxr-xr-x root/root ...  ./usr/share/man/
drwxr-xr-x root/root ...  ./usr/share/man/man1/
-rw-r--r-- root/root ...  ./usr/share/man/man1/kkc.1.gz
 $ dpkg -c libkkc-utils-dbg_0.3.2-1_amd64.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/lib/
drwxr-xr-x root/root ...  ./usr/lib/debug/
drwxr-xr-x root/root ...  ./usr/lib/debug/.build-id/
drwxr-xr-x root/root ...  ./usr/lib/debug/.build-id/6a/
-rw-r--r-- root/root ...  ./usr/lib/debug/.build-id/6a/e0281cd5fd129fff74a5...
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/libkkc-utils-dbg/
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-utils-dbg/changelog.gz
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-utils-dbg/copyright
-rw-r--r-- root/root ...  ./usr/share/doc/libkkc-utils-dbg/changelog.Debian...</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="this">This package</h3>
<div class="paragraph"><p>The git repository (see <a href="http://anonscm.debian.org/gitweb/?p=collab-maint/debmake.git">http://anonscm.debian.org/gitweb/?p=collab-maint/debmake.git</a>) is used to manage the development of the <strong>debmake</strong> package as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ git clone https://alioth.debian.org/anonscm/git/collab-maint/debmake.git
 $ git checkout devel</code></pre>
</div></div>
<div class="paragraph"><p>The development of the <strong>debmake</strong> package is done on this <strong>devel</strong> branch:</p></div>
<div class="ulist"><ul>
<li>
<p>
Hack both in the upstream portion and under the <strong>debian/</strong>* directory, just like the native Debian package source tree.
</p>
</li>
<li>
<p>
Set the proper version strings before the release.
</p>
<div class="ulist"><ul>
<li>
<p>
Update the <em>version-rev</em> string in the <strong>debian/changelog</strong> as if this is the non-native Debian package: <strong>dch -r</strong>
</p>
</li>
<li>
<p>
Update the <em>version</em> string in the <strong>debmake/__init__.py</strong>.
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>After everything is completed, you package the source as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ cd test; make; make clean; cd -
 $ git add -A . ; git commit -m "Release ***"
 $ debmake -d -b:py3 -i pdebuild</code></pre>
</div></div>
<div class="paragraph"><p>The last command does 3 things:</p></div>
<div class="ulist"><ul>
<li>
<p>
Generate the upstream tarball. (<strong>-d</strong> == <strong>./setup.py sdist</strong>)
</p>
</li>
<li>
<p>
Generate the source tree with <strong>debian/</strong>* copied from the VCS.
</p>
</li>
<li>
<p>
Build binary packages in the chroot. ("<strong>-i pdebuild</strong>")
</p>
</li>
</ul></div>
<div class="paragraph"><p>Then you register the result into 3 branches of the git repository.</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ gbp import-dsc --pristine-tar ../debmake_*-*.dsc</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
The <strong>upstream</strong> branch registers the upstream tarball contents.
</p>
</li>
<li>
<p>
The <strong>main</strong> branch registers the Debian source tree contents with <strong>debian/</strong>*.
</p>
</li>
<li>
<p>
The <strong>pristine-tar</strong> branch registers the <strong>*.orig.tar.gz</strong> file contents.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="manpage"><strong>debmake</strong>(1) manpage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_name">NAME</h3>
<div class="paragraph"><p>debmake - program to make the Debian source package</p></div>
</div>
<div class="sect2">
<h3 id="_synopsis">SYNOPSIS</h3>
<div class="paragraph"><p><strong>debmake</strong>  [<strong>-h</strong>]  [<strong>-c</strong> | <strong>-k</strong>] [<strong>-n</strong> | <strong>-a</strong> <em>package-version</em><strong>.orig.tar.gz</strong> | <strong>-d</strong> | <strong>-t</strong> ] [<strong>-p</strong> <em>package</em>] [<strong>-u</strong> <em>version</em>] [<strong>-r</strong> <em>revision</em>] [<strong>-z</strong> <em>extension</em>] [<strong>-b</strong> "<em>binarypackage</em><em><span class=":__type__">, &#8230;</span></em>]" [<strong>-e</strong> <em>foo@example.org</em>] [<strong>-f</strong> "<em>firstname lastname</em>"] [<strong>-i</strong> "<em>buildtool</em>" | <strong>-j</strong>] [<strong>-l</strong> <em>license_file</em>] [<strong>-m</strong>] [<strong>-o</strong> <em>file</em>] [<strong>-q</strong>] [<strong>-s</strong>] [<strong>-v</strong>] [<strong>-w</strong> "<em>addon, &#8230;</em>"] [<strong>-x</strong> [01234]] [<strong>-y</strong>] [<strong>-Q</strong>]</p></div>
</div>
<div class="sect2">
<h3 id="_description">DESCRIPTION</h3>
<div class="paragraph"><p><strong>debmake</strong> helps to build the Debian package from the upstream source.  Normally, this is done as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
The upstream tarball is downloaded as the <em>package-version</em><strong>.tar.gz</strong> file.
</p>
</li>
<li>
<p>
It is untared to create many files under the <em>package-version/</em> directory.
</p>
</li>
<li>
<p>
debmake is invoked in the <em>package-version/</em> directory possibly without any arguments.
</p>
</li>
<li>
<p>
Files in the <em>package-version</em><strong>/debian/</strong> directory are manually adjusted.
</p>
</li>
<li>
<p>
<strong>dpkg-buildpackage</strong> (usually from its wrapper <strong>debuild</strong> or <strong>pdebuild</strong>) is invoked in the <em>package-version/</em> directory to make debian packages.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Make sure to protect the arguments of the <strong>-b</strong>, <strong>-f</strong>, <strong>-l</strong>, and <strong>-w</strong> options from the shell interference by quoting them properly.</p></div>
<div class="sect3">
<h4 id="_optional_arguments">optional arguments:</h4>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-h</strong>, <strong>--help</strong>
</dt>
<dd>
<p>
show this help message and exit.
</p>
</dd>
<dt class="hdlist1">
<strong>-c</strong>, <strong>--copyright</strong>
</dt>
<dd>
<p>
scan source for copyright+license text and exit.
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>-c</strong>: sinple output style
</p>
</li>
<li>
<p>
<strong>-cc</strong>: normal output style (similar to the <strong>debian/copyright</strong> file)
</p>
</li>
<li>
<p>
<strong>-ccc</strong>: debug output style
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
<strong>-k</strong>, <strong>--kludge</strong>
</dt>
<dd>
<p>
compare the <strong>debian/copyright</strong> file with the source and exit.
</p>
<div class="paragraph"><p>The <strong>debian/copyright</strong> file must be organized to list the generic file patterns before the specific exceptions.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>-k</strong>: basic output style
</p>
</li>
<li>
<p>
<strong>-kk</strong>: verbose output style
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
<strong>-n</strong>, <strong>--native</strong>
</dt>
<dd>
<p>
make a native Debian source package without <strong>.orig.tar.gz</strong>.  This makes the "<strong>3.0 (native)</strong>" format package.
</p>
<div class="paragraph"><p>If you are thinking to package a Debian specific source tree with <strong>debian/</strong>* in it into a native Debian package, please think otherwise.  You can use  "<strong>debmake -d  -i debuild</strong>" or "<strong>debmake -t -i debuild</strong>" to make the "<strong>3.0 (quilt)</strong>" format non-native Debian package.  The only difference is that the <strong>debian/changelog</strong> file must use the  non-native version scheme: <em>version-revision</em>.  The non-native package is more friendly to the downstream distributions.</p></div>
</dd>
<dt class="hdlist1">
<strong>-a</strong> <em>package-version</em><strong>.tar.gz</strong>, <strong>--archive</strong> <em>package-version</em><strong>.tar.gz</strong>
</dt>
<dd>
<p>
use the upstream source tarball directly. (<strong>-p</strong>, <strong>-u</strong>, <strong>-z</strong>: overridden)
</p>
<div class="paragraph"><p>The upstream tarball may be specified as <em>package_version</em><strong>.orig.tar.gz</strong> and <strong>tar.gz</strong> for all cases may be <strong>tar.bz2</strong>, or <strong>tar.xz</strong>.</p></div>
<div class="paragraph"><p>If the specified upstream tarball name contains uppercase letters, the Debian package name is generated by converting them to lowercase letters.</p></div>
<div class="paragraph"><p>If the specified argument is the URL (http://, https://, or ftp://) to the upstream tarball, the upstream tarball is downloaded from the URL using <strong>wget</strong> or <strong>curl</strong>.</p></div>
</dd>
<dt class="hdlist1">
<strong>-d</strong>, <strong>--dist</strong>
</dt>
<dd>
<p>
run "make dist" equivalent first to generate upstream tarball and use it.
</p>
<div class="paragraph"><p>"<strong>debmake -d</strong>" is designed to run in the <em>package/</em> directory hosting the upstream VCS with the build system supporting "<strong>make dist</strong>" equivalents.  (automake/autoconf, Python distutils, &#8230;)</p></div>
</dd>
<dt class="hdlist1">
<strong>-t</strong>, <strong>--tar</strong>
</dt>
<dd>
<p>
run "<strong>tar</strong>" to generate upstream tarball and use it
</p>
<div class="paragraph"><p>"<strong>debmake -t</strong>" is designed to run in the <em>package/</em> directory hosting the upstream VCS.  Unless you provide the upstream version with the <strong>-u</strong> option or with the <strong>debian/changelog</strong> file, a snapshot upstream version is generated in the 0~%y%m%d%H%M format, e.g., 0~1403012359, from the UTC date and time.  The generated tarball excludes the <strong>debian/</strong> directory found in the upstream VCS. (It also excludes typical VCS directories: <strong>.git/ .hg/ .svn/ .CVS/</strong>)</p></div>
</dd>
<dt class="hdlist1">
<strong>-p</strong> <em>package</em>, <strong>--package</strong> <em>package</em>
</dt>
<dd>
<p>
set the Debian package name.
</p>
</dd>
<dt class="hdlist1">
<strong>-u</strong> <em>version</em>, <strong>--upstreamversion</strong> <em>version</em>
</dt>
<dd>
<p>
set the upstream package version.
</p>
</dd>
<dt class="hdlist1">
<strong>-r</strong> <em>revision</em>, <strong>--revision</strong> <em>revision</em>
</dt>
<dd>
<p>
set the Debian package revision.
</p>
</dd>
<dt class="hdlist1">
<strong>-z</strong> <em>extension</em>, <strong>--targz</strong> <em>extension</em>
</dt>
<dd>
<p>
set the tarball type, <em>extension</em>=(<strong>tar.gz</strong>|<strong>tar.bz2</strong>|<strong>tar.xz</strong>) (alias: <strong>z</strong>, <strong>b</strong>, <strong>x</strong>)
</p>
</dd>
<dt class="hdlist1">
<strong>-b</strong> "<em>binarypackage[:type],&#8230;</em>", <strong>--binaryspec</strong> "<em>binarypackage[:type],&#8230;</em>"
</dt>
<dd>
<p>
set binary package specs by the comma separated list of <em>binarypackage:type</em> pairs, e.g., in full form "<strong>foo:bin,foo-doc:doc,libfoo1:lib,libfoo1-dbg:dbg,libfoo-dev:dev</strong>" or in short form "<strong>,-doc,libfoo1,libfoo1-dbg, libfoo-dev</strong>".
</p>
<div class="paragraph"><p>Here, <em>binarypackage</em> is the binary package name; and optional <em>type</em> is chosen from the following <em>type</em> values:</p></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
<strong>bin</strong>: C/C++ compiled ELF binary code package (any, foreign) (default, alias: <strong>""</strong>, i.e., <em>null-string</em>)
</p>
</li>
<li>
<p>
<strong>data</strong>: Data (fonts, graphics, &#8230;) package (all, foreign) (alias: <strong>da</strong>)
</p>
</li>
<li>
<p>
<strong>dbg</strong>: Debug symbol package (any, same) (alias: <strong>db</strong>)
</p>
</li>
<li>
<p>
<strong>dev</strong>: Library development package (any, same) (alias: <strong>de</strong>)
</p>
</li>
<li>
<p>
<strong>doc</strong>: Documentation package (all, foreign) (alias: <strong>do</strong>)
</p>
</li>
<li>
<p>
<strong>lib</strong>: Library package (any, same) (alias: <strong>l</strong>)
</p>
</li>
<li>
<p>
<strong>perl</strong>: Perl script package (all, foreign) (alias: <strong>pl</strong>)
</p>
</li>
<li>
<p>
<strong>python</strong>: Python script package (all, foreign) (alias: <strong>py</strong>)
</p>
</li>
<li>
<p>
<strong>python3</strong>: Python3 script package (all, foreign) (alias: <strong>py3</strong>)
</p>
</li>
<li>
<p>
<strong>ruby</strong>: Ruby script package (all, foreign) (alias: <strong>rb</strong>)
</p>
</li>
<li>
<p>
<strong>script</strong>: Shell script package (all, foreign) (alias: <strong>sh</strong>)
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>The pair values in the parentheses, such as (any, foreign), are the <strong>Architecture</strong> and <strong>Multi-Arch</strong> stanza values set in the <strong>debian/control</strong> file.</p></div>
<div class="paragraph"><p>In many cases, the <strong>debmake</strong> command makes good guesses for <em>type</em> from <em>binarypackage</em>.  If <em>type</em> is not obvious, <em>type</em> is set to <strong>bin</strong>.  For example, <strong>libfoo</strong> sets <em>type</em> to <strong>lib</strong>, and <strong>font-bar</strong> sets <em>type</em> to <strong>data</strong>, &#8230;</p></div>
<div class="paragraph"><p>If the source tree contents do not match settings for <em>type</em>, <strong>debmake</strong> warns you.</p></div>
</dd>
<dt class="hdlist1">
<strong>-e</strong> <em>foo@example.org</em>, <strong>--email</strong> <em>foo@example.org</em>
</dt>
<dd>
<p>
set e-mail address.
</p>
<div class="paragraph"><p>The default is taken from the value of the environment variable <strong>$DEBEMAIL</strong>.</p></div>
</dd>
<dt class="hdlist1">
<strong>-f</strong> "<em>firstname lastname</em>", <strong>--fullname</strong> "<em>firstname lastname</em>"
</dt>
<dd>
<p>
set the fullname.
</p>
<div class="paragraph"><p>The default is taken from the value of the environment variable <strong>$DEBFULLNAME</strong>.</p></div>
</dd>
<dt class="hdlist1">
<strong>-i</strong> "<em>buildtool</em>", <strong>--invoke</strong> "<em>buildtool</em>"
</dt>
<dd>
<p>
invoke "<em>buildtool</em>" at the end of execution.  "<em>buildtool</em>" may be "<strong>dpkg-buildpackage</strong>", "<strong>debuild</strong>", "<strong>pdebuild</strong>", "<strong>pdebuild  --pbuilder cowbuilder</strong>", etc..
</p>
<div class="paragraph"><p>The default is not to execute any program.</p></div>
</dd>
<dt class="hdlist1">
<strong>-j</strong>, <strong>--judge</strong>
</dt>
<dd>
<p>
run <strong>dpkg-depcheck</strong> to judge build dependencies and identify file paths.  Log files are in the parent directory.
</p>
<div class="ulist"><ul>
<li>
<p>
<em>package</em><strong>.build-dep.log</strong>: Log file for <strong>dpkg-depcheck</strong>.
</p>
</li>
<li>
<p>
<em>package</em><strong>.install.log</strong>: Log file recording files in the <strong>debian/tmp</strong> directory.
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
<strong>-l</strong> "<em>license_file,&#8230;</em>", <strong>--license</strong> "<em>license_file,&#8230;</em>"
</dt>
<dd>
<p>
add formatted license text to the end of the <strong>debian/copyright</strong> file holding license scan results
</p>
<div class="paragraph"><p>The default is add <strong>COPYING</strong> and <strong>LICENSE</strong> and <em>license_file</em> needs to list only the additional file names all separated by "<strong>,</strong>".</p></div>
</dd>
<dt class="hdlist1">
<strong>-m</strong>, <strong>--monoarch</strong>
</dt>
<dd>
<p>
force packages to be non-multiarch.
</p>
</dd>
<dt class="hdlist1">
<strong>-o</strong> <em>file</em>, <strong>--option</strong> <em>file</em>
</dt>
<dd>
<p>
read optional parameters from file. (This is not for everyday use.)
</p>
<div class="paragraph"><p>The <em>file</em> is sourced as the Python3 code at the end of <strong>para.py</strong>.  For example, the package description can be specified by the following file.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>para['desc'] = 'program short description'
para['desc_long'] = '''\
 program long description which you wish to include.
 .
 Empty line is space + .
 You keep going on ...
'''</code></pre>
</div></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-q</strong>, <strong>--quitearly</strong>
</dt>
<dd>
<p>
quit early before creating files in the <strong>debian/</strong> directory.
</p>
</dd>
<dt class="hdlist1">
<strong>-s</strong>, <strong>--spec</strong>
</dt>
<dd>
<p>
use upstream spec (setup.py for Python, etc.) for the package description.
</p>
</dd>
<dt class="hdlist1">
<strong>-v</strong>, <strong>--version</strong>
</dt>
<dd>
<p>
show version information.
</p>
</dd>
<dt class="hdlist1">
<strong>-w</strong> "<em>addon,&#8230;</em>", <strong>--with</strong> "<em>addon,&#8230;</em>"
</dt>
<dd>
<p>
add extra arguments to the <strong>--with</strong> option of the <strong>dh</strong>(1) command as <em>addon</em> in <strong>debian/rules</strong>.
</p>
<div class="paragraph"><p>The <em>addon</em> values are listed all separated by "<strong>,</strong>", e.g., <strong>-w "python2,autoreconf"</strong>.</p></div>
<div class="paragraph"><p>For  Autotools based packages, setting <strong>autoreconf</strong> as <em>addon</em> forces to run "<strong>autoreconf -i -v -f</strong>" for every package building.  Otherwise, <strong>autotools-dev</strong> as <em>addon</em> is used as default.</p></div>
<div class="paragraph"><p>For Autotools based packages, if they install Python programs, <strong>python2</strong> as addon is needed for packages with <strong>compat &lt; 9</strong> since this is non-obvious.   But for <strong>setup.py</strong> based packages, <strong>python2</strong> as <em>addon</em> is not needed since this is obvious and it is automatically set for the <strong>dh</strong>(1) command by the <strong>debmake</strong> command when it is required.</p></div>
</dd>
<dt class="hdlist1">
<strong>-x</strong> <em>n</em>, <strong>--extra</strong> <em>n</em>
</dt>
<dd>
<p>
generate extra configuration files as templates.
</p>
<div class="paragraph"><p>The number <em>n</em> changes which configuration templates are generated.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>-x0</strong>: bare minimum configuration files. (default if these files exist already)
</p>
</li>
<li>
<p>
<strong>-x1</strong>: ,, + desirable configuration files. (default for new packages)
</p>
</li>
<li>
<p>
<strong>-x2</strong>: ,, + interesting configuration files. (recommended for experts, multi binary aware)
</p>
</li>
<li>
<p>
<strong>-x3</strong>:  ,,  + unusual configuration template files with the extra <strong>.ex</strong> suffix to ease their removal. (recommended for new users) To use these as configuration files, rename their file names into ones without the <strong>.ex</strong> suffix.
</p>
</li>
<li>
<p>
<strong>-x4</strong>: ,, + copyright file examples.
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
<strong>-y</strong>, <strong>--yes</strong>
</dt>
<dd>
<p>
force "yes" for all prompts. (without option: "ask [Y/n]"; doubled option: force "no")
</p>
</dd>
<dt class="hdlist1">
<strong>-Q</strong>, <strong>--quiet</strong>
</dt>
<dd>
<p>
quiet tutorial comment lines marked with <strong>&#35;&#35;&#35;</strong> in template files
</p>
</dd>
</dl></div>
</div>
</div>
<div class="sect2">
<h3 id="_examples">EXAMPLES</h3>
<div class="paragraph"><p>For  a  well  behaving  source, you can build a good-for-local-use installable single Debian binary package easily with one command.  Test install of such a package
generated in this way offers a good alternative to traditional "<strong>make install</strong>" to the <strong>/usr/local</strong> directory since the Debian package can be  removed  cleanly  by  the
"<strong>dpkg -P</strong> <em>&#8230;</em>" command. Here are some examples of how to build such test packages. (These should work in most cases.  If the <strong>-d</strong> does not work, try <strong>-t</strong> instead.)</p></div>
<div class="paragraph"><p>For a typical C program source tree packaged with autoconf/automake:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>debmake -d -i debuild</strong>
</p>
</li>
</ul></div>
<div class="paragraph"><p>For a typical python module source tree:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>debmake -s -d -b":python" -i debuild</strong>
</p>
</li>
</ul></div>
<div class="paragraph"><p>For a typical python module in the <em>package-version</em><strong>.tar.gz</strong> archive:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>debmake -s -a <em>package-version</em>.tar.gz -b":python" -i debuild</strong>
</p>
</li>
</ul></div>
<div class="paragraph"><p>For a typical perl module in the <em>Package-version</em><strong>.tar.gz</strong> archive:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>debmake -a <em>Package-version</em>.tar.gz -b":perl" -i debuild</strong>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_helper_packages">HELPER PACKAGES</h3>
<div class="paragraph"><p>Packaging may require installation of some additional specialty helper packages.</p></div>
<div class="ulist"><ul>
<li>
<p>
Python3 program may require the <strong>dh-python</strong> package.
</p>
</li>
<li>
<p>
Autotools (Autoconf + Automake) build system may require <strong>autotools-dev</strong> or <strong>dh-autoreconf</strong> package.
</p>
</li>
<li>
<p>
Ruby program may require the <strong>gem2deb</strong> package.
</p>
</li>
<li>
<p>
Java program may require the <strong>javahelper</strong> package.
</p>
</li>
<li>
<p>
Gnome programs may require the <strong>gobject-introspection</strong> package.
</p>
</li>
<li>
<p>
etc.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_caveat">CAVEAT</h3>
<div class="paragraph"><p><strong>debmake</strong> is meant to provide template files for the package maintainer to work on.  Comment lines started by <strong>&#35;&#35;&#35;</strong> are the tutorial text.  You must remove or edit such comment lines before uploading to the Debian archive.</p></div>
<div class="paragraph"><p>There  are some limitations for what characters may be used as a part of the Debian package.  The most notable limitation is the prohibition of uppercase letters in the package name.  Here is the summary in the regular expression.</p></div>
<div class="ulist"><ul>
<li>
<p>
Upstream package name (<strong>-p</strong>): [-+.a-z0-9]{2,}
</p>
</li>
<li>
<p>
Binary package name (<strong>-b</strong>): [-+.a-z0-9]{2,}
</p>
</li>
<li>
<p>
Upstream version (<strong>-u</strong>): [0-9][-+.:~a-z0-9A-Z]*
</p>
</li>
<li>
<p>
Debian revision (<strong>-r</strong>): [0-9][+.~a-z0-9A-Z]*
</p>
</li>
</ul></div>
<div class="paragraph"><p>See the exact definition in <a href="http://www.debian.org/doc/debian-policy/ch-controlfields.html">Chapter 5 - Control files and their fields</a> of the &#8220;Debian Policy Manual&#8221;.</p></div>
</div>
<div class="sect2">
<h3 id="_debug">DEBUG</h3>
<div class="paragraph"><p>The character set in the environment variable <strong>$DEBUG</strong> determines the logging output level.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>p</strong>: list all global parameters
</p>
</li>
<li>
<p>
<strong>d</strong>: list parsed parameters for all binary packages
</p>
</li>
<li>
<p>
<strong>f</strong>: input filename for the copyright scan
</p>
</li>
<li>
<p>
<strong>y</strong>: year/name split of copyright line
</p>
</li>
<li>
<p>
<strong>s</strong>: line scanner for format_state
</p>
</li>
<li>
<p>
<strong>b</strong>: content_state scan loop: begin-loop
</p>
</li>
<li>
<p>
<strong>m</strong>: content_state scan loop: after regex match
</p>
</li>
<li>
<p>
<strong>e</strong>: content_state scan loop: end-loop
</p>
</li>
<li>
<p>
<strong>c</strong>: print copyright section text
</p>
</li>
<li>
<p>
<strong>l</strong>: print license section text
</p>
</li>
<li>
<p>
<strong>a</strong>: print author/translator section text
</p>
</li>
<li>
<p>
<strong>k</strong>: sort key for debian/copyright stanza
</p>
</li>
<li>
<p>
<strong>n</strong>: scan result of debian/copyright (<code>debmake -k</code>)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Use this as:</p></div>
<div class="listingblock">
<div class="content">
<pre><code> $ DEBUG=pdfbmeclak debmake ...</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_author">AUTHOR</h3>
<div class="paragraph"><p>Copyright © 2014 Osamu Aoki &lt;<a href="mailto:osamu@debian.org">osamu@debian.org</a>&gt;</p></div>
</div>
<div class="sect2">
<h3 id="_license">LICENSE</h3>
<div class="paragraph"><p>MIT License</p></div>
</div>
<div class="sect2">
<h3 id="_see_also">SEE ALSO</h3>
<div class="paragraph"><p>The debamake package provides following HTML documents:</p></div>
<div class="ulist"><ul>
<li>
<p>
A simple tutorial: <a href="debmake.html">/usr/share/doc/debmake/debmake.html</a>
</p>
</li>
<li>
<p>
A full tutorial document for the Debian packaging with packaging examples: <a href="maint-guide.html">/usr/share/doc/debmake/maint-guide.html</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Also, please read the original <a href="http://www.debian.org/doc/manuals/maint-guide/">Debian New Maintainers' Guide</a> provided by the the <strong>maint-guide</strong> package.</p></div>
<div class="paragraph"><p>See also <strong>dpkg-source</strong>(1), <strong>deb-control</strong>(5), <strong>debhelper</strong>(7), <strong>dh</strong>(1), <strong>dpkg-buildpackage</strong>(1), <strong>debuild</strong>(1), <strong>quilt</strong>(1), <strong>dpkg-depcheck</strong>(1), <strong>pdebuild</strong>(1), <strong>pbuilder</strong>(8), <strong>cowbuilder</strong>(8), <strong>gbp-buildpackage</strong>(1), <strong>gbp-pq</strong>(1), and <strong>git-pbuilder</strong>(1) manpages.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 2.0~pre1<br />
Last updated
 2014-07-24 23:22:26 JST
</div>
</div>
</body>
</html>
